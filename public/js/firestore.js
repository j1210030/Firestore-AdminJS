(function() { var Promise = firebase && firebase.INTERNAL.Promise; var g,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba=function(){ba=function(){};k.Symbol||(k.Symbol=ca)},ca=function(){var a=0;return function(b){return"jscomp_symbol_"+(b||"")+a++}}(),ea=function(){ba();var a=k.Symbol.iterator;a||(a=k.Symbol.iterator=k.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&
aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return da(this)}});ea=function(){}},da=function(a){var b=0;return fa(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})},fa=function(a){ea();a={next:a};a[k.Symbol.iterator]=function(){return this};return a},m=function(a){ea();var b=a[Symbol.iterator];return b?b.call(a):da(a)},ha="function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},ia;
if("function"==typeof Object.setPrototypeOf)ia=Object.setPrototypeOf;else{var ja;a:{var ka={a:!0},la={};try{la.__proto__=ka;ja=la.a;break a}catch(a){}ja=!1}ia=ja?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}
var ma=ia,n=function(a,b){a.prototype=ha(b.prototype);a.prototype.constructor=a;if(ma)ma(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype},na=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c},oa=function(a,b){if(b){var c=k;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&
null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}};oa("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(a[f]=e[f])}return a}});
oa("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b){b(a)})}if(a)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a)};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=k.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(y){this.asyncThrow_(y)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(t){b.reject(t)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(t){this.reject_(t);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(y){c.reject(y)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(Jc){f(Jc)}}:b}var d,f,h=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,
d),c(b,f));return h};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=
m(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,d)})};e.all=function(a){var b=m(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){h[b]=c;l--;0==l&&a(h)}}var h=[],l=0;do h.push(void 0),l++,c(d.value).callWhenSettled_(f(h.length-1),e),d=b.next();while(!d.done)})};return e});
var pa=function(a,b){ea();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};oa("Array.prototype.keys",function(a){return a?a:function(){return pa(this,function(a){return a})}});oa("Array.prototype.values",function(a){return a?a:function(){return pa(this,function(a,c){return c})}});
var qa=qa||{},p=this,ra=function(a){return void 0!==a},q=function(a){return"string"==typeof a},sa=function(a){return"number"==typeof a},ta=function(){},ua=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";
if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==b&&"undefined"==typeof a.call)return"object";return b},va=function(a){return"array"==ua(a)},wa=function(a){var b=ua(a);return"array"==b||"object"==b&&"number"==typeof a.length},xa=function(a){return"function"==ua(a)},ya=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},za="closure_uid_"+(1E9*Math.random()>>>
0),Aa=0,Ba=function(a,b,c){return a.call.apply(a.bind,arguments)},Ca=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}},r=function(a,b,c){r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ba:Ca;return r.apply(null,arguments)},Da=function(a,b){var c=
Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}},Ea=Date.now||function(){return+new Date},u=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};var v;v="undefined"!==typeof window?window:"undefined"!==typeof self?self:global;
var __extends=function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},__rest=function(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"===typeof Object.getOwnPropertySymbols){var e=
0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&(c[d[e]]=a[d[e]])}return c},__decorate=function(a,b,c,d){var e=arguments.length,f=3>e?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;var h=v.Reflect;if("object"===typeof h&&h&&"function"===typeof h.decorate)f=h.decorate(a,b,c,d);else for(var l=a.length-1;0<=l;l--)if(h=a[l])f=(3>e?h(f):3<e?h(b,c,f):h(b,c))||f;return 3<e&&f&&Object.defineProperty(b,c,f),f},__metadata=function(a,b){var c=v.Reflect;if("object"===typeof c&&
c&&"function"===typeof c.metadata)return c.metadata(a,b)},__param=function(a,b){return function(c,d){b(c,d,a)}},__awaiter=function(a,b,c,d){return new (c||(c=Promise))(function(e,f){function h(a){try{t(d.next(a))}catch(C){f(C)}}function l(a){try{t(d["throw"](a))}catch(C){f(C)}}function t(a){a.done?e(a.value):(new c(function(b){b(a.value)})).then(h,l)}t((d=d.apply(a,b)).next())})},__generator=function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(f)throw new TypeError("Generator is already executing.");
for(;e;)try{if(f=1,h&&(l=h[c[0]&2?"return":c[0]?"throw":"next"])&&!(l=l.call(h,c[1])).done)return l;if(h=0,l)c=[0,l.value];switch(c[0]){case 0:case 1:l=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++;h=c[1];c=[0];continue;case 7:c=e.ops.pop();e.trys.pop();continue;default:if(!(l=e.trys,l=0<l.length&&l[l.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!l||c[1]>l[0]&&c[1]<l[3]))e.label=c[1];else if(6===c[0]&&e.label<l[1])e.label=l[1],l=c;else if(l&&e.label<l[2])e.label=
l[2],e.ops.push(c);else{l[2]&&e.ops.pop();e.trys.pop();continue}}c=b.call(a,e)}catch(y){c=[6,y],h=0}finally{f=l=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},f,h,l;return{next:c(0),"throw":c(1),"return":c(2)}},__values=function(a){var b="function"===typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function(){a&&c>=a.length&&(a=void 0);return{value:a&&a[c++],done:!a}}}},__read=function(a,
b){var c="function"===typeof Symbol&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[];try{for(;(void 0===b||0<b--)&&!(d=a.next()).done;)e.push(d.value)}catch(h){var f={error:h}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(f)throw f.error;}}return e},__spread=function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(__read(arguments[b]));return a};
"undefined"!==typeof v.COMPILED&&v.COMPILED||(v.__extends=__extends,v.__assign=__assign,v.__rest=__rest,v.__extends=__extends,v.__decorate=__decorate,v.__metadata=__metadata,v.__param=__param,v.__awaiter=__awaiter,v.__generator=__generator,v.__values=__values,v.__read=__read,v.__spread=__spread);var Fa=function(){var a=this;this.promise=new Promise(function(b,c){a.resolve=b;a.reject=c})};var Ga=1;function w(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];0>=Ga&&(e=(new Date).toISOString(),d=d.map(Ha),console.log.apply(console,[].concat(["Firestore (0.4.8) "+e+" ["+a+"]: "+b],d instanceof Array?d:na(m(d)))))}function Ia(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];1>=Ga&&(d=(new Date).toISOString(),c=c.map(Ha),console.error.apply(console,[].concat(["Firestore (0.4.8) "+d+": "+a],c instanceof Array?c:na(m(c)))))}
function Ha(a){if("string"===typeof a)return a;try{return JSON.stringify(a)}catch(b){return a}};function x(a){a="FIRESTORE (0.4.8) INTERNAL ASSERTION FAILED: "+a;Ia(a);throw Error(a);}function z(a,b){a||x(b)};var Ja,Ka=function(){Ja||x("Platform not set");return Ja};var A=function(a,b){var c=Error.call(this,b);this.message=c.message;"stack"in c&&(this.stack=c.stack);this.code=a;this.message=b;this.name="FirebaseError"};n(A,Error);function La(a,b){function c(){var a="This constructor is private.";b&&(a=a+" "+b);throw new A("invalid-argument",a);}c.prototype=a.prototype;for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c};function Ma(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function Na(a,b){for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=parseInt(c,10);isNaN(d)||b(d,a[c])}}function Oa(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b(c,a[c])}function Pa(a){z(null!=a&&"object"===typeof a,"isEmpty() expects object parameter.");for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0}
function Qa(a){z(a&&"object"===typeof a,"shallowCopy() expects object parameter.");var b={},c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b};function B(a,b,c){if(b.length!==c)throw new A("invalid-argument","Function "+a+"() requires "+Ra(c)+", but was called with "+Ra(b.length)+".");}function Sa(a,b,c){if(b.length<c)throw new A("invalid-argument","Function "+a+"() requires at least "+Ra(c)+", but was called with "+Ra(b.length)+".");}function Ta(a,b,c,d){if(b.length<c||b.length>d)throw new A("invalid-argument","Function "+a+"() requires between "+c+" and "+(d+" arguments, but was called with ")+Ra(b.length)+".");}
function D(a,b,c,d){Ua(a,b,Va(c)+" argument",d)}function Wa(a,b,c,d){void 0!==d&&D(a,b,c,d)}function Xa(a,b,c,d){void 0!==d&&Ua(a,b,c+" option",d)}function Ua(a,b,c,d){if(typeof d!==b||"object"===b&&!Ya(d))throw d=Za(d),new A("invalid-argument","Function "+a+"() requires its "+c+" "+("to be of type "+b+", but it was: "+d));}function Ya(a){return"object"===typeof a&&null!==a&&Object.getPrototypeOf(a)===Object.prototype}
function Za(a){if(void 0===a)return"undefined";if(null===a)return"null";if("string"===typeof a)return 20<a.length&&(a=a.substring(0,20)+"..."),JSON.stringify(a);if("number"===typeof a||"boolean"===typeof a)return""+a;if("object"===typeof a){if(a instanceof Array)return"an array";a:{if(a.constructor&&(a=/function\s+([^\s(]+)\s*\(/.exec(a.constructor.toString()))&&1<a.length){a=a[1];break a}a=null}return a?"a custom "+a+" object":"an object"}return"function"===typeof a?"a function":x("Unknown wrong type: "+
typeof a)}function $a(a,b,c){if(void 0===c)throw new A("invalid-argument","Function "+a+"() requires a valid "+Va(b)+" argument, but it was undefined.");}function ab(a,b,c){Oa(b,function(b){if(0>c.indexOf(b))throw new A("invalid-argument","Unknown option '"+b+"' passed to function "+a+"(). Available options: "+c.join(", "));})}function bb(a,b,c){c=Za(c);return new A("invalid-argument","Function "+a+"() requires its "+Va(1)+" "+("argument to be a "+b+", but it was: "+c))}
function Va(a){switch(a){case 1:return"first";case 2:return"second";case 3:return"third";default:return a+"th"}}function Ra(a){return a+" argument"+(1===a?"":"s")};var cb=function(){for(var a="",b=0;20>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));z(20===a.length,"Invalid auto ID: "+a);return a};function E(a,b){return a<b?-1:a>b?1:0}function db(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!a[c].equals(b[c]))return!1;return!0};function eb(){if("undefined"===typeof Uint8Array)throw new A("unimplemented","Uint8Arrays are not available in this environment.");}function fb(){if(!Ka().base64Available)throw new A("unimplemented","Blobs are unavailable in Firestore in this environment.");}
var gb=function(a){fb();this._binaryString=a},hb=function(a){B("Blob.fromBase64String",arguments,1);D("Blob.fromBase64String","string",1,a);fb();try{var b=Ka().atob(a);return new gb(b)}catch(c){throw new A("invalid-argument","Failed to construct Blob from Base64 string: "+c);}},ib=function(a){B("Blob.fromUint8Array",arguments,1);eb();if(!(a instanceof Uint8Array))throw bb("Blob.fromUint8Array","Uint8Array",a);var b=Array.prototype.map.call(a,function(a){return String.fromCharCode(a)}).join("");return new gb(b)};
g=gb.prototype;g.toBase64=function(){B("Blob.toBase64",arguments,0);fb();return Ka().btoa(this._binaryString)};g.toUint8Array=function(){B("Blob.toUint8Array",arguments,0);eb();for(var a=new Uint8Array(this._binaryString.length),b=0;b<this._binaryString.length;b++)a[b]=this._binaryString.charCodeAt(b);return a};g.toString=function(){return"Blob(base64: "+this.toBase64()+")"};g._equals=function(a){return this._binaryString===a._binaryString};g._compareTo=function(a){return E(this._binaryString,a._binaryString)};
var jb=La(gb,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead.");var kb=function(a){this.uid=a},lb=function(a){return null==a.uid?"anonymous-user":"uid:"+a.uid};kb.prototype.equals=function(a){return a.uid===this.uid};var mb=new kb(null),ob=new kb("google-credentials-uid"),pb=new kb("first-party-uid");var qb=function(a,b){this.user=b;this.type="OAuth";this.authHeaders={Authorization:"Bearer "+a}},rb=function(){this.userListener=null};rb.prototype.getToken=function(){return Promise.resolve(null)};rb.prototype.setUserChangeListener=function(a){z(!this.userListener,"Can only call setUserChangeListener() once.");this.userListener=a;a(mb)};rb.prototype.removeUserChangeListener=function(){z(null!==this.userListener,"removeUserChangeListener() when no listener registered");this.userListener=null};
var sb=function(a){var b=this;this.app=a;this.tokenListener=null;this.userCounter=0;this.userListener=null;this.tokenListener=function(){"function"!==typeof b.app.INTERNAL.getUid&&x("This version of the Firestore SDK requires at least version 3.7.0 of firebase.js.");var a=b.app.INTERNAL.getUid();z(null===a||"string"===typeof a,"Received invalid UID: "+a);a=new kb(a);b.currentUser&&a.equals(b.currentUser)||(b.currentUser=a,b.userCounter++,b.userListener&&b.userListener(b.currentUser))};this.userCounter=
0;this.app.INTERNAL.addAuthTokenListener(this.tokenListener)};sb.prototype.getToken=function(a){var b=this;z(null!=this.tokenListener,"getToken cannot be called after listener removed.");var c=this.userCounter;return this.app.INTERNAL.getToken(a).then(function(a){if(b.userCounter!==c)throw new A("aborted","getToken aborted due to uid change.");return a?(z("string"===typeof a.accessToken,"Invalid tokenData returned from getToken():"+a),new qb(a.accessToken,b.currentUser)):null})};
sb.prototype.setUserChangeListener=function(a){z(!this.userListener,"Can only call setUserChangeListener() once.");this.userListener=a;this.currentUser&&a(this.currentUser)};sb.prototype.removeUserChangeListener=function(){z(null!=this.tokenListener,"removeUserChangeListener() called twice");z(null!==this.userListener,"removeUserChangeListener() called when no listener registered");this.app.INTERNAL.removeAuthTokenListener(this.tokenListener);this.userListener=this.tokenListener=null};
var tb=function(a){this.authClient=a};tb.prototype.getToken=function(){var a=this;return new Promise(function(b,c){a.authClient.getAccessToken(function(a,e){a?c(a):b(new qb(e,ob))})})};tb.prototype.setUserChangeListener=function(a){a(ob)};tb.prototype.removeUserChangeListener=function(){};var ub=function(a,b){this.gapi=a;this.sessionIndex=b;this.type="FirstParty";this.user=pb;z(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")};
k.Object.defineProperties(ub.prototype,{authHeaders:{configurable:!0,enumerable:!0,get:function(){return{Authorization:this.gapi.auth.getAuthHeaderValueForFirstParty([]),"X-Goog-AuthUser":this.sessionIndex}}}});var vb=function(a,b){this.gapi=a;this.sessionIndex=b;z(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")};vb.prototype.getToken=function(){return Promise.resolve(new ub(this.gapi,this.sessionIndex))};vb.prototype.setUserChangeListener=function(a){a(pb)};
vb.prototype.removeUserChangeListener=function(){};function wb(a){if(!a)return new rb;switch(a.type){case "google-auth":return new tb(a.client);case "gapi":return new vb(a.client,a.sessionIndex||"0");case "provider":return a.client;default:throw new A("invalid-argument","makeCredentialsProvider failed due to invalid credential type");}};var xb=function(a,b,c,d){this.databaseId=a;this.persistenceKey=b;this.host=c;this.ssl=d},yb=function(a,b){this.projectId=a;this.database=b?b:"(default)"};yb.prototype.equals=function(a){return a instanceof yb&&a.projectId===this.projectId&&a.database===this.database};yb.prototype.compareTo=function(a){return E(this.projectId,a.projectId)||E(this.database,a.database)};k.Object.defineProperties(yb.prototype,{isDefaultDatabase:{configurable:!0,enumerable:!0,get:function(){return"(default)"===this.database}}});var zb=function(a,b,c){this.init(a,b,c)};g=zb.prototype;g.init=function(a,b,c){void 0===b?b=0:b>a.length&&x("offset "+b+" out of range "+a.length);void 0===c?c=a.length-b:c>a.length-b&&x("length "+c+" out of range "+(a.length-b));this.segments=a;this.offset=b;this.len=c};g.construct=function(a,b,c){var d=Object.create(Object.getPrototypeOf(this));d.init(a,b,c);return d};g.equals=function(a){return 0===Ab(this,a)};
g.child=function(a){var b=this.segments.slice(this.offset,this.limit());a instanceof zb?a.forEach(function(a){b.push(a)}):"string"===typeof a?b.push(a):x("Unknown parameter type for Path.child(): "+a);return this.construct(b)};g.limit=function(){return this.offset+this.length};
var Bb=function(a,b){b=void 0===b?1:b;z(a.length>=b,"Can't call popFirst() with less segments");return a.construct(a.segments,a.offset+b,a.length-b)},Cb=function(a){z(!a.isEmpty(),"Can't call popLast() on empty path");return a.construct(a.segments,a.offset,a.length-1)},Db=function(a){z(!a.isEmpty(),"Can't call firstSegment() on empty path");return a.segments[a.offset]},Eb=function(a){z(!a.isEmpty(),"Can't call lastSegment() on empty path");return a.segments[a.limit()-1]};
zb.prototype.get=function(a){z(a<this.length,"Index out of range");return this.segments[this.offset+a]};zb.prototype.isEmpty=function(){return 0===this.length};var Fb=function(a,b){if(b.length<a.length)return!1;for(var c=0;c<a.length;c++)if(a.get(c)!==b.get(c))return!1;return!0};zb.prototype.forEach=function(a){for(var b=this.offset,c=this.limit();b<c;b++)a(this.segments[b])};
var Gb=function(a){return a.segments.slice(a.offset,a.limit())},Ab=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;d++){var e=a.get(d),f=b.get(d);if(e<f)return-1;if(e>f)return 1}return a.length<b.length?-1:a.length>b.length?1:0};k.Object.defineProperties(zb.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this.len}}});var Hb=function(a){zb.apply(this,arguments)};n(Hb,zb);Hb.prototype.canonicalString=function(){return Gb(this).join("/")};Hb.prototype.toString=function(){return this.canonicalString()};
var Ib=function(a){if(0<=a.indexOf("//"))throw new A("invalid-argument","Invalid path ("+a+"). Paths must not contain // in them.");a=a.split("/").filter(function(a){return 0<a.length});return new Hb(a)},Jb=new Hb([]),Kb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Lb=function(a){zb.apply(this,arguments)};n(Lb,zb);Lb.prototype.canonicalString=function(){return Gb(this).map(function(a){a=a.replace("\\","\\\\").replace("`","\\`");Kb.test(a)||(a="`"+a+"`");return a}).join(".")};Lb.prototype.toString=function(){return this.canonicalString()};
var Mb=function(a){return 1===a.length&&"__name__"===a.get(0)},Nb=function(a){for(var b=[],c="",d=0,e=function(){if(0===c.length)throw new A("invalid-argument","Invalid field path ("+a+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");b.push(c);c=""},f=!1;d<a.length;){var h=a[d];if("\\"===h){if(d+1===a.length)throw new A("invalid-argument","Path has trailing escape character: "+a);h=a[d+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new A("invalid-argument","Path has invalid escape sequence: "+
a);c+=h;d+=2}else"`"===h?f=!f:"."!==h||f?c+=h:e(),d++}e();if(f)throw new A("invalid-argument","Unterminated ` in path: "+a);return b},Ob=function(a){return new Lb(Nb(a))},Pb=new Lb([]);var F=function(a){this.path=a;z(0===a.length%2,"Invalid DocumentKey with an odd number of segments: "+Gb(a).join("/"))};F.prototype.equals=function(a){return null!==a&&0===Ab(this.path,a.path)};F.prototype.toString=function(){return this.path.toString()};var Qb=function(a,b){return Ab(a.path,b.path)},Rb=new F(new Hb([]));var Tb=function(a,b){this.comparator=a;this.root=b?b:Sb};g=Tb.prototype;g.insert=function(a,b){return new Tb(this.comparator,this.root.insert(a,b,this.comparator).copy(null,null,!1,null,null))};g.remove=function(a){return new Tb(this.comparator,this.root.remove(a,this.comparator).copy(null,null,!1,null,null))};g.get=function(a){for(var b=this.root;!b.isEmpty();){var c=this.comparator(a,b.key);if(0===c)return b.value;0>c?b=b.left:0<c&&(b=b.right)}return null};
g.indexOf=function(a){for(var b=0,c=this.root;!c.isEmpty();){var d=this.comparator(a,c.key);if(0===d)return b+c.left.size;0>d?c=c.left:(b+=c.left.size+1,c=c.right)}return-1};g.isEmpty=function(){return this.root.isEmpty()};g.minKey=function(){return this.root.minKey()};g.maxKey=function(){return this.root.maxKey()};g.inorderTraversal=function(a){return this.root.inorderTraversal(a)};g.forEach=function(a){this.inorderTraversal(function(b,c){a(b,c);return!1})};
var Vb=function(a){return new Ub(a.root,null,a.comparator)},Wb=function(a,b){return new Ub(a.root,b,a.comparator)};k.Object.defineProperties(Tb.prototype,{size:{configurable:!0,enumerable:!0,get:function(){return this.root.size}}});
var Ub=function(a,b,c){this.resultGenerator=null;this.isReverse=!1;this.nodeStack=[];for(var d;!a.isEmpty();)if(d=b?c(a.key,b):1,0>d)a=this.isReverse?a.left:a.right;else if(0===d){this.nodeStack.push(a);break}else this.nodeStack.push(a),a=this.isReverse?a.right:a.left},Xb=function(a){z(0<a.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var b=a.nodeStack.pop();var c=a.resultGenerator?a.resultGenerator(b.key,b.value):{key:b.key,value:b.value};if(a.isReverse)for(b=b.left;!b.isEmpty();)a.nodeStack.push(b),
b=b.right;else for(b=b.right;!b.isEmpty();)a.nodeStack.push(b),b=b.left;return c},Yb=function(a){return 0<a.nodeStack.length},Zb=function(a,b,c,d,e){this.key=a;this.value=b;this.color=null!=c?c:!0;this.left=null!=d?d:Sb;this.right=null!=e?e:Sb;this.size=this.left.size+1+this.right.size};g=Zb.prototype;g.copy=function(a,b,c,d,e){return new Zb(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)};g.isEmpty=function(){return!1};
g.inorderTraversal=function(a){return this.left.inorderTraversal(a)||a(this.key,this.value)||this.right.inorderTraversal(a)};g.min=function(){return this.left.isEmpty()?this:this.left.min()};g.minKey=function(){return this.min().key};g.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()};
g.insert=function(a,b,c){var d=this,e=c(a,d.key);d=0>e?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c));return $b(d)};var bc=function(a){if(a.left.isEmpty())return Sb;a.left.isRed()||a.left.left.isRed()||(a=ac(a));a=a.copy(null,null,null,bc(a.left),null);return $b(a)};
Zb.prototype.remove=function(a,b){var c=this;if(0>b(a,c.key))c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=ac(c)),c=c.copy(null,null,null,c.left.remove(a,b),null);else{c.left.isRed()&&(c=cc(c));if(!(c.right.isEmpty()||c.right.isRed()||c.right.left.isRed())){var d=dc(c);d.left.left.isRed()&&(d=cc(d),d=dc(d));c=d}if(0===b(a,c.key)){if(c.right.isEmpty())return Sb;d=c.right.min();c=c.copy(d.key,d.value,null,null,bc(c.right))}c=c.copy(null,null,null,null,c.right.remove(a,b))}return $b(c)};
Zb.prototype.isRed=function(){return this.color};
var $b=function(a){a.right.isRed()&&!a.left.isRed()&&(a=ec(a));a.left.isRed()&&a.left.left.isRed()&&(a=cc(a));a.left.isRed()&&a.right.isRed()&&(a=dc(a));return a},ac=function(a){a=dc(a);a.right.left.isRed()&&(a=a.copy(null,null,null,null,cc(a.right)),a=ec(a),a=dc(a));return a},ec=function(a){var b=a.copy(null,null,!0,null,a.right.left);return a.right.copy(null,null,a.color,b,null)},cc=function(a){var b=a.copy(null,null,!0,a.left.right,null);return a.left.copy(null,null,a.color,null,b)},dc=function(a){var b=
a.left.copy(null,null,!a.left.color,null,null),c=a.right.copy(null,null,!a.right.color,null,null);return a.copy(null,null,!a.color,b,c)};Zb.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw x("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw x("Right child of ("+this.key+","+this.value+") is red");var a=this.left.check();if(a!==this.right.check())throw x("Black depths differ");return a+(this.isRed()?0:1)};var Sb=null,fc=function(){this.size=0};
g=fc.prototype;g.copy=function(){return this};g.insert=function(a,b){return new Zb(a,b)};g.remove=function(){return this};g.isEmpty=function(){return!0};g.inorderTraversal=function(){return!1};g.minKey=function(){return null};g.maxKey=function(){return null};g.isRed=function(){return!1};g.check=function(){return 0};Sb=new fc;var gc=function(){this.changeMap=new Tb(Qb)};
gc.prototype.track=function(a){var b=a.doc.key,c=this.changeMap.get(b);c?0!==a.type&&3===c.type?this.changeMap=this.changeMap.insert(b,a):3===a.type&&1!==c.type?this.changeMap=this.changeMap.insert(b,{type:c.type,doc:a.doc}):2===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):2===a.type&&0===c.type?this.changeMap=this.changeMap.insert(b,{type:0,doc:a.doc}):1===a.type&&0===c.type?this.changeMap=this.changeMap.remove(b):1===a.type&&2===c.type?this.changeMap=this.changeMap.insert(b,
{type:1,doc:c.doc}):0===a.type&&1===c.type?this.changeMap=this.changeMap.insert(b,{type:2,doc:a.doc}):x("unsupported combination of changes: "+JSON.stringify(a)+" after "+JSON.stringify(c)):this.changeMap=this.changeMap.insert(b,a)};var hc=function(a){var b=[];a.changeMap.inorderTraversal(function(a,d){b.push(d)});return b};var G=function(a){this.comparator=a;this.data=new Tb(this.comparator)};g=G.prototype;g.has=function(a){return null!==this.data.get(a)};g.first=function(){return this.data.minKey()};g.last=function(){return this.data.maxKey()};g.indexOf=function(a){return this.data.indexOf(a)};g.forEach=function(a){this.data.inorderTraversal(function(b){a(b);return!1})};
var ic=function(a,b,c){for(var d=Wb(a.data,b[0]);Yb(d);){var e=Xb(d);if(0<=a.comparator(e.key,b[1]))break;c(e.key)}},jc=function(a,b,c){for(a=void 0!==c?Wb(a.data,c):Vb(a.data);Yb(a)&&(c=Xb(a),b(c.key)););},kc=function(a,b){a=Wb(a.data,b);return Yb(a)?Xb(a).key:null};G.prototype.add=function(a){return this.copy(this.data.remove(a).insert(a,!0))};G.prototype.delete=function(a){return this.has(a)?this.copy(this.data.remove(a)):this};G.prototype.isEmpty=function(){return this.data.isEmpty()};
var lc=function(a,b){var c=a;b.forEach(function(a){c=c.add(a)});return c};G.prototype.equals=function(a){if(!(a instanceof G)||this.size!==a.size)return!1;var b=Vb(this.data);for(a=Vb(a.data);Yb(b);){var c=Xb(b).key,d=Xb(a).key;if(0!==this.comparator(c,d))return!1}return!0};G.prototype.toString=function(){var a=[];this.forEach(function(b){return a.push(b)});return"SortedSet("+a.toString()+")"};G.prototype.copy=function(a){var b=new G(this.comparator);b.data=a;return b};
k.Object.defineProperties(G.prototype,{size:{configurable:!0,enumerable:!0,get:function(){return this.data.size}}});var mc=new Tb(Qb),nc=new Tb(Qb),oc=new Tb(Qb),H=new G(Qb);var pc=function(a){this.comparator=a?function(b,c){return a(b,c)||Qb(b.key,c.key)}:function(a,c){return Qb(a.key,c.key)};this.keyedMap=nc;this.sortedSet=new Tb(this.comparator)};g=pc.prototype;g.has=function(a){return null!=this.keyedMap.get(a)};g.get=function(a){return this.keyedMap.get(a)};g.first=function(){return this.sortedSet.minKey()};g.last=function(){return this.sortedSet.maxKey()};g.isEmpty=function(){return this.sortedSet.isEmpty()};
g.indexOf=function(a){return(a=this.keyedMap.get(a))?this.sortedSet.indexOf(a):-1};g.forEach=function(a){this.sortedSet.inorderTraversal(function(b){a(b);return!1})};g.add=function(a){var b=this.delete(a.key);return b.copy(b.keyedMap.insert(a.key,a),b.sortedSet.insert(a,null))};g.delete=function(a){var b=this.get(a);return b?this.copy(this.keyedMap.remove(a),this.sortedSet.remove(b)):this};
g.equals=function(a){if(!(a instanceof pc)||this.size!==a.size)return!1;var b=Vb(this.sortedSet);for(a=Vb(a.sortedSet);Yb(b);){var c=Xb(b).key,d=Xb(a).key;if(!c.equals(d))return!1}return!0};g.toString=function(){var a=[];this.forEach(function(b){a.push(b.toString())});return 0===a.length?"DocumentSet ()":"DocumentSet (\n  "+a.join("  \n")+"\n)"};g.copy=function(a,b){var c=new pc;c.comparator=this.comparator;c.keyedMap=a;c.sortedSet=b;return c};
k.Object.defineProperties(pc.prototype,{size:{configurable:!0,enumerable:!0,get:function(){return this.sortedSet.size}}});var qc=function(a){this.mapKeyFn=a;this.inner={}};g=qc.prototype;g.get=function(a){var b=this.mapKeyFn(a);b=this.inner[b];if(void 0!==b){b=m(b);for(var c=b.next();!c.done;c=b.next()){var d=m(c.value);c=d.next().value;d=d.next().value;if(c.equals(a))return d}}};g.has=function(a){return void 0!==this.get(a)};g.set=function(a,b){var c=this.mapKeyFn(a),d=this.inner[c];if(void 0===d)this.inner[c]=[[a,b]];else{for(c=0;c<d.length;c++)if(d[c][0].equals(a)){d[c]=[a,b];return}d.push([a,b])}};
g.delete=function(a){var b=this.mapKeyFn(a),c=this.inner[b];if(void 0===c)return!1;for(var d=0;d<c.length;d++)if(c[d][0].equals(a))return 1===c.length?delete this.inner[b]:c.splice(d,1),!0;return!1};g.forEach=function(a){Oa(this.inner,function(b,c){c=m(c);for(var d=c.next();!d.done;d=c.next()){var e=m(d.value);d=e.next().value;e=e.next().value;a(d,e)}})};var rc=function(){this.listeners=[]},sc=function(a){this.syncEngine=a;this.queries=new qc(function(a){return a.canonicalId()});this.onlineState=0;this.syncEngine.subscribe(this.onChange.bind(this),this.onError.bind(this))};g=sc.prototype;
g.listen=function(a){var b=a.query,c=!1,d=this.queries.get(b);d||(c=!0,d=new rc,this.queries.set(b,d));d.listeners.push(a);a.onOnlineStateChanged(this.onlineState);d.viewSnap&&tc(a,d.viewSnap);return c?this.syncEngine.listen(b).then(function(a){return d.targetId=a}):Promise.resolve(d.targetId)};
g.unlisten=function(a){var b=a.query,c=!1,d=this.queries.get(b);d&&(a=d.listeners.indexOf(a),0<=a&&(d.listeners.splice(a,1),c=0===d.listeners.length));return c?(this.queries.delete(b),this.syncEngine.unlisten(b)):Promise.resolve()};g.onChange=function(a){a=m(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=this.queries.get(b.query);if(c){for(var d=m(c.listeners),e=d.next();!e.done;e=d.next())tc(e.value,b);c.viewSnap=b}}};
g.onError=function(a,b){var c=this.queries.get(a);if(c){c=m(c.listeners);for(var d=c.next();!d.done;d=c.next())d.value.onError(b)}this.queries.delete(a)};g.onOnlineStateChanged=function(a){this.onlineState=a;this.queries.forEach(function(b,c){c=m(c.listeners);for(var d=c.next();!d.done;d=c.next())d.value.onOnlineStateChanged(a)})};
var uc=function(a,b,c){this.query=a;this.queryObserver=b;this.raisedInitialEvent=!1;this.onlineState=0;this.options=c||{}},tc=function(a,b){z(0<b.docChanges.length||b.syncStateChanged,"We got a new snapshot with no changes?");if(!a.options.includeDocumentMetadataChanges){for(var c=[],d=m(b.docChanges),e=d.next();!e.done;e=d.next())e=e.value,3!==e.type&&c.push(e);b={query:b.query,docs:b.docs,oldDocs:b.oldDocs,docChanges:c,fromCache:b.fromCache,hasPendingWrites:b.hasPendingWrites,syncStateChanged:b.syncStateChanged}}a.raisedInitialEvent?
(0<b.docChanges.length?c=!0:(c=a.snap&&a.snap.hasPendingWrites!==b.hasPendingWrites,c=b.syncStateChanged||c?!0===a.options.includeQueryMetadataChanges:!1),c&&a.queryObserver.next(b)):vc(a,b,a.onlineState)&&wc(a,b);a.snap=b};uc.prototype.onError=function(a){this.queryObserver.error(a)};uc.prototype.onOnlineStateChanged=function(a){this.onlineState=a;this.snap&&!this.raisedInitialEvent&&vc(this,this.snap,a)&&wc(this,this.snap)};
var vc=function(a,b,c){z(!a.raisedInitialEvent,"Determining whether to raise first event but already had first event");return b.fromCache?a.options.waitForSyncWhenOnline&&2!==c?(z(b.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!b.docs.isEmpty()||2===c:!0},wc=function(a,b){z(!a.raisedInitialEvent,"Trying to raise initial events for second time");b={query:b.query,docs:b.docs,oldDocs:new pc(b.docs.comparator),docChanges:xc(b),fromCache:b.fromCache,hasPendingWrites:b.hasPendingWrites,
syncStateChanged:!0};a.raisedInitialEvent=!0;a.queryObserver.next(b)},xc=function(a){var b=[];a.docs.forEach(function(a){b.push({type:0,doc:a})});return b};var yc=function(a){var b=this;this.catchCallback=this.nextCallback=null;this.result=void 0;this.error=null;this.callbackAttached=this.isDone=!1;a(function(a){b.isDone=!0;b.result=a;b.nextCallback&&b.nextCallback(a)},function(a){b.isDone=!0;b.error=a;b.catchCallback&&b.catchCallback(a)})};yc.prototype.catch=function(a){return this.next(void 0,a)};
yc.prototype.next=function(a,b){var c=this;this.callbackAttached&&x("Called next() or catch() twice for PersistencePromise");this.callbackAttached=!0;return this.isDone?this.error?zc(b,this.error):Ac(a,this.result):new yc(function(d,e){c.nextCallback=function(b){Ac(a,b).next(d,e)};c.catchCallback=function(a){zc(b,a).next(d,e)}})};
var Bc=function(a){return new Promise(function(b,c){a.next(b,c)})},Dc=function(a){try{var b=a();return b instanceof yc?b:I(b)}catch(c){return Cc(c)}},Ac=function(a,b){return a?Dc(function(){return a(b)}):I(b)},zc=function(a,b){return a?Dc(function(){return a(b)}):Cc(b)},I=function(a){return new yc(function(b){b(a)})},Cc=function(a){return new yc(function(b,c){c(a)})},Ec=function(a){return a.reduce(function(a,c){return a.next(function(){return c})},I())};var Fc=function(){this.isEager=!0;this.sources=[];this.potentialGarbage=H};Fc.prototype.addGarbageSource=function(a){this.sources.push(a);a.setGarbageCollector(this)};Fc.prototype.removeGarbageSource=function(a){this.sources.splice(this.sources.indexOf(a),1);a.setGarbageCollector(null)};Fc.prototype.addPotentialGarbageKey=function(a){this.potentialGarbage=this.potentialGarbage.add(a)};
Fc.prototype.collectGarbage=function(a){var b=this,c=[],d=H;this.potentialGarbage.forEach(function(e){var f=Gc(b,a,e);c.push(f.next(function(a){a||(d=d.add(e));return I()}))});this.potentialGarbage=H;return Ec(c).next(function(){return d})};var Gc=function(a,b,c){var d=I(!1);return a.sources.map(function(a){return function(){return a.containsKey(b,c)}}).reduce(function(a,b){return a.next(function(a){return a?I(!0):b()})},d)};var Hc=function(a,b,c){this.query=a;this.addedKeys=b;this.removedKeys=c};var Ic=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/),Kc=function(a,b){this.seconds=a;this.nanos=b;z(0<=b,"timestamp nanoseconds out of range: "+b);z(1E9>b,"timestamp nanoseconds out of range"+b);z(-62135596800<=a,"timestamp seconds out of range: "+a);z(253402300800>a,"timestamp seconds out of range"+a)},Lc=function(a){var b=Math.floor(a/1E3);return new Kc(b,1E6*(a-1E3*b))},Mc=function(a){return 1E3*a.seconds+a.nanos/1E6};
Kc.prototype.compareTo=function(a){return this.seconds===a.seconds?E(this.nanos,a.nanos):E(this.seconds,a.seconds)};Kc.prototype.equals=function(a){return a.seconds===this.seconds&&a.nanos===this.nanos};Kc.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanos="+this.nanos+")"};var Nc=function(a){this.timestamp=a};Nc.prototype.compareTo=function(a){return this.timestamp.compareTo(a.timestamp)};Nc.prototype.equals=function(a){return this.timestamp.equals(a.timestamp)};Nc.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"};Nc.prototype.toTimestamp=function(){return this.timestamp};var J=new Nc(new Kc(0,0));var Oc=function(a,b,c,d){c=void 0===c?J:c;d=void 0===d?Ka().emptyByteString:d;this.query=a;this.targetId=b;this.snapshotVersion=c;this.resumeToken=d};Oc.prototype.update=function(a){return new Oc(this.query,this.targetId,a.snapshotVersion,a.resumeToken)};Oc.prototype.equals=function(a){return this.targetId===a.targetId&&this.snapshotVersion.equals(a.snapshotVersion)&&this.resumeToken===a.resumeToken&&this.query.equals(a.query)};var Rc=function(){this.refsByKey=new G(Pc);this.refsByTarget=new G(Qc);this.garbageCollector=null};Rc.prototype.isEmpty=function(){return this.refsByKey.isEmpty()};
var Tc=function(a,b,c){b=new Sc(b,c);a.refsByKey=a.refsByKey.add(b);a.refsByTarget=a.refsByTarget.add(b)},Uc=function(a,b,c){b.forEach(function(b){return Tc(a,b,c)})},Wc=function(a,b,c){b.forEach(function(b){Vc(a,new Sc(b,c))})},Xc=function(a,b){ic(a.refsByTarget,[new Sc(Rb,b),new Sc(Rb,b+1)],function(b){Vc(a,b)})},Vc=function(a,b){a.refsByKey=a.refsByKey.delete(b);a.refsByTarget=a.refsByTarget.delete(b);null!==a.garbageCollector&&a.garbageCollector.addPotentialGarbageKey(b.key)},Yc=function(a,b){var c=
H;ic(a.refsByTarget,[new Sc(Rb,b),new Sc(Rb,b+1)],function(a){c=c.add(a.key)});return c};Rc.prototype.setGarbageCollector=function(a){this.garbageCollector=a};Rc.prototype.containsKey=function(a,b){a=kc(this.refsByKey,new Sc(b,0));return I(null!==a&&b.equals(a.key))};var Sc=function(a,b){this.key=a;this.targetOrBatchId=b},Pc=function(a,b){return Qb(a.key,b.key)||E(a.targetOrBatchId,b.targetOrBatchId)},Qc=function(a,b){return E(a.targetOrBatchId,b.targetOrBatchId)||Qb(a.key,b.key)};var K=function(a,b,c,d){this.key=a;this.version=b;this.data=c;this.hasLocalMutations=d.hasLocalMutations};K.prototype.field=function(a){return this.data.field(a)};K.prototype.value=function(){return this.data.value()};K.prototype.equals=function(a){return a instanceof K&&this.key.equals(a.key)&&this.version.equals(a.version)&&this.data.equals(a.data)&&this.hasLocalMutations===a.hasLocalMutations};
K.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", "+("{hasLocalMutations: "+this.hasLocalMutations+"})")};var L=function(a,b){this.key=a;this.version=b};L.prototype.toString=function(){return"DeletedDocument("+this.key+", "+this.version+")"};L.prototype.equals=function(a){return a&&a.version.equals(this.version)&&a.key.equals(this.key)};var Zc=function(a,b,c){this.snapshotVersion=a;this.targetChanges=b;this.documentUpdates=c},$c=function(a,b){a.documentUpdates=a.documentUpdates.insert(b.key,b)},ad=function(){this.docs=H};ad.prototype.add=function(a){this.docs=this.docs.add(a)};ad.prototype.delete=function(a){this.docs=this.docs.delete(a)};ad.prototype.equals=function(a){return null!==a&&this.docs.equals(a.docs)};k.Object.defineProperties(ad.prototype,{documents:{configurable:!0,enumerable:!0,get:function(){return this.docs}}});
var bd=function(){this.removedDocuments=this.addedDocuments=H},cd=function(a,b){var c=b;a.addedDocuments.forEach(function(a){return c=c.add(a)});a.removedDocuments.forEach(function(a){return c=c.delete(a)});return c};bd.prototype.add=function(a){this.addedDocuments=this.addedDocuments.add(a);this.removedDocuments=this.removedDocuments.delete(a)};bd.prototype.delete=function(a){this.addedDocuments=this.addedDocuments.delete(a);this.removedDocuments=this.removedDocuments.add(a)};
bd.prototype.equals=function(a){return null!==a&&this.addedDocuments.equals(a.addedDocuments)&&this.removedDocuments.equals(a.removedDocuments)};var dd=Number,ed=dd.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),fd=dd.MAX_SAFE_INTEGER||Math.pow(2,53)-1,gd=dd.isInteger||function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a};function hd(a){return null===a||void 0===a};var id=function(){};id.prototype.toString=function(){var a=this.value();return null===a?"null":a.toString()};var jd=function(a,b){z(a.typeOrder!==b.typeOrder,"Default compareTo should not be used for values of same type.");return E(a.typeOrder,b.typeOrder)},kd=function(){this.typeOrder=0;this.internalValue=null};n(kd,id);kd.prototype.value=function(){return null};kd.prototype.equals=function(a){return a instanceof kd};kd.prototype.compareTo=function(a){return a instanceof kd?0:jd(this,a)};
var ld=new kd,md=function(a){this.internalValue=a;this.typeOrder=1};n(md,id);md.prototype.value=function(){return this.internalValue};md.prototype.equals=function(a){return a instanceof md&&this.internalValue===a.internalValue};md.prototype.compareTo=function(a){return a instanceof md?E(this,a):jd(this,a)};var nd=new md(!0),od=new md(!1),pd=function(a){this.internalValue=a;this.typeOrder=2};n(pd,id);pd.prototype.value=function(){return this.internalValue};
pd.prototype.compareTo=function(a){if(a instanceof pd){var b=this.internalValue;a=a.internalValue;b=b<a?-1:b>a?1:b===a?0:isNaN(b)?isNaN(a)?0:-1:1}else b=jd(this,a);return b};function qd(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}var rd=function(a){pd.call(this,a)};n(rd,pd);rd.prototype.equals=function(a){return a instanceof rd?qd(this.internalValue,a.internalValue):!1};var sd=function(a){pd.call(this,a);this.internalValue=a};n(sd,pd);
sd.prototype.equals=function(a){return a instanceof sd?qd(this.internalValue,a.internalValue):!1};var td=new sd(NaN),ud=new sd(Infinity),vd=new sd(-Infinity),wd=function(a){this.internalValue=a;this.typeOrder=4};n(wd,id);wd.prototype.value=function(){return this.internalValue};wd.prototype.equals=function(a){return a instanceof wd&&this.internalValue===a.internalValue};wd.prototype.compareTo=function(a){return a instanceof wd?E(this.internalValue,a.internalValue):jd(this,a)};
var xd=function(a){this.internalValue=a;this.typeOrder=3};n(xd,id);xd.prototype.value=function(){return new Date(Mc(this.internalValue))};xd.prototype.equals=function(a){return a instanceof xd&&this.internalValue.equals(a.internalValue)};xd.prototype.compareTo=function(a){return a instanceof xd?this.internalValue.compareTo(a.internalValue):a instanceof yd?-1:jd(this,a)};var yd=function(a){this.localWriteTime=a;this.typeOrder=3};n(yd,id);yd.prototype.value=function(){return null};
yd.prototype.equals=function(a){return a instanceof yd&&this.localWriteTime.equals(a.localWriteTime)};yd.prototype.compareTo=function(a){return a instanceof yd?this.localWriteTime.compareTo(a.localWriteTime):a instanceof xd?1:jd(this,a)};yd.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"};var zd=function(a){this.internalValue=a;this.typeOrder=5};n(zd,id);zd.prototype.value=function(){return this.internalValue};
zd.prototype.equals=function(a){return a instanceof zd&&this.internalValue._equals(a.internalValue)};zd.prototype.compareTo=function(a){return a instanceof zd?this.internalValue._compareTo(a.internalValue):jd(this,a)};var Ad=function(a,b){this.databaseId=a;this.key=b;this.typeOrder=6};n(Ad,id);Ad.prototype.value=function(){return this.key};Ad.prototype.equals=function(a){return a instanceof Ad?this.key.equals(a.key)&&this.databaseId.equals(a.databaseId):!1};
Ad.prototype.compareTo=function(a){if(a instanceof Ad){var b=this.databaseId.compareTo(a.databaseId);return 0!==b?b:Qb(this.key,a.key)}return jd(this,a)};var Bd=function(a){this.internalValue=a;this.typeOrder=7};n(Bd,id);Bd.prototype.value=function(){return this.internalValue};Bd.prototype.equals=function(a){return a instanceof Bd&&this.internalValue._equals(a.internalValue)};Bd.prototype.compareTo=function(a){return a instanceof Bd?this.internalValue._compareTo(a.internalValue):jd(this,a)};
var M=function(a){this.internalValue=a;this.typeOrder=9};n(M,id);g=M.prototype;g.value=function(){var a={};this.internalValue.inorderTraversal(function(b,c){a[b]=c.value()});return a};g.forEach=function(a){this.internalValue.inorderTraversal(a)};g.equals=function(a){if(a instanceof M){var b=Vb(this.internalValue);for(a=Vb(a.internalValue);Yb(b)&&Yb(a);){var c=Xb(b),d=Xb(a);if(c.key!==d.key||!c.value.equals(d.value))return!1}return!Yb(b)&&!Yb(a)}return!1};
g.compareTo=function(a){if(a instanceof M){var b=Vb(this.internalValue);for(a=Vb(a.internalValue);Yb(b)&&Yb(a);){var c=Xb(b),d=Xb(a);if(c=E(c.key,d.key)||c.value.compareTo(d.value))return c}return E(Yb(b),Yb(a))}return jd(this,a)};g.set=function(a,b){z(!a.isEmpty(),"Cannot set field for empty path on ObjectValue");if(1===a.length)return a=Db(a),new M(this.internalValue.insert(a,b));var c=this.child(Db(a));c instanceof M||(c=Cd);b=c.set(Bb(a),b);a=Db(a);return new M(this.internalValue.insert(a,b))};
g.delete=function(a){z(!a.isEmpty(),"Cannot delete field for empty path on ObjectValue");if(1===a.length)return new M(this.internalValue.remove(Db(a)));var b=this.child(Db(a));return b instanceof M?(b=b.delete(Bb(a)),new M(this.internalValue.insert(Db(a),b))):this};g.contains=function(a){return void 0!==this.field(a)};g.field=function(a){z(!a.isEmpty(),"Can't get field of empty path");var b=this;a.forEach(function(a){b=b instanceof M?b.internalValue.get(a)||void 0:void 0});return b};g.toString=function(){return JSON.stringify(this.value())};
g.child=function(a){return this.internalValue.get(a)||void 0};var Cd=new M(new Tb(E)),Dd=function(a){this.internalValue=a;this.typeOrder=8};n(Dd,id);g=Dd.prototype;g.value=function(){return this.internalValue.map(function(a){return a.value()})};g.forEach=function(a){this.internalValue.forEach(a)};
g.equals=function(a){if(a instanceof Dd){if(this.internalValue.length!==a.internalValue.length)return!1;for(var b=0;b<this.internalValue.length;b++)if(!this.internalValue[b].equals(a.internalValue[b]))return!1;return!0}return!1};
g.compareTo=function(a){if(a instanceof Dd){for(var b=Math.min(this.internalValue.length,a.internalValue.length),c=0;c<b;c++){var d=this.internalValue[c].compareTo(a.internalValue[c]);if(d)return d}return E(this.internalValue.length,a.internalValue.length)}return jd(this,a)};g.toString=function(){return JSON.stringify(this.value())};var Fd=function(a,b,c,d,e,f){b=void 0===b?[]:b;c=void 0===c?[]:c;this.path=a;this.explicitOrderBy=b;this.filters=c;this.limit=void 0===d?null:d;this.startAt=void 0===e?null:e;this.endAt=void 0===f?null:f;this.memoizedOrderBy=this.memoizedCanonicalId=null;this.startAt&&Ed(this,this.startAt);this.endAt&&Ed(this,this.endAt)},Gd=function(a,b){return new Fd(a.path,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,b,a.endAt)},Hd=function(a,b){return new Fd(a.path,a.explicitOrderBy.slice(),a.filters.slice(),
a.limit,a.startAt,b)};g=Fd.prototype;g.canonicalId=function(){if(null===this.memoizedCanonicalId){var a=this.path.canonicalString();a+="|f:";for(var b=m(this.filters),c=b.next();!c.done;c=b.next())a+=c.value.canonicalId(),a+=",";a+="|ob:";b=m(this.orderBy);for(c=b.next();!c.done;c=b.next())a+=c.value.canonicalId(),a+=",";hd(this.limit)||(a=a+"|l:"+this.limit);this.startAt&&(a=a+"|lb:"+this.startAt.canonicalId());this.endAt&&(a=a+"|ub:"+this.endAt.canonicalId());this.memoizedCanonicalId=a}return this.memoizedCanonicalId};
g.toString=function(){var a="Query("+this.path.canonicalString();0<this.filters.length&&(a+=", filters: ["+this.filters.join(", ")+"]");hd(this.limit)||(a+=", limit: "+this.limit);0<this.explicitOrderBy.length&&(a+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]");this.startAt&&(a+=", startAt: "+this.startAt.canonicalId());this.endAt&&(a+=", endAt: "+this.endAt.canonicalId());return a+")"};
g.equals=function(a){if(this.limit!==a.limit||this.orderBy.length!==a.orderBy.length)return!1;for(var b=0;b<this.orderBy.length;b++)if(!this.orderBy[b].equals(a.orderBy[b]))return!1;if(this.filters.length!==a.filters.length)return!1;for(b=0;b<this.filters.length;b++)if(!this.filters[b].equals(a.filters[b]))return!1;return this.path.equals(a.path)&&(null!==this.startAt?this.startAt.equals(a.startAt):null===a.startAt)?null!==this.endAt?this.endAt.equals(a.endAt):null===a.endAt:!1};
g.docComparator=function(a,b){for(var c=!1,d=m(this.orderBy),e=d.next();!e.done;e=d.next()){e=e.value;var f=e.compare(a,b);if(0!==f)return f;c=c||Mb(e.field)}z(c,"orderBy used that doesn't compare on key field");return 0};
g.matches=function(a){var b=a.key.path;if(b=0===this.path.length%2?this.path.equals(b):Fb(this.path,b)&&this.path.length===b.length-1)a:{b=m(this.explicitOrderBy);for(var c=b.next();!c.done;c=b.next())if(c=c.value,!Mb(c.field)&&void 0===a.field(c.field)){b=!1;break a}b=!0}if(b)a:{b=m(this.filters);for(c=b.next();!c.done;c=b.next())if(!c.value.matches(a)){b=!1;break a}b=!0}b&&(b=this.startAt&&!Id(this.startAt,this.orderBy,a)||this.endAt&&Id(this.endAt,this.orderBy,a)?!1:!0);return b};
var Kd=function(a){return 0<a.explicitOrderBy.length?a.explicitOrderBy[0].field:null},Nd=function(a){a=m(a.filters);for(var b=a.next();!b.done;b=a.next())if(b=b.value,b instanceof Ld&&b.op!==Md)return b.field;return null},Od=function(a){return 0===a.path.length%2&&0===a.filters.length},Ed=function(a,b){z(b.position.length<=a.orderBy.length,"Bound is longer than orderBy")};
k.Object.defineProperties(Fd.prototype,{orderBy:{configurable:!0,enumerable:!0,get:function(){if(null===this.memoizedOrderBy){var a=Nd(this),b=Kd(this);if(null!==a&&null===b)this.memoizedOrderBy=[new Pd(a),Qd];else{z(null===a||null!==b&&a.equals(b),"First orderBy should match inequality field.");this.memoizedOrderBy=[];a=!1;b=m(this.explicitOrderBy);for(var c=b.next();!c.done;c=b.next())c=c.value,this.memoizedOrderBy.push(c),Mb(c.field)&&(a=!0);a||this.memoizedOrderBy.push((0<this.explicitOrderBy.length?
this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Rd)===Rd?Qd:Sd)}}return this.memoizedOrderBy}}});var Td=function(a){this.name=a},Yd=function(a){switch(a){case "<":return Ud;case "<=":return Vd;case "==":return Md;case ">=":return Wd;case ">":return Xd;default:return x("Unknown relation: "+a)}};Td.prototype.toString=function(){return this.name};Td.prototype.equals=function(a){return this.name===a.name};
var Ud=new Td("<"),Vd=new Td("<="),Md=new Td("=="),Xd=new Td(">"),Wd=new Td(">="),Ld=function(a,b,c){this.field=a;this.op=b;this.value=c};Ld.prototype.matches=function(a){a=a.field(this.field);return void 0!==a&&Zd(this,a)};var Zd=function(a,b){if(a.value.typeOrder!==b.typeOrder)return!1;b=b.compareTo(a.value);switch(a.op){case Ud:return 0>b;case Vd:return 0>=b;case Md:return 0===b;case Xd:return 0<b;case Wd:return 0<=b;default:return x("Unknown relation op"+a.op)}};
Ld.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()};Ld.prototype.equals=function(a){return a instanceof Ld?this.op.equals(a.op)&&this.field.equals(a.field)&&this.value.equals(a.value):!1};Ld.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()};var $d=function(a){this.field=a};$d.prototype.matches=function(a){a=a.field(this.field);return void 0!==a&&null===a.value()};
$d.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"};$d.prototype.toString=function(){return this.field.canonicalString()+" IS null"};$d.prototype.equals=function(a){return a instanceof $d?this.field.equals(a.field):!1};var ae=function(a){this.field=a};ae.prototype.matches=function(a){a=a.field(this.field).value();return"number"===typeof a&&isNaN(a)};ae.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"};
ae.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"};ae.prototype.equals=function(a){return a instanceof ae?this.field.equals(a.field):!1};var be=function(a){this.name=a};be.prototype.toString=function(){return this.name};var Rd=new be("asc"),ce=new be("desc"),de=function(a,b){this.position=a;this.before=b};de.prototype.canonicalId=function(){for(var a=this.before?"b:":"a:",b=m(this.position),c=b.next();!c.done;c=b.next())a+=c.value.toString();return a};
var Id=function(a,b,c){z(a.position.length<=b.length,"Bound has more components than query's orderBy");for(var d=0,e=0;e<a.position.length;e++){var f=b[e];d=a.position[e];if(Mb(f.field))z(d instanceof Ad,"Bound has a non-key value where the key path is being used."),d=Qb(d.key,c.key);else{var h=c.field(f.field);z(void 0!==h,"Field should exist since document matched the orderBy already.");d=d.compareTo(h)}f.dir===ce&&(d*=-1);if(0!==d)break}return a.before?0>=d:0>d};
de.prototype.equals=function(a){if(null===a||this.before!==a.before||this.position.length!==a.position.length)return!1;for(;0<this.position.length;)return this.position[0].equals(a.position[0]);return!0};var Pd=function(a,b){this.field=a;void 0===b&&(b=Rd);this.dir=b;this.isKeyOrderBy=Mb(a)};
Pd.prototype.compare=function(a,b){if(this.isKeyOrderBy)b=Qb(a.key,b.key);else{var c=this.field;a=a.field(c);b=b.field(c);b=void 0!==a&&void 0!==b?a.compareTo(b):x("Trying to compare documents on fields that don't exist")}switch(this.dir){case Rd:return b;case ce:return-1*b;default:return x("Unknown direction: "+this.dir)}};Pd.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()};
Pd.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"};Pd.prototype.equals=function(a){return this.dir===a.dir&&this.field.equals(a.field)};var Qd=new Pd(new Lb(["__name__"]),Rd),Sd=new Pd(new Lb(["__name__"]),ce);var ee=function(a,b){b=void 0===b?0:b;this.generatorId=a;var c=b>>1<<1;this.previousId=b-c>=a?c|this.generatorId:(c|this.generatorId)-2};ee.prototype.next=function(){return this.previousId+=2};var fe=function(a){return new ee(0,void 0===a?0:a)};var ge=function(a){this.key=a},he=function(a){this.key=a},ie=function(a,b){this.query=a;this.syncedDocuments=b;this.syncState=null;this.current=!1;this.mutatedKeys=this.limboDocuments=H;this.documentSet=new pc(a.docComparator.bind(a))},je=function(a,b,c){var d=c?c.changeSet:new gc,e=c?c.documentSet:a.documentSet,f=c?c.mutatedKeys:a.mutatedKeys,h=e,l=!1,t=hd(a.query.limit)||e.size!==a.query.limit?null:e.last();b.inorderTraversal(function(b,c){var y=e.get(b);if(c=c instanceof K?c:null)z(b.equals(c.key),
"Mismatching keys found in document changes: "+b+" != "+c.key),c=a.query.matches(c)?c:null;c?(h=h.add(c),f=c.hasLocalMutations?f.add(b):f.delete(b)):(h=h.delete(b),f=f.delete(b));y&&c?(b=y.data.equals(c.data),b&&y.hasLocalMutations===c.hasLocalMutations||(b?d.track({type:3,doc:c}):d.track({type:2,doc:c}),t&&0<a.query.docComparator(c,t)&&(l=!0))):!y&&c?d.track({type:0,doc:c}):y&&!c&&(d.track({type:1,doc:y}),t&&(l=!0))});if(!hd(a.query.limit))for(;h.size>a.query.limit;)b=h.last(),h=h.delete(b.key),
d.track({type:1,doc:b});z(!l||!c,"View was refilled using docs that themselves needed refilling.");return{documentSet:h,changeSet:d,needsRefill:l,mutatedKeys:f}},me=function(a,b,c){z(!b.needsRefill,"Cannot apply changes that need a refill");var d=a.documentSet;a.documentSet=b.documentSet;a.mutatedKeys=b.mutatedKeys;var e=hc(b.changeSet);e.sort(function(b,c){return ke(b.type,c.type)||a.query.docComparator(b.doc,c.doc)});c=le(a,c);var f=0===a.limboDocuments.size&&a.current?1:0,h=f!==a.syncState;a.syncState=
f;return 0!==e.length||h?{snapshot:{query:a.query,docs:b.documentSet,oldDocs:d,docChanges:e,fromCache:0===f,syncStateChanged:h,hasPendingWrites:!b.mutatedKeys.isEmpty()},limboChanges:c}:{limboChanges:c}},le=function(a,b){if(b){var c=b.mapping;c instanceof ad?a.syncedDocuments=c.documents:c instanceof bd&&(a.syncedDocuments=cd(c,a.syncedDocuments));switch(b.currentStatusUpdate){case 2:a.current=!0;break;case 1:a.current=!1;break;case 0:break;default:x("Unknown current status update: "+b.currentStatusUpdate)}}var d=
a.limboDocuments;a.limboDocuments=H;a.current&&a.documentSet.forEach(function(b){var c=b.key;a.syncedDocuments.has(c)||!a.documentSet.has(c)||a.documentSet.get(c).hasLocalMutations||(a.limboDocuments=a.limboDocuments.add(b.key))});var e=[];d.forEach(function(b){a.limboDocuments.has(b)||e.push(new he(b))});a.limboDocuments.forEach(function(a){d.has(a)||e.push(new ge(a))});return e};
function ke(a,b){var c=function(a){switch(a){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return x("Unknown ChangeType: "+a)}};return c(a)-c(b)};var ne=function(a,b,c,d){this.query=a;this.targetId=b;this.resumeToken=c;this.view=d},oe=function(a,b,c){this.localStore=a;this.remoteStore=b;this.currentUser=c;this.errorHandler=this.viewHandler=null;this.queryViewsByQuery=new qc(function(a){return a.canonicalId()});this.queryViewsByTarget={};this.limboTargetsByKey=new Tb(Qb);this.limboKeysByTarget={};this.limboDocumentRefs=new Rc;this.limboCollector=new Fc;this.mutationUserCallbacks={};this.targetIdGenerator=new ee(1)};g=oe.prototype;
g.subscribe=function(a,b){z(null!==a&&null!==b,"View and error handlers cannot be null");z(null===this.viewHandler&&null===this.errorHandler,"SyncEngine already has a subscriber.");this.viewHandler=a;this.errorHandler=b;this.limboCollector.addGarbageSource(this.limboDocumentRefs)};
g.listen=function(a){var b=this;pe(this,"listen()");z(!this.queryViewsByQuery.has(a),"We already listen to the query: "+a);return qe(this.localStore,a).then(function(c){return re(b.localStore,a).then(function(d){return se(b.localStore,c.targetId).then(function(e){e=new ie(a,e);var f=je(e,d);f=me(e,f);z(0===f.limboChanges.length,"View returned limbo docs before target ack from the server.");z(!!f.snapshot,"applyChanges for new view should always return a snapshot");e=new ne(a,c.targetId,c.resumeToken,
e);b.queryViewsByQuery.set(a,e);b.queryViewsByTarget[c.targetId]=e;b.viewHandler([f.snapshot]);b.remoteStore.listen(c)})}).then(function(){return c.targetId})})};g.unlisten=function(a){var b=this;pe(this,"unlisten()");var c=this.queryViewsByQuery.get(a);z(!!c,"Trying to unlisten on query not found:"+a);return te(this.localStore,a).then(function(){b.remoteStore.unlisten(c.targetId);return ue(b,c).then(function(){return b.localStore.collectGarbage()})})};
g.write=function(a,b){var c=this;pe(this,"write()");return ve(this.localStore,a).then(function(a){var d=c.mutationUserCallbacks[lb(c.currentUser)];d||(d=new Tb(E));d=d.insert(a.batchId,b);c.mutationUserCallbacks[lb(c.currentUser)]=d;return we(c,a.changes)}).then(function(){return xe(c.remoteStore)})};
g.runTransaction=function(a,b){var c=this;b=void 0===b?5:b;var d=new ye(this.remoteStore.datastore);return function(){try{var b=a(d);return!hd(b)&&b.catch&&b.then?b.catch(function(a){return Promise.reject(a)}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(f){return Promise.reject(f)}}().then(function(e){return d.commit().then(function(){return e}).catch(function(d){return 0===b?Promise.reject(d):c.runTransaction(a,b-1)})})};
g.applyRemoteEvent=function(a){var b=this;pe(this,"applyRemoteEvent()");Na(a.targetChanges,function(c,d){(c=b.limboKeysByTarget[c])&&2===d.currentStatusUpdate&&!a.documentUpdates.get(c)&&$c(a,new L(c,a.snapshotVersion))});return this.localStore.applyRemoteEvent(a).then(function(c){return we(b,c,a)})};
var ze=function(a,b,c){pe(a,"rejectListens()");var d=a.limboKeysByTarget[b];if(d)return a.limboTargetsByKey=a.limboTargetsByKey.remove(d),delete a.limboKeysByTarget[b],b=new Tb(Qb),b=b.insert(d,new L(d,J)),a.applyRemoteEvent(new Zc(J,{},b));var e=a.queryViewsByTarget[b];z(!!e,"Unknown targetId: "+b);return te(a.localStore,e.query).then(function(){return ue(a,e).then(function(){a.errorHandler(e.query,c)})})},Be=function(a,b){pe(a,"applySuccessfulWrite()");Ae(a,b.batch.batchId,null);return a.localStore.acknowledgeBatch(b).then(function(b){return we(a,
b)})},De=function(a,b,c){pe(a,"rejectFailedWrite()");Ae(a,b,c);return Ce(a.localStore,b).then(function(b){return we(a,b)})},Ae=function(a,b,c){var d=a.mutationUserCallbacks[lb(a.currentUser)];if(d){var e=d.get(b);e&&(z(b===d.minKey(),"Mutation callbacks processed out-of-order?"),c?e.reject(c):e.resolve(),d=d.remove(b));a.mutationUserCallbacks[lb(a.currentUser)]=d}},ue=function(a,b){a.queryViewsByQuery.delete(b.query);delete a.queryViewsByTarget[b.targetId];Xc(a.limboDocumentRefs,b.targetId);return Ee(a)},
Fe=function(a,b,c){c=m(c);for(var d=c.next();!d.done;d=c.next()){var e=d.value;if(e instanceof ge){if(Tc(a.limboDocumentRefs,e.key,b),d=a,e=e.key,!d.limboTargetsByKey.get(e)){w("SyncEngine","New document in limbo: "+e);var f=d.targetIdGenerator.next(),h=new Fd(e.path);d.limboKeysByTarget[f]=e;d.remoteStore.listen(new Oc(h,f));d.limboTargetsByKey=d.limboTargetsByKey.insert(e,f)}}else e instanceof he?(w("SyncEngine","Document no longer in limbo: "+e.key),Vc(a.limboDocumentRefs,new Sc(e.key,b))):x("Unknown limbo change: "+
JSON.stringify(e))}return Ee(a)},Ee=function(a){return Bc(a.limboCollector.collectGarbage(null).next(function(b){b.forEach(function(b){var c=a.limboTargetsByKey.get(b);null!==c&&(a.remoteStore.unlisten(c),a.limboTargetsByKey=a.limboTargetsByKey.remove(b),delete a.limboKeysByTarget[c])})}))},we=function(a,b,c){var d=[],e=[],f=[];a.queryViewsByQuery.forEach(function(h,l){f.push(Promise.resolve().then(function(){var c=je(l.view,b);return c.needsRefill?re(a.localStore,l.query).then(function(a){return je(l.view,
a,c)}):c}).then(function(b){var f=me(l.view,b,c&&c.targetChanges[l.targetId]);return Fe(a,l.targetId,f.limboChanges).then(function(){if(f.snapshot){d.push(f.snapshot);for(var a=f.snapshot,b=H,c=H,h=m(a.docChanges),l=h.next();!l.done;l=h.next())switch(l=l.value,l.type){case 0:b=b.add(l.doc.key);break;case 1:c=c.add(l.doc.key)}e.push(new Hc(a.query,b,c))}})}))});return Promise.all(f).then(function(){a.viewHandler(d);return Ge(a.localStore,e)}).then(function(){return a.localStore.collectGarbage()})},
pe=function(a,b){z(null!==a.viewHandler&&null!==a.errorHandler,"Trying to call "+b+" before calling subscribe().")};oe.prototype.handleUserChange=function(a){var b=this;this.currentUser=a;return this.localStore.handleUserChange(a).then(function(a){return we(b,a)}).then(function(){return b.remoteStore.handleUserChange(a)})};var He=function(a,b,c){this.batchId=a;this.localWriteTime=b;this.mutations=c};He.prototype.applyTo=function(a,b,c){b&&z(b.key.equals(a),"applyTo: key "+a+" should match maybeDoc key "+b.key);c&&z(c.mutationResults.length===this.mutations.length,"Mismatch between mutations and mutation results lengths.");for(var d=0;d<this.mutations.length;d++){var e=this.mutations[d],f=c&&c.mutationResults[d];e.key.equals(a)&&(b=e.applyTo(b,this.localWriteTime,f))}return b};
He.prototype.keys=function(){for(var a=H,b=m(this.mutations),c=b.next();!c.done;c=b.next())a=a.add(c.value.key);return a};He.prototype.equals=function(a){return this.batchId===a.batchId&&db(this.mutations,a.mutations)};
var Ie=function(a,b,c,d,e){this.batch=a;this.commitVersion=b;this.mutationResults=c;this.streamToken=d;this.docVersions=e},Je=function(a,b,c,d){z(a.mutations.length===c.length,"Mutations sent "+a.mutations.length+" must equal results received "+c.length);for(var e=oc,f=a.mutations,h=0;h<f.length;h++){var l=c[h].version;null===l&&(l=b);e=e.insert(f[h].key,l)}return new Ie(a,b,c,d,e)};function Ke(a){for(var b="",c=0;c<a.length;c++){0<b.length&&(b+="\u0001\u0001");for(var d=a.get(c),e=d.length,f=0;f<e;f++){var h=d.charAt(f);switch(h){case "\x00":b+="\u0001\u0010";break;case "\u0001":b+="\u0001\u0011";break;default:b+=h}}}return b+"\u0001\u0001"}
function Le(a){var b=a.length;z(2<=b,"Invalid path "+a);if(2===b)return z("\u0001"===a.charAt(0)&&"\u0001"===a.charAt(1),"Non-empty path "+a+" had length 2"),Jb;for(var c=b-2,d=[],e="",f=0;f<b;){var h=a.indexOf("\u0001",f);(0>h||h>c)&&x('Invalid encoded resource path: "'+a+'"');switch(a.charAt(h+1)){case "\u0001":f=a.substring(f,h);0!==e.length&&(f=e+=f,e="");d.push(f);break;case "\u0010":e+=a.substring(f,h);e+="\x00";break;case "\u0011":e+=a.substring(f,h+1);break;default:x('Invalid encoded resource path: "'+
a+'"')}f=h+2}return new Hb(d)};var Me=function(a,b){this.seconds=a;this.nanos=b},Ne=function(a){var b=Date.now();this.ownerId=a;this.leaseTimestampMs=b},Oe=function(a){this.userId=a;this.lastAcknowledgedBatchId=-1;this.lastStreamToken=""},Pe=function(a,b,c,d){this.userId=a;this.batchId=b;this.localWriteTimeMs=c;this.mutations=d},Qe=["userId","batchId"],Re=function(a,b,c){return[a,Ke(b),c]},Se=new function(){},Te=function(a,b){this.path=a;this.readTime=b},Ue=function(a,b){this.noDocument=a;this.document=b},Ve=function(a,b,c,d,e){this.targetId=
a;this.canonicalId=b;this.readTime=c;this.resumeToken=d;this.query=e},We=["canonicalId","targetId"],Xe=function(a,b){this.targetId=a;this.path=b},Ye=["targetId","path"],Ze=["path","targetId"],$e=function(){var a=J.toTimestamp();this.highestTargetId=0;this.lastRemoteSnapshotVersion=a},af="mutationQueues mutations documentMutations remoteDocuments targets owner targetGlobal targetDocuments".split(" ");var bf=function(a){this.db=a},df=function(a){z(cf(),"IndexedDB not supported in current environment.");w("SimpleDb","Opening database:",a);return Bc(new yc(function(b,c){var d=window.indexedDB.open(a,1);d.onsuccess=function(a){b(new bf(a.target.result))};d.onerror=function(a){c(a.target.error)};d.onupgradeneeded=function(b){w("SimpleDb",'Database "'+a+'" requires upgrade from version:',b.oldVersion);var c=b.target.result;b=b.oldVersion;z(0===b,"Unexpected upgrade from version "+b);c.createObjectStore("mutationQueues",
{keyPath:"userId"});c.createObjectStore("mutations",{keyPath:Qe});c.createObjectStore("targetDocuments",{keyPath:Ye}).createIndex("documentTargetsIndex",Ze,{unique:!0});c.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",We,{unique:!0});c.createObjectStore("documentMutations");c.createObjectStore("remoteDocuments");c.createObjectStore("owner");c.createObjectStore("targetGlobal")}}))},cf=function(){if("undefined"===typeof window||null==window.indexedDB)return!1;var a=
window.navigator.userAgent;return 0<a.indexOf("MSIE ")||0<a.indexOf("Trident/")||0<a.indexOf("Edge/")?!1:!0};bf.prototype.runTransaction=function(a,b,c){var d=new ef(this.db,a,b),e=Bc(c(d).catch(function(a){d.abort();return Cc(a)}));return d.completionPromise.then(function(){return e})};bf.prototype.close=function(){this.db.close()};var ff=function(a){this.dbCursor=a;this.shouldStop=!1;this.nextKey=null};ff.prototype.done=function(){this.shouldStop=!0};ff.prototype.delete=function(){return gf(this.dbCursor.delete())};
k.Object.defineProperties(ff.prototype,{isDone:{configurable:!0,enumerable:!0,get:function(){return this.shouldStop}},skipToKey:{configurable:!0,enumerable:!0,get:function(){return this.nextKey}},cursor:{configurable:!0,enumerable:!0,set:function(a){this.dbCursor=a}}});var ef=function(a,b,c){var d=this;this.aborted=!1;this.transaction=a.transaction(c,b);this.completionPromise=new Promise(function(a,b){d.transaction.onabort=d.transaction.oncomplete=function(){a()};d.transaction.onerror=function(a){b(a.target.error)}})};
ef.prototype.abort=function(){this.aborted||(w("SimpleDb","Aborting transaction."),this.aborted=!0,this.transaction.abort())};ef.prototype.store=function(a){var b=this.transaction.objectStore(a);z(!!b,"Object store not part of transaction: "+a);return new hf(b)};var hf=function(a){this.store=a};hf.prototype.put=function(a,b){void 0!==b?(w("SimpleDb","PUT",this.store.name,a,b),a=this.store.put(b,a)):(w("SimpleDb","PUT",this.store.name,"<auto-key>",a),a=this.store.put(a));return gf(a)};
hf.prototype.get=function(a){var b=this,c=this.store.get(a);return gf(c).next(function(c){void 0===c&&(c=null);w("SimpleDb","GET",b.store.name,a,c);return c})};hf.prototype.delete=function(a){w("SimpleDb","DELETE",this.store.name,a);a=this.store.delete(a);return gf(a)};
var kf=function(a,b){a=a.cursor(a.options(b,void 0));var c=[];return jf(a,function(a,b){c.push(b)}).next(function(){return c})},lf=function(a,b,c){if(c)var d=b;else d={},c=b;a=a.cursor(d);return jf(a,c)},jf=function(a,b){var c=[];return(new yc(function(d,e){a.onerror=function(a){e(a.target.error)};a.onsuccess=function(a){if(a=a.target.result){var e=new ff(a),f=b(a.primaryKey,a.value,e);f instanceof yc&&c.push(f);e.isDone?d():null===e.skipToKey?a.continue():a.continue(e.skipToKey)}else d()}})).next(function(){return Ec(c)})};
hf.prototype.options=function(a,b){var c=void 0;void 0!==a&&("string"===typeof a?c=a:(z(void 0===b,"3rd argument must not be defined if 2nd is a range."),b=a));return{index:c,range:b}};hf.prototype.cursor=function(a){var b="next";a.reverse&&(b="prev");if(a.index){var c=this.store.index(a.index);return a.keysOnly?c.openKeyCursor(a.range,b):c.openCursor(a.range,b)}return this.store.openCursor(a.range,b)};
function gf(a){return new yc(function(b,c){a.onsuccess=function(a){b(a.target.result)};a.onerror=function(a){c(a.target.error)}})};var mf=function(a,b){this.userId=a;this.serializer=b;this.garbageCollector=null};
mf.prototype.start=function(a){var b=this;return nf(a).next(function(c){b.nextBatchId=c;return N(a,"mutationQueues").get(b.userId)}).next(function(c){c||(c=new Oe(b.userId));b.metadata=c;return b.metadata.lastAcknowledgedBatchId>=b.nextBatchId?b.checkEmpty(a).next(function(c){z(c,"Reset nextBatchID is only possible when the queue is empty");b.metadata.lastAcknowledgedBatchId=-1;return N(a,"mutationQueues").put(b.metadata)}):I()})};
var nf=function(a){var b=-1;return lf(N(a,"mutations"),{reverse:!0},function(a,d,e){var c=m(a);a=c.next().value;c.next().value>b&&(b=d.batchId);""===a?e.done():(d=a.length-1,e.nextKey=[0===a.length?"":"\x00"===a.charAt(d)?a.substring(0,d):a.substring(0,d)+String.fromCharCode(a.charCodeAt(d)-1)])}).next(function(){return b+1})};g=mf.prototype;
g.checkEmpty=function(a){var b=!0,c=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return lf(N(a,"mutations"),{range:c},function(a,c,f){b=!1;f.done()}).next(function(){return b})};g.getHighestAcknowledgedBatchId=function(){return I(this.metadata.lastAcknowledgedBatchId)};
g.acknowledgeBatch=function(a,b,c){b=b.batchId;z(b>this.metadata.lastAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order");this.metadata.lastAcknowledgedBatchId=b;this.metadata.lastStreamToken=of(c);return N(a,"mutationQueues").put(this.metadata)};g.getLastStreamToken=function(){return I(this.metadata.lastStreamToken)};g.setLastStreamToken=function(a,b){this.metadata.lastStreamToken=of(b);return N(a,"mutationQueues").put(this.metadata)};
g.addMutationBatch=function(a,b,c){var d=this,e=this.nextBatchId;this.nextBatchId++;var f=new He(e,b,c);b=pf(this.serializer,this.userId,f);return N(a,"mutations").put(b).next(function(){for(var b=m(c),f=b.next();!f.done;f=b.next())f=f.value,Ke(f.key.path),f=Re(d.userId,f.key.path,e),N(a,"documentMutations").put(f,Se);return Ec([])}).next(function(){return f})};
g.lookupMutationBatch=function(a,b){var c=this;return N(a,"mutations").get([this.userId,b]).next(function(a){return a?qf(c.serializer,a):null})};g.getNextMutationBatchAfterBatchId=function(a,b){var c=this,d=IDBKeyRange.lowerBound([this.userId,b+1]),e=null;return lf(N(a,"mutations"),{range:d},function(a,d,l){d.userId===c.userId&&(z(d.batchId>b,"Should have found mutation after "+b),e=qf(c.serializer,d));l.done()}).next(function(){return e})};
g.getAllMutationBatches=function(a){var b=this,c=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return kf(N(a,"mutations"),c).next(function(a){return a.map(function(a){return qf(b.serializer,a)})})};g.getAllMutationBatchesThroughBatchId=function(a,b){var c=this;b=IDBKeyRange.bound([this.userId,-1],[this.userId,b]);return kf(N(a,"mutations"),b).next(function(a){return a.map(function(a){return qf(c.serializer,a)})})};
g.getAllMutationBatchesAffectingDocumentKey=function(a,b){var c=this,d=[this.userId,Ke(b.path)];d=IDBKeyRange.lowerBound(d);var e=[];return lf(N(a,"documentMutations"),{range:d},function(d,h,l){var f=m(d),y=f.next().value,C=f.next().value;f=f.next().value;C=Le(C);if(y===c.userId&&b.path.equals(C)){var nb=[c.userId,f];return N(a,"mutations").get(nb).next(function(a){null===a&&x("Dangling document-mutation reference found: "+d+" which points to "+nb);e.push(qf(c.serializer,a))})}l.done()}).next(function(){return e})};
g.getAllMutationBatchesAffectingQuery=function(a,b){var c=this;z(!Od(b),"Document queries shouldn't go down this path");var d=b.path,e=d.length+1;b=[this.userId,Ke(d)];b=IDBKeyRange.lowerBound(b);var f=new G(E);return lf(N(a,"documentMutations"),{range:b},function(a,b,t){var h=m(a);a=h.next().value;var l=h.next().value;h=h.next().value;l=Le(l);a===c.userId&&Fb(d,l)?l.length===e&&(f=f.add(h)):t.done()}).next(function(){var b=[],d=[];f.forEach(function(e){var f=[c.userId,e];d.push(N(a,"mutations").get(f).next(function(a){null===
a&&x("Dangling document-mutation reference found, which points to "+f);b.push(qf(c.serializer,a))}))});return Ec(d).next(function(){return b})})};
g.removeMutationBatches=function(a,b){var c=N(a,"mutations");a=N(a,"documentMutations");var d=[],e={};b=m(b);for(var f=b.next();!f.done;e={numDeleted:e.numDeleted,batch:e.batch},f=b.next()){e.batch=f.value;f=IDBKeyRange.only([this.userId,e.batch.batchId]);e.numDeleted=0;f=lf(c,{range:f},function(a){return function(b,c,d){a.numDeleted++;return d.delete()}}(e));d.push(f.next(function(a){return function(){z(1===a.numDeleted,"Dangling document-mutation reference found: Missing batch "+a.batch.batchId)}}(e)));
f=m(e.batch.mutations);for(var h=f.next();!h.done;h=f.next()){h=h.value;var l=Re(this.userId,h.key.path,e.batch.batchId);d.push(a.delete(l));null!==this.garbageCollector&&this.garbageCollector.addPotentialGarbageKey(h.key)}}return Ec(d)};
g.performConsistencyCheck=function(a){var b=this;return this.checkEmpty(a).next(function(c){if(!c)return I();c=IDBKeyRange.lowerBound([b.userId]);var d=[];return lf(N(a,"documentMutations"),{range:c},function(a,c,h){a[0]!==b.userId?h.done():(a=Le(a[1]),d.push(a))}).next(function(){z(0===d.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+d.map(function(a){return a.canonicalString()}))})})};g.setGarbageCollector=function(a){this.garbageCollector=a};
g.containsKey=function(a,b){var c=this;b=[this.userId,Ke(b.path)];var d=b[1];b=IDBKeyRange.lowerBound(b);var e=!1;return lf(N(a,"documentMutations"),{range:b,keysOnly:!0},function(a,b,l){a=m(a);var f=a.next().value,h=a.next().value;a.next();f===c.userId&&h===d&&(e=!0);l.done()}).next(function(){return e})};function of(a){z("string"===typeof a,"Persisting non-string stream token not supported.");return a}function N(a,b){return a instanceof ef?a.store(b):x("Invalid transaction object provided!")};var rf=function(a){this.serializer=a;this.lastRemoteSnapshotVersion=J;this.metadata=new $e;this.garbageCollector=null};g=rf.prototype;g.start=function(a){var b=this;return sf(a,"targetGlobal").get("targetGlobalKey").next(function(a){null!==a&&(b.metadata=a,a=a.lastRemoteSnapshotVersion,b.lastRemoteSnapshotVersion=new Nc(new Kc(a.seconds,a.nanos)));return I()})};g.getHighestTargetId=function(){return this.metadata.highestTargetId};g.getLastRemoteSnapshotVersion=function(){return this.lastRemoteSnapshotVersion};
g.setLastRemoteSnapshotVersion=function(a,b){this.lastRemoteSnapshotVersion=b;this.metadata.lastRemoteSnapshotVersion=b.toTimestamp();return sf(a,"targetGlobal").put("targetGlobalKey",this.metadata)};g.addQueryData=function(a,b){var c=this,d=b.targetId;b=sf(a,"targets").put(tf(this.serializer,b));return d>this.metadata.highestTargetId?(this.metadata.highestTargetId=d,b.next(function(){return sf(a,"targetGlobal").put("targetGlobalKey",c.metadata)})):b};
g.removeQueryData=function(a,b){return this.removeMatchingKeysForTargetId(a,b.targetId).next(function(){sf(a,"targets").delete(b.targetId)})};
g.getQueryData=function(a,b){var c=this,d=b.canonicalId();d=IDBKeyRange.bound([d,Number.NEGATIVE_INFINITY],[d,Number.POSITIVE_INFINITY]);var e=null;return lf(sf(a,"targets"),{range:d,index:"queryTargetsIndex"},function(a,d,l){var f=c.serializer;a=new Kc(d.readTime.seconds,d.readTime.nanos);a=new Nc(a);if(void 0!==d.query.documents){f=d.query;var h=f.documents.length;z(1===h,"DocumentsTarget contained other than 1 document: "+h);f=new Fd(uf(f.documents[0]))}else{f=f.remoteSerializer;var C=d.query;
h=uf(C.parent);C=C.structuredQuery;var nb=C.from?C.from.length:0;0<nb&&(z(1===nb,"StructuredQuery.from with more than one collection is not supported."),h=h.child(C.from[0].collectionId));nb=[];C.where&&(nb=vf(f,C.where));var Jd=[];C.orderBy&&(Jd=wf(C.orderBy));var gh=null;C.limit&&(gh=C.limit);var hh=null;C.startAt&&(hh=xf(f,C.startAt));var Jc=null;C.endAt&&(Jc=xf(f,C.endAt));f=new Fd(h,Jd,nb,gh,hh,Jc)}d=new Oc(f,d.targetId,a,d.resumeToken);b.equals(d.query)&&(e=d,l.done())}).next(function(){return e})};
g.addMatchingKeys=function(a,b,c){var d=[],e=sf(a,"targetDocuments");b.forEach(function(a){a=Ke(a.path);d.push(e.put(new Xe(c,a)))});return Ec(d)};g.removeMatchingKeys=function(a,b,c){var d=this,e=[],f=sf(a,"targetDocuments");b.forEach(function(a){var b=Ke(a.path);e.push(f.delete([c,b]));null!==d.garbageCollector&&d.garbageCollector.addPotentialGarbageKey(a)});return Ec(e)};
g.removeMatchingKeysForTargetId=function(a,b){var c=sf(a,"targetDocuments"),d=IDBKeyRange.bound([b],[b+1],!1,!0);return yf(this,a,d).next(function(){return c.delete(d)})};var yf=function(a,b,c){b=sf(b,"targetDocuments");return null!==a.garbageCollector&&a.garbageCollector.isEager?lf(b,{range:c,keysOnly:!0},function(b){b=Le(b[1]);b=new F(b);z(null!==a.garbageCollector,"GarbageCollector for query cache set to null during key removal.");a.garbageCollector.addPotentialGarbageKey(b)}):I()};
rf.prototype.getMatchingKeysForTargetId=function(a,b){b=IDBKeyRange.bound([b],[b+1],!1,!0);a=sf(a,"targetDocuments");var c=H;return lf(a,{range:b,keysOnly:!0},function(a){a=Le(a[1]);a=new F(a);c=c.add(a)}).next(function(){return c})};rf.prototype.setGarbageCollector=function(a){this.garbageCollector=a};
rf.prototype.containsKey=function(a,b){z(null!==a,"Persistence Transaction cannot be null for query cache containsKey");b=Ke(b.path);b=IDBKeyRange.bound([b],[b+"\x00"],!1,!0);var c=0;return lf(sf(a,"targetDocuments"),{index:"documentTargetsIndex",keysOnly:!0,range:b},function(a,b,f){c++;f.done()}).next(function(){return 0<c})};function sf(a,b){return a instanceof ef?a.store(b):x("Invalid transaction object provided!")};var zf=function(a){this.serializer=a};zf.prototype.addEntry=function(a,b){return Af(a).put(Gb(b.key.path),Bf(this.serializer,b))};zf.prototype.removeEntry=function(a,b){return Af(a).delete(Gb(b.path))};zf.prototype.getEntry=function(a,b){var c=this;return Af(a).get(Gb(b.path)).next(function(a){return a?Cf(c.serializer,a):null})};
zf.prototype.getDocumentsMatchingQuery=function(a,b){var c=this,d=nc,e=Gb(b.path);e=IDBKeyRange.lowerBound(e);return lf(Af(a),{range:e},function(a,e,l){a=Cf(c.serializer,e);Fb(b.path,a.key.path)?a instanceof K&&b.matches(a)&&(d=d.insert(a.key,a)):l.done()}).next(function(){return d})};function Af(a){return a instanceof ef?a.store("remoteDocuments"):x("Invalid transaction object provided!")};var Df=function(a){this.remoteSerializer=a},Cf=function(a,b){return b.document?(a=a.remoteSerializer,b=b.document,new K(Ef(a,b.name),Ff(b.updateTime),Gf(a,b.fields||{}),{hasLocalMutations:!1})):b.noDocument?(a=new F(new Hb(b.noDocument.path.slice())),b=b.noDocument.readTime,b=new Kc(b.seconds,b.nanos),new L(a,new Nc(b))):x("Unexpected DbRemoteDocument")},Bf=function(a,b){if(b instanceof K)return a=a.remoteSerializer,z(!b.hasLocalMutations,"Can't serialize documents with mutations."),b={name:Hf(a.databaseId,
b.key.path),fields:If(a,b.data),updateTime:a.toTimestamp(b.version.toTimestamp())},new Ue(null,b);a=Gb(b.key.path);b=b.version.toTimestamp();return new Ue(new Te(a,new Me(b.seconds,b.nanos)),null)},pf=function(a,b,c){var d=c.mutations.map(function(b){return Jf(a.remoteSerializer,b)});return new Pe(b,c.batchId,Mc(c.localWriteTime),d)},qf=function(a,b){var c=b.mutations.map(function(b){return Kf(a.remoteSerializer,b)}),d=Lc(b.localWriteTimeMs);return new He(b.batchId,d,c)},tf=function(a,b){var c=b.snapshotVersion.toTimestamp();
c=new Me(c.seconds,c.nanos);a=Od(b.query)?{documents:[Lf(a.remoteSerializer,b.query.path)]}:Mf(a.remoteSerializer,b.query);z("string"===typeof b.resumeToken,"Persisting non-string resume token not supported.");var d=b.resumeToken;return new Ve(b.targetId,b.query.canonicalId(),c,d,a)};var Nf=function(a,b){this.ownerId=cb();this.dbName=a+"main";this.serializer=new Df(b);this.localStoragePrefix=a};g=Nf.prototype;g.start=function(){var a=this;z(!this.started,"IndexedDbPersistence double-started!");this.started=!0;return df(this.dbName).then(function(b){a.simpleDb=b}).then(function(){return Of(a)}).then(function(){Pf(a);Qf(a)})};
g.shutdown=function(){var a=this;z(this.started,"IndexedDbPersistence shutdown without start!");this.started=!1;this.windowUnloadHandler&&(window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null);this.ownerLeaseRefreshHandle&&(clearInterval(this.ownerLeaseRefreshHandle),this.ownerLeaseRefreshHandle=null);return Rf(this).then(function(){a.simpleDb.close()})};
g.getMutationQueue=function(a){var b=this.serializer;z(""!==a.uid,"UserID must not be an empty string.");return new mf(null==a.uid?"":a.uid,b)};g.getQueryCache=function(){return new rf(this.serializer)};g.getRemoteDocumentCache=function(){return new zf(this.serializer)};
g.runTransaction=function(a,b){var c=this;if(this.persistenceError)return Promise.reject(this.persistenceError);w("IndexedDbPersistence","Starting transaction:",a);return this.simpleDb.runTransaction("readwrite",af,function(a){return Sf(c,a).next(function(){return b(a)})})};
var Tf=function(a){var b=a.databaseId.projectId;a.databaseId.isDefaultDatabase||(b+="."+a.databaseId.database);return"firestore/"+a.persistenceKey+"/"+b+"/"},Of=function(a){return a.simpleDb.runTransaction("readwrite",["owner"],function(b){var c=b.store("owner");return c.get("owner").next(function(b){var d=Date.now();if(null===b||b.leaseTimestampMs<d-5E3)var f=!1;else if(b.leaseTimestampMs>d)Ia("Persistence owner-lease is in the future. Discarding.",b),f=!1;else{d=b.ownerId;try{var h=window.localStorage.getItem(Uf(a));
w("IndexedDbPersistence","Zombied ownerID from LocalStorage:",h);f=h}catch(l){Ia("IndexedDbPersistence","Failed to get zombie owner id.",l),f=null}f=d===f?!1:!0}if(f)return w("IndexedDbPersistence","Valid owner already. Failing. Current owner:",b),a.persistenceError=new A("failed-precondition","There is another tab open with offline persistence enabled. Only one such tab is allowed at a time. The other tab must be closed or persistence must be disabled."),Cc(a.persistenceError);f=new Ne(a.ownerId);
w("IndexedDbPersistence","No valid owner. Acquiring owner lease. Current owner:",b,"New owner:",f);return c.put("owner",f)})})},Rf=function(a){return a.simpleDb.runTransaction("readwrite",["owner"],function(b){var c=b.store("owner");return c.get("owner").next(function(b){return null!==b&&b.ownerId===a.ownerId?(w("IndexedDbPersistence","Releasing owner lease."),c.delete("owner")):I()})})},Sf=function(a,b){return b.store("owner").get("owner").next(function(b){return null===b||b.ownerId!==a.ownerId?
(a.persistenceError=new A("failed-precondition","There is another tab open with offline persistence enabled. Only one such tab is allowed at a time. The other tab must be closed or persistence must be disabled."),Cc(a.persistenceError)):I()})},Pf=function(a){a.ownerLeaseRefreshHandle=setInterval(function(){a.runTransaction("Refresh owner timestamp",function(b){return b.store("owner").put("owner",new Ne(a.ownerId))}).catch(function(b){Ia(b);a.ownerLeaseRefreshHandle&&(clearInterval(a.ownerLeaseRefreshHandle),
a.ownerLeaseRefreshHandle=null)})},4E3)},Qf=function(a){a.windowUnloadHandler=function(){var b=a.ownerId;try{null===b?window.localStorage.removeItem(Uf(a)):window.localStorage.setItem(Uf(a),b)}catch(c){Ia("IndexedDbPersistence","Failed to set zombie owner id.",c)}a.shutdown()};window.addEventListener("unload",a.windowUnloadHandler)},Uf=function(a){return a.localStoragePrefix+"zombiedOwnerId"};var Vf=function(a,b){this.remoteDocumentCache=a;this.mutationQueue=b},Xf=function(a,b,c){return a.remoteDocumentCache.getEntry(b,c).next(function(d){return Wf(a,b,c,d)})},Yf=function(a,b,c){var d=[],e=mc;c.forEach(function(c){d.push(Xf(a,b,c).next(function(a){a||(a=new L(c,J));e=e.insert(c,a)}))});return Ec(d).next(function(){return e})};Vf.prototype.getDocumentsMatchingQuery=function(a,b){return 0===b.path.length%2?Zf(this,a,b.path):$f(this,a,b)};
var Zf=function(a,b,c){return Xf(a,b,new F(c)).next(function(a){var b=nc;a instanceof K&&(b=b.insert(a.key,a));return b})},$f=function(a,b,c){var d;return a.remoteDocumentCache.getDocumentsMatchingQuery(b,c).next(function(c){return ag(a,b,c)}).next(function(e){d=e;return a.mutationQueue.getAllMutationBatchesAffectingQuery(b,c)}).next(function(c){var e=H;c=m(c);for(var h=c.next();!h.done;h=c.next()){h=m(h.value.mutations);for(var l=h.next();!l.done;l=h.next())l=l.value,d.get(l.key)||(e=e.add(l.key))}var t=
[];e.forEach(function(c){t.push(Xf(a,b,c).next(function(a){a instanceof K&&(d=d.insert(a.key,a))}))});return Ec(t)}).next(function(){d.forEach(function(a,b){c.matches(b)||(d=d.remove(a))});return d})},Wf=function(a,b,c,d){return a.mutationQueue.getAllMutationBatchesAffectingDocumentKey(b,c).next(function(a){a=m(a);for(var b=a.next();!b.done;b=a.next())d=b.value.applyTo(c,d);return d})},ag=function(a,b,c){var d=[];c.forEach(function(e,f){d.push(Wf(a,b,e,f).next(function(a){a instanceof L?c=c.remove(a.key):
a instanceof K?c=c.insert(a.key,a):x("Unknown MaybeDocument: "+a)}))});return Ec(d).next(function(){return c})};var bg=function(a){this.remoteDocumentCache=a;this.changes=mc};bg.prototype.addEntry=function(a){this.changes=cg(this).insert(a.key,a)};bg.prototype.getEntry=function(a,b){var c=cg(this).get(b);return c?I(c):this.remoteDocumentCache.getEntry(a,b)};bg.prototype.apply=function(a){var b=this,c=[];cg(this).forEach(function(d,e){c.push(b.remoteDocumentCache.addEntry(a,e))});this.changes=null;return Ec(c)};var cg=function(a){z(null!==a.changes,"Changes have already been applied.");return a.changes};var dg=function(a,b,c){this.persistence=a;this.garbageCollector=c;this.localViewReferences=new Rc;this.targetIds={};this.targetIdGenerator=fe();this.heldBatchResults=[];this.mutationQueue=a.getMutationQueue(b);this.remoteDocuments=a.getRemoteDocumentCache();this.queryCache=a.getQueryCache();this.localDocuments=new Vf(this.remoteDocuments,this.mutationQueue);this.garbageCollector.addGarbageSource(this.localViewReferences);this.garbageCollector.addGarbageSource(this.queryCache);this.garbageCollector.addGarbageSource(this.mutationQueue)};
dg.prototype.start=function(){var a=this;return this.persistence.runTransaction("Start LocalStore",function(b){return eg(a,b).next(function(){return fg(a,b)})})};
dg.prototype.handleUserChange=function(a){var b=this;return this.persistence.runTransaction("Handle user change",function(c){var d;return b.mutationQueue.getAllMutationBatches(c).next(function(e){d=e;b.garbageCollector.removeGarbageSource(b.mutationQueue);b.mutationQueue=b.persistence.getMutationQueue(a);b.garbageCollector.addGarbageSource(b.mutationQueue);return eg(b,c)}).next(function(){b.localDocuments=new Vf(b.remoteDocuments,b.mutationQueue);return b.mutationQueue.getAllMutationBatches(c)}).next(function(a){var e=
H;a=m([d,a]);for(var h=a.next();!h.done;h=a.next()){h=m(h.value);for(var l=h.next();!l.done;l=h.next()){l=m(l.value.mutations);for(var t=l.next();!t.done;t=l.next())e=e.add(t.value.key)}}return Yf(b.localDocuments,c,e)})})};
var fg=function(a,b){return a.queryCache.start(b).next(function(){a.targetIdGenerator=fe(a.queryCache.getHighestTargetId())})},eg=function(a,b){return a.mutationQueue.start(b).next(function(){a.heldBatchResults=[];return a.mutationQueue.getHighestAcknowledgedBatchId(b)}).next(function(c){return-1!==c?a.mutationQueue.getAllMutationBatchesThroughBatchId(b,c):I([])}).next(function(c){return 0<c.length?a.mutationQueue.removeMutationBatches(b,c):I()})},ve=function(a,b){return a.persistence.runTransaction("Locally write mutations",
function(c){var d,e=Lc(Date.now());return a.mutationQueue.addMutationBatch(c,e,b).next(function(b){d=b;b=d.keys();return Yf(a.localDocuments,c,b)}).next(function(a){return{batchId:d.batchId,changes:a}})})};
dg.prototype.acknowledgeBatch=function(a){var b=this;return this.persistence.runTransaction("Acknowledge batch",function(c){var d;return b.mutationQueue.acknowledgeBatch(c,a.batch,a.streamToken).next(function(){if(!(0>=a.commitVersion.compareTo(b.queryCache.getLastRemoteSnapshotVersion())||Pa(b.targetIds))||0<b.heldBatchResults.length)return b.heldBatchResults.push(a),d=H,I();var e=new bg(b.remoteDocuments);return gg(b,c,[a],e).next(function(a){d=a;return e.apply(c)})}).next(function(){return b.mutationQueue.performConsistencyCheck(c)}).next(function(){return Yf(b.localDocuments,
c,d)})})};
var Ce=function(a,b){return a.persistence.runTransaction("Reject batch",function(c){var d,e;return a.mutationQueue.lookupMutationBatch(c,b).next(function(e){z(null!=e,"Attempt to reject nonexistent batch!");d=e;return a.mutationQueue.getHighestAcknowledgedBatchId(c).next(function(a){z(b>a,"Acknowledged batches can't be rejected.");return d})}).next(function(){return a.removeMutationBatches(c,[d])}).next(function(b){e=b;return a.mutationQueue.performConsistencyCheck(c)}).next(function(){return Yf(a.localDocuments,c,
e)})})};dg.prototype.getLastStreamToken=function(){var a=this;return this.persistence.runTransaction("Get last stream token",function(b){return a.mutationQueue.getLastStreamToken(b)})};dg.prototype.setLastStreamToken=function(a){var b=this;return this.persistence.runTransaction("Set last stream token",function(c){return b.mutationQueue.setLastStreamToken(c,a)})};dg.prototype.getLastRemoteSnapshotVersion=function(){return this.queryCache.getLastRemoteSnapshotVersion()};
dg.prototype.applyRemoteEvent=function(a){var b=this,c=new bg(this.remoteDocuments);return this.persistence.runTransaction("Apply remote event",function(d){var e=[];Na(a.targetChanges,function(a,c){var f=b.targetIds[a];if(f){var h=c.mapping;if(h)if(h instanceof ad)e.push(b.queryCache.removeMatchingKeysForTargetId(d,a).next(function(){return b.queryCache.addMatchingKeys(d,h.documents,a)}));else if(h instanceof bd)e.push(b.queryCache.removeMatchingKeys(d,h.removedDocuments,a).next(function(){return b.queryCache.addMatchingKeys(d,
h.addedDocuments,a)}));else return x("Unknown mapping type: "+JSON.stringify(h));var l=c.resumeToken;0<l.length&&(f=f.update({resumeToken:l,snapshotVersion:c.snapshotVersion}),b.targetIds[a]=f,e.push(b.queryCache.addQueryData(d,f)))}});var f=H;a.documentUpdates.forEach(function(a,h){f=f.add(a);e.push(c.getEntry(d,a).next(function(d){null==d||h.version.equals(J)||0<=h.version.compareTo(d.version)?c.addEntry(h):w("LocalStore","Ignoring outdated watch update for ",a,". Current version:",d.version," Watch version:",
h.version);b.garbageCollector.addPotentialGarbageKey(a)}))});var h=b.queryCache.getLastRemoteSnapshotVersion(),l=a.snapshotVersion;l.equals(J)||(z(0<=l.compareTo(h),"Watch stream reverted to previous snapshot?? "+l+" < "+h),e.push(b.queryCache.setLastRemoteSnapshotVersion(d,l)));var t;return Ec(e).next(function(){return hg(b,d,c)}).next(function(a){t=a;return c.apply(d)}).next(function(){return Yf(b.localDocuments,d,lc(f,t))})})};
var Ge=function(a,b){return a.persistence.runTransaction("Notify local view changes",function(c){for(var d=[],e={},f=m(b),h=f.next();!h.done;e={view:e.view},h=f.next())e.view=h.value,d.push(a.queryCache.getQueryData(c,e.view.query).next(function(b){return function(c){z(null!==c,"Local view changes contain unallocated query.");c=c.targetId;Uc(a.localViewReferences,b.view.addedKeys,c);Wc(a.localViewReferences,b.view.removedKeys,c)}}(e)));return Ec(d)})},ig=function(a,b){return a.persistence.runTransaction("Get next mutation batch",
function(c){void 0===b&&(b=-1);return a.mutationQueue.getNextMutationBatchAfterBatchId(c,b)})},qe=function(a,b){return a.persistence.runTransaction("Allocate query",function(c){var d;return a.queryCache.getQueryData(c,b).next(function(e){if(e)return d=e,I();e=a.targetIdGenerator.next();d=new Oc(b,e);return a.queryCache.addQueryData(c,d)}).next(function(){z(!a.targetIds[d.targetId],"Tried to allocate an already allocated query: "+b);return a.targetIds[d.targetId]=d})})},te=function(a,b){return a.persistence.runTransaction("Release query",
function(c){return a.queryCache.getQueryData(c,b).next(function(d){z(null!=d,"Tried to release nonexistent query: "+b);Xc(a.localViewReferences,d.targetId);delete a.targetIds[d.targetId];return a.garbageCollector.isEager?a.queryCache.removeQueryData(c,d):I()}).next(function(){if(Pa(a.targetIds)){var b=new bg(a.remoteDocuments);return hg(a,c,b).next(function(){b.apply(c)})}return I()})})},re=function(a,b){return a.persistence.runTransaction("Execute query",function(c){return a.localDocuments.getDocumentsMatchingQuery(c,
b)})},se=function(a,b){return a.persistence.runTransaction("Remote document keys",function(c){return a.queryCache.getMatchingKeysForTargetId(c,b)})};dg.prototype.collectGarbage=function(){var a=this;return this.persistence.runTransaction("Garbage collection",function(b){return a.garbageCollector.collectGarbage(b).next(function(c){var d=[];c.forEach(function(c){d.push(a.remoteDocuments.removeEntry(b,c))});return Ec(d)})})};
var hg=function(a,b,c){for(var d=[],e=m(a.heldBatchResults),f=e.next();!f.done;f=e.next()){f=f.value;var h=a;if(!(0>=f.commitVersion.compareTo(h.queryCache.getLastRemoteSnapshotVersion())||Pa(h.targetIds)))break;d.push(f)}if(0===d.length)return I(H);a.heldBatchResults.splice(0,d.length);return gg(a,b,d,c)},gg=function(a,b,c,d){for(var e=I(),f={},h=m(c),l=h.next();!l.done;f={batchResult:f.batchResult},l=h.next())f.batchResult=l.value,e=e.next(function(a){return function(){return jg(b,a.batchResult,
d)}}(f));return e.next(function(){return a.removeMutationBatches(b,c.map(function(a){return a.batch}))})};dg.prototype.removeMutationBatches=function(a,b){for(var c=H,d=m(b),e=d.next();!e.done;e=d.next()){e=m(e.value.mutations);for(var f=e.next();!f.done;f=e.next())c=c.add(f.value.key)}return this.mutationQueue.removeMutationBatches(a,b).next(function(){return c})};
var jg=function(a,b,c){var d=b.batch,e=d.keys(),f=I();e.forEach(function(e){f=f.next(function(){return c.getEntry(a,e)}).next(function(a){var f=a,h=b.docVersions.get(e);z(null!==h,"ackVersions should contain every doc in the write.");if(!f||0>f.version.compareTo(h))(f=d.applyTo(e,f,b))?c.addEntry(f):z(!a,"Mutation batch "+d+" applied to document "+a+" resulted in null")})});return f};var kg=function(){this.mutationQueue=[];this.nextBatchId=1;this.highestAcknowledgedBatchId=-1;this.lastStreamToken=Ka().emptyByteString;this.garbageCollector=null;this.batchesByDocumentKey=new G(Pc)};g=kg.prototype;g.start=function(){0===this.mutationQueue.length&&(this.nextBatchId=1,this.highestAcknowledgedBatchId=-1);z(this.highestAcknowledgedBatchId<this.nextBatchId,"highestAcknowledgedBatchId must be less than the nextBatchId");return I()};g.checkEmpty=function(){return I(0===this.mutationQueue.length)};
g.getHighestAcknowledgedBatchId=function(){return I(this.highestAcknowledgedBatchId)};g.acknowledgeBatch=function(a,b,c){a=b.batchId;z(a>this.highestAcknowledgedBatchId,"Mutation batchIDs must be acknowledged in order");b=lg(this,a,"acknowledged");b=this.mutationQueue[b];z(a===b.batchId,"Queue ordering failure: expected batch "+a+", got batch "+b.batchId);z(0!==b.mutations.length,"Can't acknowledge a previously removed batch");this.highestAcknowledgedBatchId=a;this.lastStreamToken=c;return I()};
g.getLastStreamToken=function(){return I(this.lastStreamToken)};g.setLastStreamToken=function(a,b){this.lastStreamToken=b;return I()};
g.addMutationBatch=function(a,b,c){z(0!==c.length,"Mutation batches should not be empty");a=this.nextBatchId;this.nextBatchId++;0<this.mutationQueue.length&&z(this.mutationQueue[this.mutationQueue.length-1].batchId<a,"Mutation batchIDs must be monotonically increasing order");b=new He(a,b,c);this.mutationQueue.push(b);c=m(c);for(var d=c.next();!d.done;d=c.next())this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Sc(d.value.key,a));return I(b)};
g.lookupMutationBatch=function(a,b){return I(mg(this,b))};g.getNextMutationBatchAfterBatchId=function(a,b){a=this.mutationQueue.length;b=Math.max(b+1,this.highestAcknowledgedBatchId);b=ng(this,b);for(b=0>b?0:b;b<a;b++){var c=this.mutationQueue[b];if(0!==c.mutations.length)return I(c)}return I(null)};g.getAllMutationBatches=function(){return I(og(this,this.mutationQueue.length))};
g.getAllMutationBatchesThroughBatchId=function(a,b){a=this.mutationQueue.length;b=ng(this,b);0>b?b=0:b>=a?b=a:b++;return I(og(this,b))};g.getAllMutationBatchesAffectingDocumentKey=function(a,b){var c=this,d=[];ic(this.batchesByDocumentKey,[new Sc(b,0),new Sc(b,Number.POSITIVE_INFINITY)],function(a){z(b.equals(a.key),"Should only iterate over a single key's batches");a=mg(c,a.targetOrBatchId);z(null!==a,"Batches in the index must exist in the main table");d.push(a)});return I(d)};
g.getAllMutationBatchesAffectingQuery=function(a,b){var c=this,d=b.path,e=d.length+1;a=d;0===a.length%2||(a=a.child(""));a=new Sc(new F(a),0);var f=new G(E);jc(this.batchesByDocumentKey,function(a){var b=a.key.path;return Fb(d,b)?(b.length===e&&(f=f.add(a.targetOrBatchId)),!0):!1},a);var h=[];f.forEach(function(a){a=mg(c,a);null!==a&&h.push(a)});return I(h)};
g.removeMutationBatches=function(a,b){var c=b.length;z(0<c,"Should not remove mutations when none exist.");a=b[0].batchId;var d=this.mutationQueue.length,e=lg(this,a,"removed");z(this.mutationQueue[e].batchId===a,"Removed batches must exist in the queue");var f=1;for(a=e+1;f<c&&a<d;){var h=this.mutationQueue[a];0!==h.mutations.length&&(z(h.batchId===b[f].batchId,"Removed batches must be contiguous in the queue"),f++);a++}if(0===e){for(;a<d&&0===this.mutationQueue[a].mutations.length;a++);this.mutationQueue.splice(e,
a-e)}else for(c=e;c<a;c++)d=this.mutationQueue[c],this.mutationQueue[c]=new He(d.batchId,d.localWriteTime,[]);a=this.batchesByDocumentKey;b=m(b);for(c=b.next();!c.done;c=b.next())for(d=c.value,c=d.batchId,d=m(d.mutations),e=d.next();!e.done;e=d.next())e=e.value.key,null!==this.garbageCollector&&this.garbageCollector.addPotentialGarbageKey(e),a=a.delete(new Sc(e,c));this.batchesByDocumentKey=a;return I()};g.setGarbageCollector=function(a){this.garbageCollector=a};
g.containsKey=function(a,b){a=kc(this.batchesByDocumentKey,new Sc(b,0));return I(b.equals(a&&a.key))};g.performConsistencyCheck=function(){0===this.mutationQueue.length&&z(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty.");return I()};
var og=function(a,b){for(var c=[],d=0;d<b;d++){var e=a.mutationQueue[d];0===e.mutations.length||c.push(e)}return c},lg=function(a,b,c){b=ng(a,b);z(0<=b&&b<a.mutationQueue.length,"Batches must exist to be "+c);return b},ng=function(a,b){return 0===a.mutationQueue.length?0:b-a.mutationQueue[0].batchId},mg=function(a,b){var c=ng(a,b);if(0>c||c>=a.mutationQueue.length)return null;a=a.mutationQueue[c];z(a.batchId===b,"If found batch must match");return 0===a.mutations.length?null:a};var pg=function(){this.queries=new qc(function(a){return a.canonicalId()});this.lastRemoteSnapshotVersion=J;this.highestTargetId=0;this.references=new Rc};g=pg.prototype;g.start=function(){return I()};g.getLastRemoteSnapshotVersion=function(){return this.lastRemoteSnapshotVersion};g.getHighestTargetId=function(){return this.highestTargetId};g.setLastRemoteSnapshotVersion=function(a,b){this.lastRemoteSnapshotVersion=b;return I()};
g.addQueryData=function(a,b){this.queries.set(b.query,b);a=b.targetId;a>this.highestTargetId&&(this.highestTargetId=a);return I()};g.removeQueryData=function(a,b){this.queries.delete(b.query);Xc(this.references,b.targetId);return I()};g.getQueryData=function(a,b){a=this.queries.get(b)||null;return I(a)};g.addMatchingKeys=function(a,b,c){Uc(this.references,b,c);return I()};g.removeMatchingKeys=function(a,b,c){Wc(this.references,b,c);return I()};
g.removeMatchingKeysForTargetId=function(a,b){Xc(this.references,b);return I()};g.getMatchingKeysForTargetId=function(a,b){a=Yc(this.references,b);return I(a)};g.setGarbageCollector=function(a){this.references.setGarbageCollector(a)};g.containsKey=function(a,b){return this.references.containsKey(a,b)};var qg=function(){this.docs=mc};qg.prototype.addEntry=function(a,b){this.docs=this.docs.insert(b.key,b);return I()};qg.prototype.removeEntry=function(a,b){this.docs=this.docs.remove(b);return I()};qg.prototype.getEntry=function(a,b){return I(this.docs.get(b))};qg.prototype.getDocumentsMatchingQuery=function(a,b){a=nc;var c=new F(b.path.child(""));for(c=Wb(this.docs,c);Yb(c);){var d=Xb(c),e=d.value;if(!Fb(b.path,d.key.path))break;e instanceof K&&b.matches(e)&&(a=a.insert(e.key,e))}return I(a)};var rg=function(){this.mutationQueues={};this.remoteDocumentCache=new qg;this.queryCache=new pg;this.started=!1};g=rg.prototype;g.start=function(){z(!this.started,"MemoryPersistence double-started!");this.started=!0;return Promise.resolve()};g.shutdown=function(){z(this.started,"MemoryPersistence shutdown without start!");this.started=!1;return Promise.resolve()};g.getMutationQueue=function(a){var b=this.mutationQueues[lb(a)];b||(b=new kg,this.mutationQueues[lb(a)]=b);return b};g.getQueryCache=function(){return this.queryCache};
g.getRemoteDocumentCache=function(){return this.remoteDocumentCache};g.runTransaction=function(a,b){w("MemoryPersistence","Starting transaction:",a);return Bc(b(new sg))};var sg=function(){};var tg=function(){this.isEager=!1};tg.prototype.addGarbageSource=function(){};tg.prototype.removeGarbageSource=function(){};tg.prototype.addPotentialGarbageKey=function(){};tg.prototype.collectGarbage=function(){return I(H)};var ug=function(a,b,c){this.initialDelay=a;this.backoffFactor=b;this.maxDelay=c;this.reset()};ug.prototype.reset=function(){this.currentBase=this.initialDelay;this.currentBackoff=0};var vg=function(a){var b=new Fa;setTimeout(function(){b.resolve()},a.currentBackoff);a.currentBase*=a.backoffFactor;a.currentBackoff=a.currentBase+Math.min((Math.random()-.5)*a.currentBase,a.maxDelay);return b.promise};var wg=function(a,b,c,d,e){this.queue=a;this.connection=b;this.credentialsProvider=c;this.listener=this.stream=null;this.backoff=new ug(e?e:1E3,1.5,6E4);this.state=0;this.listener=d},xg=function(a){return 4===a.state||1===a.state||2===a.state};wg.prototype.start=function(){3===this.state?yg(this):(z(0===this.state,"Already started"),this.auth())};wg.prototype.stop=function(){this.state=5;this.listener=null;null!==this.stream&&(this.stream.close(),this.stream=null)};
var zg=function(a){z(!xg(a),"Can only inhibit backoff in a stopped state");a.state=0;a.backoff.reset()};wg.prototype.auth=function(){var a=this;z(0===this.state,"Must be in initial state to auth");this.state=1;this.credentialsProvider.getToken(!1).then(function(b){Ag(a,b)},function(b){Bg(a.queue,function(){return 5!==a.state?Cg(a,new A("unknown","Fetching auth token failed: "+b.message)):Promise.resolve()})})};
var Ag=function(a,b){if(5!==a.state){z(1===a.state,"Trying to start stream in a non-auth state");var c=function(b){Bg(a.queue,function(){return 5!==a.state?b():Promise.resolve()})};null!==a.listener&&(a.stream=a.startRpc(b),a.stream.onOpen(function(){c(function(){z(1===a.state,"Expected stream to be in state auth, but was "+a.state);a.state=2;return a.listener.onOpen()})}),a.stream.onClose(function(b){c(function(){return Cg(a,b)})}),a.stream.onMessage(function(b){c(function(){return a.onMessage(b)})}))}},
yg=function(a){z(3===a.state,"Should only perform backoff in an error case");a.state=4;vg(a.backoff).then(function(){Bg(a.queue,function(){if(5===a.state)return Promise.resolve();a.state=0;a.start();z(xg(a),"PersistentStream should have started");return Promise.resolve()})})},Cg=function(a,b){z(xg(a),"Can't handle server close on non-started stream");a.stream=null;a.state=3;return a.listener.onClose(b)},Dg=function(a,b,c,d,e,f,h){wg.call(this,b,c,d,f,h);this.databaseInfo=a;this.serializer=e};
n(Dg,wg);Dg.prototype.startRpc=function(a){return Eg(this.connection,"Listen",a)};
Dg.prototype.onMessage=function(a){this.backoff.reset();var b=this.serializer;var c=a.change_type;if(O(a,c,"targetChange")){P(a.targetChange,"targetChange");c=a.targetChange.targetChangeType||"NO_CHANGE";c="NO_CHANGE"===c?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:x("Got unexpected TargetChange.state: "+c);var d=a.targetChange.targetIds||[];b=a.targetChange.resumeToken||b.emptyByteString();var e=a.targetChange.cause,f;if(f=e)f=void 0===e.code?"unknown":Fg(e.code),f=new A(f,e.message||
"");b=new Gg(c,d,b,f||null)}else O(a,c,"documentChange")?(P(a.documentChange,"documentChange"),P(a.documentChange.document,"documentChange.name"),P(a.documentChange.document.name,"documentChange.document.name"),P(a.documentChange.document.updateTime,"documentChange.document.updateTime"),c=a.documentChange,d=Ef(b,c.document.name),e=Ff(c.document.updateTime),b=Gf(b,c.document.fields||{}),b=new K(d,e,b,{hasLocalMutations:!1}),b=new Hg(c.targetIds||[],c.removedTargetIds||[],b.key,b)):O(a,c,"documentDelete")?
(P(a.documentDelete,"documentDelete"),P(a.documentDelete.document,"documentDelete.document"),c=a.documentDelete,b=Ef(b,c.document),d=c.readTime?Ff(c.readTime):J,b=new L(b,d),b=new Hg([],c.removedTargetIds||[],b.key,b)):O(a,c,"documentRemove")?(P(a.documentRemove,"documentRemove"),P(a.documentRemove.document,"documentRemove"),c=a.documentRemove,b=Ef(b,c.document),b=new Hg([],c.removedTargetIds||[],b,null)):O(a,c,"filter")?(P(a.filter,"filter"),P(a.filter.targetId,"filter.targetId"),b=a.filter,b=new Ig(b.targetId,
new Jg(b.count||0))):b=x("Unknown change type "+JSON.stringify(a));O(a,a.response_type,"targetChange")?(a=a.targetChange,a=a.targetIds&&a.targetIds.length||!a.readTime?J:Ff(a.readTime)):a=J;return this.listener.onWatchChange(b,a)};
Dg.prototype.watch=function(a){var b={};b.database=this.serializer.encodedDatabaseId;var c=this.serializer,d=a.query;c=Od(d)?{documents:{documents:[Lf(c,d.path)]}}:{query:Mf(c,d)};c.targetId=a.targetId;0<a.resumeToken.length&&(c.resumeToken=a.resumeToken);b.addTarget=c;this.stream.send(b)};Dg.prototype.unwatch=function(a){var b={};b.database=this.serializer.encodedDatabaseId;b.removeTarget=a;this.stream.send(b)};
var Kg=function(a,b,c,d,e,f,h){wg.call(this,b,c,d,f,h);this.databaseInfo=a;this.serializer=e;this.handshakeComplete_=!1};n(Kg,wg);Kg.prototype.start=function(){this.handshakeComplete_=!1;wg.prototype.start.call(this)};Kg.prototype.startRpc=function(a){return Eg(this.connection,"Write",a)};
Kg.prototype.onMessage=function(a){z(!!a.streamToken,"Got a write response without a stream token");this.lastStreamToken=a.streamToken;if(this.handshakeComplete_){this.backoff.reset();var b=Lg(this.serializer,a.writeResults);a=Ff(a.commitTime);return this.listener.onMutationResult(a,b)}z(!a.writeResults||0===a.writeResults.length,"Got mutation results for handshake");this.handshakeComplete_=!0;return this.listener.onHandshakeComplete()};
var Mg=function(a,b){z(2===a.state,"Writing mutations requires an opened stream");z(a.handshakeComplete_,"Handshake must be complete before writing mutations");z(0<a.lastStreamToken.length,"Trying to write mutation without a token");b={streamToken:a.lastStreamToken,writes:b.map(function(b){return Jf(a.serializer,b)})};a.stream.send(b)};k.Object.defineProperties(Kg.prototype,{handshakeComplete:{configurable:!0,enumerable:!0,get:function(){return this.handshakeComplete_}}});var Ng=function(a,b,c,d,e,f){this.databaseInfo=a;this.queue=b;this.connection=c;this.credentials=d;this.serializer=e;this.initialBackoffDelay=f},Og=function(a,b){return new Kg(a.databaseInfo,a.queue,a.connection,a.credentials,a.serializer,b,a.initialBackoffDelay)},Pg=function(a,b){return new Dg(a.databaseInfo,a.queue,a.connection,a.credentials,a.serializer,b,a.initialBackoffDelay)};
Ng.prototype.commit=function(a){var b=this;a={writes:a.map(function(a){return Jf(b.serializer,a)})};return Qg(this,"commit",a).then(function(a){return Lg(b.serializer,a.writeResults)})};
Ng.prototype.lookup=function(a){var b=this,c={documents:a.map(function(a){return Hf(b.serializer.databaseId,a.path)})};return Qg(this,"batchGet",c).then(function(c){var d=mc;c.forEach(function(a){var c=b.serializer,e=a.result_type;if(O(a,e,"found")){z(!!a.found,"Tried to deserialize a found document from a missing document.");P(a.found.name,"doc.found.name");P(a.found.updateTime,"doc.found.updateTime");e=Ef(c,a.found.name);var f=Ff(a.found.updateTime);a=Gf(c,a.found.fields||{});a=new K(e,f,a,{hasLocalMutations:!1})}else O(a,
e,"missing")?(z(!!a.missing,"Tried to deserialize a missing document from a found document."),z(!!a.readTime,"Tried to deserialize a missing document without a read time."),c=Ef(c,a.missing),a=Ff(a.readTime),a=new L(c,a)):a=x("invalid batch get response: "+JSON.stringify(a));d=d.insert(a.key,a)});var f=[];a.forEach(function(a){var b=d.get(a);z(!!b,"Missing entity in write response for "+a);f.push(b)});return f})};
var Qg=function(a,b,c){return a.credentials.getToken(!1).then(function(d){return Rg(a.connection,b,c,d)})};var Sg=function(a){this.fields=a};Sg.prototype.equals=function(a){return db(this.fields,a.fields)};var Tg=function(){};Tg.prototype.equals=function(a){return a instanceof Tg};var Ug=new Tg,Vg=function(a,b){this.field=a;this.transform=b};Vg.prototype.equals=function(a){return this.field.equals(a.field)&&this.transform.equals(a.transform)};
var Wg=function(a,b){this.version=a;this.transformResults=b},Xg=function(a,b){this.updateTime=a;this.exists=b;z(void 0===a||void 0===b,'Precondition can specify "exists" or "updateTime" but not both')},Yg=function(a){return new Xg(void 0,a)},Zg=function(a,b){if(void 0!==a.updateTime)return b instanceof K&&b.version.equals(a.updateTime);if(void 0!==a.exists)return a.exists?b instanceof K:null===b||b instanceof L;z(a.isNone,"Precondition should be empty");return!0};
Xg.prototype.equals=function(a){var b=this.updateTime,c=a.updateTime;return(b?!(!c||!b.equals(c)):b===c)&&this.exists===a.exists};k.Object.defineProperties(Xg.prototype,{isNone:{configurable:!0,enumerable:!0,get:function(){return void 0===this.updateTime&&void 0===this.exists}}});var $g=new Xg,ah=function(a,b,c){this.key=a;this.value=b;this.precondition=c;this.type=0};
ah.prototype.applyTo=function(a,b,c){c&&z(!c.transformResults,"TransformResults received by SetMutation.");if(!Zg(this.precondition,a))return a;b=void 0===c;return!a||a instanceof L?new K(this.key,J,this.value,{hasLocalMutations:b}):a instanceof K?(z(a.key.equals(this.key),"Can only apply mutation to document with same key"),new K(a.key,a.version,this.value,{hasLocalMutations:b})):x("Unknown MaybeDocument type: "+a)};
ah.prototype.equals=function(a){return a instanceof ah&&this.key.equals(a.key)&&this.value.equals(a.value)&&this.precondition.equals(a.precondition)};var bh=function(a,b,c,d){this.key=a;this.data=b;this.fieldMask=c;this.precondition=d;this.type=1};
bh.prototype.applyTo=function(a,b,c){c&&z(!c.transformResults,"TransformResults received by PatchMutation.");if(!Zg(this.precondition,a))return a;b=void 0===c;if(!a||a instanceof L)a=new K(a?a.key:this.key,a?a.version:J,Cd,{hasLocalMutations:b});if(a instanceof K){z(a.key.equals(this.key),"Can only apply mutation to document with same key");c=a.data;for(var d=m(this.fieldMask.fields),e=d.next();!e.done;e=d.next()){e=e.value;var f=this.data.field(e);c=void 0!==f?c.set(e,f):c.delete(e)}return new K(a.key,
a.version,c,{hasLocalMutations:b})}return x("Unknown MaybeDocument type: "+a)};bh.prototype.equals=function(a){return a instanceof bh&&this.key.equals(a.key)&&this.fieldMask.equals(a.fieldMask)&&this.precondition.equals(a.precondition)};var ch=function(a,b){this.key=a;this.fieldTransforms=b;this.type=2;this.precondition=Yg(!0)};
ch.prototype.applyTo=function(a,b,c){c&&z(null!==c.transformResults,"TransformResults missing for TransformMutation.");if(!Zg(this.precondition,a))return a;z(a instanceof K,"Trying to apply transform to non-Document");z(a.key.equals(this.key),"Can only apply mutation to document with same key");var d=void 0===c;if(c)b=c.transformResults;else a:{c=[];for(var e=m(this.fieldTransforms),f=e.next();!f.done;f=e.next())if(f=f.value.transform,f instanceof Tg)c.push(new yd(b));else{b=x("Encountered unknown transform: "+
f);break a}b=c}a:{c=a.data;z(b.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(e=0;e<this.fieldTransforms.length;e++){var h=this.fieldTransforms[e];f=h.transform;h=h.field;if(f instanceof Tg)c=c.set(h,b[e]);else{b=x("Encountered unknown transform: "+f);break a}}b=c}return new K(a.key,a.version,b,{hasLocalMutations:d})};ch.prototype.equals=function(a){return a instanceof ch&&this.key.equals(a.key)&&db(this.fieldTransforms,a.fieldTransforms)&&this.precondition.equals(a.precondition)};
var dh=function(a,b){this.key=a;this.precondition=b;this.type=3};dh.prototype.applyTo=function(a,b,c){c&&z(!c.transformResults,"TransformResults received by DeleteMutation.");if(!Zg(this.precondition,a))return a;a&&z(a.key.equals(this.key),"Can only apply mutation to document with same key");return new L(this.key,J)};dh.prototype.equals=function(a){return a instanceof dh&&this.key.equals(a.key)&&this.precondition.equals(a.precondition)};var ye=function(a){this.datastore=a;this.readVersions=oc;this.mutations=[];this.committed=!1};
ye.prototype.lookup=function(a){var b=this;return this.committed?Promise.reject("Transaction has already completed."):0<this.mutations.length?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(a).then(function(a){a.forEach(function(a){var c=a.version;a instanceof L&&(c=J);var d=b.readVersions.get(a.key);if(null!==d){if(!c.equals(d))throw new A("aborted","Document version changed between two reads.");}else b.readVersions=b.readVersions.insert(a.key,c)});return a})};
ye.prototype.write=function(a){if(this.committed)throw new A("failed-precondition","Transaction has already completed.");this.mutations=this.mutations.concat(a)};ye.prototype.precondition=function(a){return(a=this.readVersions.get(a))?new Xg(a):$g};
var eh=function(a,b,c){if((a=a.readVersions.get(b))&&a.equals(J)){if(c&&c.createIfMissing)return Yg(!1);throw new A("failed-precondition","Can't update a document that doesn't exist without providing { createIfMissing: true } update options.");}return a?new Xg(a):c&&c.createIfMissing?$g:Yg(!0)};ye.prototype.set=function(a,b){this.write(b.toMutations(a,this.precondition(a)))};ye.prototype.update=function(a,b,c){this.write(b.toMutations(a,eh(this,a,c)))};
ye.prototype.delete=function(a){this.write([new dh(a,this.precondition(a))])};ye.prototype.commit=function(){var a=this,b=this.readVersions;this.mutations.forEach(function(a){b=b.remove(a.key)});return b.isEmpty()?this.datastore.commit(this.mutations).then(function(){a.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))};var fh={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,UNAUTHENTICATED:16,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,0:"OK",1:"CANCELLED",2:"UNKNOWN",3:"INVALID_ARGUMENT",4:"DEADLINE_EXCEEDED",5:"NOT_FOUND",6:"ALREADY_EXISTS",7:"PERMISSION_DENIED",16:"UNAUTHENTICATED",8:"RESOURCE_EXHAUSTED",9:"FAILED_PRECONDITION",10:"ABORTED",11:"OUT_OF_RANGE",12:"UNIMPLEMENTED",
13:"INTERNAL",14:"UNAVAILABLE",15:"DATA_LOSS"};
function ih(a){switch(a){case "ok":return x("Treated status OK as error");case "cancelled":case "unknown":case "deadline-exceeded":case "resource-exhausted":case "internal":case "unavailable":case "unauthenticated":return!1;case "invalid-argument":case "not-found":case "already-exists":case "permission-denied":case "failed-precondition":case "aborted":case "out-of-range":case "unimplemented":case "data-loss":return!0;default:return x("Unknown status code: "+a)}}
function Fg(a){switch(a){case 0:return"ok";case 1:return"cancelled";case 2:return"unknown";case 4:return"deadline-exceeded";case 8:return"resource-exhausted";case 13:return"internal";case 14:return"unavailable";case 16:return"unauthenticated";case 3:return"invalid-argument";case 5:return"not-found";case 6:return"already-exists";case 7:return"permission-denied";case 9:return"failed-precondition";case 10:return"aborted";case 11:return"out-of-range";case 12:return"unimplemented";case 15:return"data-loss";
default:return x("Unknown status code: "+a)}}
function jh(a){switch(a){case 200:return"ok";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 416:return"out-of-range";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"unknown";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded";default:return 200<=a&&300>a?"ok":400<=a&&500>a?"failed-precondition":500<=a&&600>a?"internal":
"unknown"}};var Hg=function(a,b,c,d){this.updatedTargetIds=a;this.removedTargetIds=b;this.key=c;this.newDoc=d},Ig=function(a,b){this.targetId=a;this.existenceFilter=b},Gg=function(a,b,c,d){c=void 0===c?Ka().emptyByteString:c;this.state=a;this.targetIds=b;this.resumeToken=c;this.cause=void 0===d?null:d},kh=function(a,b,c){this.snapshotVersion=a;this.listenTargets=b;this.existenceFilters={};this.targetChanges={};this.documentUpdates=mc;this.frozen=!1;this.pendingTargetResponses=Qa(c)};
kh.prototype.add=function(a){z(!this.frozen,"Trying to modify frozen WatchChangeAggregator.");if(a instanceof Hg){for(var b=!1,c=m(a.updatedTargetIds),d=c.next();!d.done;d=c.next())d=d.value,lh(this,d)&&(mh(this,d).mapping.add(a.key),b=!0);c=m(a.removedTargetIds);for(d=c.next();!d.done;d=c.next())d=d.value,lh(this,d)&&(mh(this,d).mapping.delete(a.key),b=!0);a.newDoc&&b&&(this.documentUpdates=this.documentUpdates.insert(a.key,a.newDoc))}else a instanceof Gg?nh(this,a):a instanceof Ig?lh(this,a.targetId)&&
(this.existenceFilters[a.targetId]=a.existenceFilter):x("Unknown watch change: "+a)};
var oh=function(a,b){z(!a.frozen,"Trying to modify frozen WatchChangeAggregator.");b.forEach(function(b){return a.add(b)})},ph=function(a){var b=a.targetChanges;Na(a.targetChanges,function(c){lh(a,c)||delete b[c]});a.frozen=!0;return new Zc(a.snapshotVersion,b,a.documentUpdates)},mh=function(a,b){var c=a.targetChanges[b];c||(c={currentStatusUpdate:0,snapshotVersion:a.snapshotVersion,mapping:new bd,resumeToken:Ka().emptyByteString},a.targetChanges[b]=c);return c},lh=function(a,b){return!Ma(a.pendingTargetResponses,
b)&&Ma(a.listenTargets,b)},nh=function(a,b){b.targetIds.forEach(function(c){var d=mh(a,c);switch(b.state){case 0:lh(a,c)&&qh(d,b.resumeToken);break;case 1:rh(a,c);Ma(a.pendingTargetResponses,c)||(d.mapping=new bd,d.currentStatusUpdate=0,delete a.existenceFilters[c]);qh(d,b.resumeToken);break;case 2:rh(a,c);z(!b.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:lh(a,c)&&(d.currentStatusUpdate=2,qh(d,b.resumeToken));break;case 4:lh(a,c)&&(d.mapping=new ad,qh(d,b.resumeToken));
break;default:x("Unknown target watch change state: "+b.state)}})},rh=function(a,b){var c=(a.pendingTargetResponses[b]||0)-1;0===c?delete a.pendingTargetResponses[b]:a.pendingTargetResponses[b]=c};function qh(a,b){0<b.length&&(a.resumeToken=b)};var sh=function(a,b,c,d,e){this.databaseInfo=a;this.asyncQueue=b;this.localStore=c;this.datastore=d;this.onlineStateHandler=e;this.pendingWrites=[];this.lastBatchSeen=-1;this.listenTargets={};this.pendingTargetResponses={};this.accumulatedWatchChanges=[];this.watchStreamOnlineState=0};sh.prototype.start=function(){var a=this;return th(this).then(function(){return xe(a)})};
var uh=function(a,b){var c=a.watchStreamOnlineState!==b;a.watchStreamOnlineState=b;if(c)a.onlineStateHandler(b)},th=function(a){a.watchStream=Pg(a.datastore,{onOpen:a.onWatchStreamOpen.bind(a),onClose:a.onWatchStreamClose.bind(a),onWatchChange:a.onWatchStreamChange.bind(a)});a.writeStream=Og(a.datastore,{onOpen:a.onWriteStreamOpen.bind(a),onClose:a.onWriteStreamClose.bind(a),onHandshakeComplete:a.onWriteHandshakeComplete.bind(a),onMutationResult:a.onMutationResult.bind(a)});return a.localStore.getLastStreamToken().then(function(b){a.writeStream.lastStreamToken=
b})};sh.prototype.shutdown=function(){w("RemoteStore","RemoteStore shutting down.");this.accumulatedWatchChanges=[];this.pendingTargetResponses={};this.writeStream.stop();this.watchStream.stop();return Promise.resolve(void 0)};sh.prototype.listen=function(a){z(!Ma(this.listenTargets,a.targetId),"listen called with duplicate targetId!");this.listenTargets[a.targetId]=a;2===this.watchStream.state?vh(this,a):xg(this.watchStream)||wh(this)};
sh.prototype.unlisten=function(a){z(Ma(this.listenTargets,a),"unlisten called without assigned target ID!");delete this.listenTargets[a];2===this.watchStream.state&&(xh(this,a),this.watchStream.unwatch(a))};
var vh=function(a,b){xh(a,b.targetId);a.watchStream.watch(b)},xh=function(a,b){a.pendingTargetResponses[b]=(a.pendingTargetResponses[b]||0)+1},wh=function(a){z(!xg(a.watchStream),"Can't restart started watch stream");z(!Pa(a.listenTargets),"Tried to start watch stream even though it should not be started");a.watchStream.start()};sh.prototype.onWatchStreamOpen=function(){var a=this;Na(this.listenTargets,function(b,c){vh(a,c)});return Promise.resolve()};
sh.prototype.onWatchStreamClose=function(){this.accumulatedWatchChanges=[];this.pendingTargetResponses={};Pa(this.listenTargets)?uh(this,0):(1===this.watchStreamOnlineState?uh(this,0):uh(this,2),wh(this));return Promise.resolve()};
sh.prototype.onWatchStreamChange=function(a,b){uh(this,1);if(a instanceof Gg&&2===a.state&&a.cause)return yh(this,a);this.accumulatedWatchChanges.push(a);return!b.equals(J)&&0<=b.compareTo(this.localStore.getLastRemoteSnapshotVersion())?(a=this.accumulatedWatchChanges,this.accumulatedWatchChanges=[],zh(this,b,a)):Promise.resolve()};
var zh=function(a,b,c){var d=new kh(b,a.listenTargets,a.pendingTargetResponses);oh(d,c);var e=ph(d);a.pendingTargetResponses=d.pendingTargetResponses;var f=[];Na(d.existenceFilters,function(c,d){var h=a.listenTargets[c];if(h){var l=h.query;Od(l)?0===d.count?(h=new F(l.path),$c(e,new L(h,b))):z(1===d.count,"Single document existence filter with count: "+d.count):(h=se(a.localStore,c).then(function(b){if(e.targetChanges[c]){var f=e.targetChanges[c].mapping;null!==f&&(f instanceof bd?b=cd(f,b):(z(f instanceof
ad,"Expected either reset or update mapping but got something else: "+f),b=f.documents))}b.size!==d.count&&(e.targetChanges[c]={mapping:new ad,snapshotVersion:J,currentStatusUpdate:1,resumeToken:Ka().emptyByteString},b=new Oc(l,c),a.listenTargets[c]=b,xh(a,c),a.watchStream.unwatch(c),vh(a,b))}),f.push(h))}});return Promise.all(f).then(function(){Na(e.targetChanges,function(b,c){if(0<c.resumeToken.length){var d=a.listenTargets[b];d&&(a.listenTargets[b]=d.update({resumeToken:c.resumeToken,snapshotVersion:c.snapshotVersion}))}});
return a.syncEngine.applyRemoteEvent(e)})},yh=function(a,b){z(!!b.cause,"Handling target error without a cause");var c=b.cause,d=Promise.resolve();b.targetIds.forEach(function(b){d=d.then(function(){return Ma(a.listenTargets,b)?(delete a.listenTargets[b],ze(a.syncEngine,b,c)):Promise.resolve()})});return d},xe=function(a){return 10>a.pendingWrites.length?ig(a.localStore,a.lastBatchSeen).then(function(b){if(null===b)return Promise.resolve();a.commit(b);return xe(a)}):Promise.resolve()};
sh.prototype.commit=function(a){z(10>this.pendingWrites.length,"commit called when batches can't be written");this.lastBatchSeen=a.batchId;this.pendingWrites.push(a);xg(this.writeStream)?this.writeStream.handshakeComplete&&Mg(this.writeStream,a.mutations):Ah(this)};var Ah=function(a){z(!xg(a.writeStream),"Can't restart started write stream");a.writeStream.start()};
sh.prototype.onWriteStreamOpen=function(){var a=this.writeStream;z(2===a.state,"Writing handshake requires an opened stream");z(!a.handshakeComplete_,"Handshake already completed");var b={};b.database=a.serializer.encodedDatabaseId;a.stream.send(b);return Promise.resolve()};
sh.prototype.onWriteHandshakeComplete=function(){var a=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var b=m(a.pendingWrites),c=b.next();!c.done;c=b.next())Mg(a.writeStream,c.value.mutations)})};sh.prototype.onMutationResult=function(a,b){var c=this;z(0<this.pendingWrites.length,"Got result for empty pending writes");var d=this.pendingWrites.shift();a=Je(d,a,b,this.writeStream.lastStreamToken);return Be(this.syncEngine,a).then(function(){return xe(c)})};
sh.prototype.onWriteStreamClose=function(a){var b=this;return 0<this.pendingWrites.length?(z(!!a,"We have pending writes, but the write stream closed without an error"),(this.writeStream.handshakeComplete?Bh(this,a):Ch(this,a)).then(function(){0<b.pendingWrites.length&&!xg(b.writeStream)&&Ah(b)})):Promise.resolve()};
var Ch=function(a,b){return ih(b.code)||"aborted"===b.code?(w("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",a.writeStream.lastStreamToken),a.writeStream.lastStreamToken=Ka().emptyByteString,a.localStore.setLastStreamToken(Ka().emptyByteString)):Promise.resolve()},Bh=function(a,b){if(ih(b.code)){var c=a.pendingWrites.shift();zg(a.writeStream);return De(a.syncEngine,c.batchId,b).then(function(){return xe(a)})}return Promise.resolve()};
sh.prototype.handleUserChange=function(a){var b=this;w("RemoteStore","RemoteStore changing users: uid=",a.uid);this.lastBatchSeen=-1;this.pendingWrites=[];this.watchStream.stop();this.writeStream.stop();this.accumulatedWatchChanges=[];this.pendingTargetResponses={};return th(this).then(function(){!Pa(b.listenTargets)&&wh(b);return xe(b)}).then(function(){uh(b,0)})};var Dh=function(a,b){B("GeoPoint",arguments,2);D("GeoPoint","number",1,a);D("GeoPoint","number",2,b);if(!isFinite(a)||-90>a||90<a)throw new A("invalid-argument","Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(b)||-180>b||180<b)throw new A("invalid-argument","Longitude must be a number between -180 and 180, but was: "+b);this._lat=a;this._long=b};Dh.prototype._equals=function(a){return this._lat===a._lat&&this._long===a._long};
Dh.prototype._compareTo=function(a){return E(this._lat,a._lat)||E(this._long,a._long)};k.Object.defineProperties(Dh.prototype,{latitude:{configurable:!0,enumerable:!0,get:function(){return this._lat}},longitude:{configurable:!0,enumerable:!0,get:function(){return this._long}}});var Jg=function(a){this.count=a};Jg.prototype.equals=function(a){return a&&a.count===this.count};var Eh={};Eh[Rd.name]="ASCENDING";Eh[ce.name]="DESCENDING";var Fh={};Fh[Ud.name]="LESS_THAN";Fh[Vd.name]="LESS_THAN_OR_EQUAL";Fh[Xd.name]="GREATER_THAN";Fh[Wd.name]="GREATER_THAN_OR_EQUAL";Fh[Md.name]="EQUAL";function P(a,b){z(!hd(a),b+" is missing")}function Gh(a){return"number"===typeof a?a:"string"===typeof a?parseInt(a,10):x("can't parse "+a)}var Hh=function(a,b){this.databaseId=a;this.options=b};Hh.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)};
Hh.prototype.toTimestamp=function(a){return{seconds:a.seconds,nanos:a.nanos}};
var Ih=function(a){if("string"===typeof a){var b=0,c=Ic.exec(a);z(!!c,"invalid timestamp: "+a);c[1]&&(b=c[1],b=(b+"000000000").substr(0,9),b=parseInt(b,10));return new Kc(Math.floor((new Date(a)).getTime()/1E3),b)}z(!!a,"Cannot deserialize null or undefined timestamp.");b=Gh(a.seconds||"0");return new Kc(b,a.nanos||0)},Jh=function(a,b){if("string"===typeof b)return z(a.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),hb(b);z(!a.options.useProto3Json,
"Expected bytes to be passed in as string, but got something else instead.");return ib(b)},Ff=function(a){z(!!a,"Trying to deserialize version that isn't set");return new Nc(Ih(a))},Hf=function(a,b){return(new Hb(["projects",a.projectId,"databases",a.database])).child("documents").child(b).canonicalString()},Kh=function(a){a=Ib(a);z(4<=a.length&&"projects"===a.get(0)&&"databases"===a.get(2),"Tried to deserialize invalid key "+a.toString());return a},Ef=function(a,b){b=Kh(b);z(b.get(1)===a.databaseId.projectId,
"Tried to deserialize key from different project: "+b.get(1)+" vs "+a.databaseId.projectId);z(!b.get(3)&&!a.databaseId.database||b.get(3)===a.databaseId.database,"Tried to deserialize key from different database: "+b.get(3)+" vs "+a.databaseId.database);return new F(Lh(b))},Lf=function(a,b){return 0===b.length?a.encodedDatabaseId:Hf(a.databaseId,b)},uf=function(a){a=Kh(a);return 4===a.length?Jb:Lh(a)},Lh=function(a){z(4<a.length&&"documents"===a.get(4),"tried to deserialize invalid key "+a.toString());
return Bb(a,5)},Nh=function(a,b){if(b instanceof kd)return{nullValue:"NULL_VALUE"};if(b instanceof md)return{booleanValue:b.value()};if(b instanceof rd)return{integerValue:""+b.value()};if(b instanceof sd){var c=b.value();if(a.options.useProto3Json){if(isNaN(c))return{doubleValue:"NaN"};if(Infinity===c)return{doubleValue:"Infinity"};if(-Infinity===c)return{doubleValue:"-Infinity"}}return{doubleValue:b.value()}}b instanceof wd?a={stringValue:b.value()}:b instanceof M?a={mapValue:{fields:If(a,b)}}:
b instanceof Dd?a={arrayValue:Mh(a,b)}:b instanceof xd?a={timestampValue:a.toTimestamp(b.internalValue)}:b instanceof Bd?a={geoPointValue:{latitude:b.value().latitude,longitude:b.value().longitude}}:b instanceof zd?(b=b.value(),a={bytesValue:a.options.useProto3Json?b.toBase64():b.toUint8Array()}):a=b instanceof Ad?{referenceValue:Hf(b.databaseId,b.key.path)}:x("Unknown FieldValue "+JSON.stringify(b));return a},Oh=function(a,b){var c=b.value_type;if(O(b,c,"nullValue"))return ld;if(O(b,c,"booleanValue"))return b.booleanValue?
nd:od;if(O(b,c,"integerValue"))return new rd(Gh(b.integerValue));if(O(b,c,"doubleValue")){if(a.options.useProto3Json){if("NaN"===b.doubleValue)return td;if("Infinity"===b.doubleValue)return ud;if("-Infinity"===b.doubleValue)return vd}return new sd(b.doubleValue)}return O(b,c,"stringValue")?new wd(b.stringValue):O(b,c,"mapValue")?Gf(a,b.mapValue.fields||{}):O(b,c,"arrayValue")?(P(b.arrayValue,"arrayValue"),new Dd((b.arrayValue.values||[]).map(function(b){return Oh(a,b)}))):O(b,c,"timestampValue")?
(P(b.timestampValue,"timestampValue"),new xd(Ih(b.timestampValue))):O(b,c,"geoPointValue")?(P(b.geoPointValue,"geoPointValue"),new Bd(new Dh(b.geoPointValue.latitude||0,b.geoPointValue.longitude||0))):O(b,c,"bytesValue")?(P(b.bytesValue,"bytesValue"),b=Jh(a,b.bytesValue),new zd(b)):O(b,c,"referenceValue")?(P(b.referenceValue,"referenceValue"),c=Kh(b.referenceValue),b=new yb(c.get(1),c.get(3)),c=new F(Lh(c)),new Ad(b,c)):x("Unknown Value proto "+JSON.stringify(b))},Ph=function(a,b,c){return{name:Hf(a.databaseId,
b.path),fields:If(a,c)}},If=function(a,b){var c={};b.forEach(function(b,e){c[b]=Nh(a,e)});return c},Gf=function(a,b){var c=Cd;Oa(b,function(b,e){c=c.set(new Lb([b]),Oh(a,e))});return c},Mh=function(a,b){var c=[];b.forEach(function(b){c.push(Nh(a,b))});return{values:c}},Jf=function(a,b){if(b instanceof ah)var c={update:Ph(a,b.key,b.value)};else if(b instanceof dh)c={delete:Hf(a.databaseId,b.key.path)};else if(b instanceof bh)c={update:Ph(a,b.key,b.data),updateMask:Qh(b.fieldMask)};else if(b instanceof
ch)c={transform:{document:Hf(a.databaseId,b.key.path),fieldTransforms:b.fieldTransforms.map(function(a){z(a.transform instanceof Tg,"Unknown transform: "+a.transform);return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"}})}};else return x("Unknown mutation type "+b.type);b.precondition.isNone||(c.currentDocument=Rh(a,b.precondition));return c},Kf=function(a,b){var c=b.currentDocument?Sh(b.currentDocument):$g;if(b.update){P(b.update.name,"name");var d=Ef(a,b.update.name);a=Gf(a,
b.update.fields||{});return b.updateMask?(b=Th(b.updateMask),new bh(d,a,b,c)):new ah(d,a,c)}return b.delete?(b=Ef(a,b.delete),new dh(b,c)):b.transform?(d=Ef(a,b.transform.document),b=b.transform.fieldTransforms.map(function(a){z("REQUEST_TIME"===a.setToServerValue,"Unknown transform proto: "+JSON.stringify(a));a=Ob(a.fieldPath);return new Vg(a,Ug)}),z(!0===c.exists,'Transforms only support precondition "exists == true"'),new ch(d,b)):x("unknown mutation proto: "+JSON.stringify(b))},Rh=function(a,
b){z(!b.isNone,"Can't serialize an empty precondition");return void 0!==b.updateTime?{updateTime:a.toTimestamp(b.updateTime.toTimestamp())}:void 0!==b.exists?{exists:b.exists}:x("Unknown precondition")},Sh=function(a){return void 0!==a.updateTime?new Xg(Ff(a.updateTime)):void 0!==a.exists?Yg(a.exists):$g},Uh=function(a,b){var c=b.updateTime?Ff(b.updateTime):null,d=null;b.transformResults&&(d=b.transformResults.map(function(b){return Oh(a,b)}));return new Wg(c,d)},Lg=function(a,b){return(b||[]).map(function(b){return Uh(a,
b)})},Mf=function(a,b){var c={structuredQuery:{}};if(b.path.isEmpty())c.parent=Lf(a,Jb);else{var d=b.path;z(0!==d.length%2,"Document queries with filters are not supported.");c.parent=Lf(a,Cb(d));c.structuredQuery.from=[{collectionId:Eb(d)}]}if(d=Vh(a,b.filters))c.structuredQuery.where=d;if(d=Wh(b.orderBy))c.structuredQuery.orderBy=d;d=b.limit;d=hd(d)?void 0:d;void 0!==d&&(c.structuredQuery.limit=d);b.startAt&&(c.structuredQuery.startAt=Xh(a,b.startAt));b.endAt&&(c.structuredQuery.endAt=Xh(a,b.endAt));
return c},Vh=function(a,b){if(0!==b.length)return b=b.map(function(b){return b instanceof Ld?b instanceof Ld?{fieldFilter:{field:Yh(b.field),op:Fh[b.op.name],value:Nh(a,b.value)}}:x("Unrecognized filter: "+JSON.stringify(b)):b instanceof ae?{unaryFilter:{field:Yh(b.field),op:"IS_NAN"}}:b instanceof $d?{unaryFilter:{field:Yh(b.field),op:"IS_NULL"}}:x("Unrecognized filter: "+JSON.stringify(b))}),1===b.length?b[0]:{compositeFilter:{op:"AND",filters:b}}},vf=function(a,b){return b?void 0!==b.unaryFilter?
[Zh(b)]:void 0!==b.fieldFilter?[$h(a,b)]:void 0!==b.compositeFilter?b.compositeFilter.filters.map(function(b){return vf(a,b)}).reduce(function(a,b){return a.concat(b)}):x("Unknown filter: "+JSON.stringify(b)):[]},Wh=function(a){if(0!==a.length)return a.map(function(a){return{field:Yh(a.field),direction:Eh[a.dir.name]}})},wf=function(a){return a.map(function(a){var b=Ob(a.field.fieldPath);a:{switch(a.direction){case "ASCENDING":a=Rd;break a;case "DESCENDING":a=ce;break a}a=void 0}return new Pd(b,a)})},
Xh=function(a,b){return{before:b.before,values:b.position.map(function(b){return Nh(a,b)})}},xf=function(a,b){var c=!!b.before;b=b.values.map(function(b){return Oh(a,b)});return new de(b,c)},ai=function(a){switch(a){case "EQUAL":return Md;case "GREATER_THAN":return Xd;case "GREATER_THAN_OR_EQUAL":return Wd;case "LESS_THAN":return Ud;case "LESS_THAN_OR_EQUAL":return Vd;case "OPERATOR_UNSPECIFIED":return x("Unspecified relation");default:return x("Unknown relation")}},Yh=function(a){return{fieldPath:a.canonicalString()}},
$h=function(a,b){return new Ld(Ob(b.fieldFilter.field.fieldPath),ai(b.fieldFilter.op),Oh(a,b.fieldFilter.value))},Zh=function(a){switch(a.unaryFilter.op){case "IS_NAN":return a=Ob(a.unaryFilter.field.fieldPath),new ae(a);case "IS_NULL":return a=Ob(a.unaryFilter.field.fieldPath),new $d(a);case "OPERATOR_UNSPECIFIED":return x("Unspecified filter");default:return x("Unknown filter")}},Qh=function(a){return{fieldPaths:a.fields.map(function(a){return a.canonicalString()})}},Th=function(a){a=(a.fieldPaths||
[]).map(function(a){return Ob(a)});return new Sg(a)};k.Object.defineProperties(Hh.prototype,{encodedDatabaseId:{configurable:!0,enumerable:!0,get:function(){return(new Hb(["projects",this.databaseId.projectId,"databases",this.databaseId.database])).canonicalString()}}});function O(a,b,c){return b===c||!b&&c in a};var bi=function(a,b,c,d){this.platform=a;this.databaseInfo=b;this.credentials=c;this.asyncQueue=d};bi.prototype.start=function(a){var b=this,c=new Fa,d=!1;this.credentials.setUserChangeListener(function(e){d?Bg(b.asyncQueue,function(){return b.handleUserChange(e)}):(d=!0,ci(b,e,a).then(function(a){di(b,e).then(function(){c.resolve(a)})}).catch(c.reject))});Bg(this.asyncQueue,function(){return c.promise});return c.promise};
var ci=function(a,b,c){if(c)return a.garbageCollector=new tg,a.persistence=new Nf(Tf(a.databaseInfo),new Hh(a.databaseInfo.databaseId,{useProto3Json:!0})),a.persistence.start().then(function(){return Promise.resolve(!0)}).catch(function(c){if("failed-precondition"!==c.code)return Promise.reject(c);w("FirestoreClient","Persistent storage failed; retrying with storage disabled: "+c);return ci(a,b,!1)});a.garbageCollector=new Fc;a.persistence=new rg;return a.persistence.start().then(function(){return Promise.resolve(!1)})},
di=function(a,b){return Promise.resolve(new ei(a.databaseInfo)).then(function(c){a.localStore=new dg(a.persistence,b,a.garbageCollector);a.remoteStore=new sh(a.databaseInfo,a.asyncQueue,a.localStore,new Ng(a.databaseInfo,a.asyncQueue,c,a.credentials,new Hh(a.databaseInfo.databaseId,{useProto3Json:!0})),function(b){a.eventMgr.onOnlineStateChanged(b)});a.syncEngine=new oe(a.localStore,a.remoteStore,b);a.remoteStore.syncEngine=a.syncEngine;a.eventMgr=new sc(a.syncEngine);return a.localStore.start()}).then(function(){return a.remoteStore.start()})};
g=bi.prototype;g.handleUserChange=function(a){z(this.asyncQueue.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.");w("FirestoreClient","User Changed: "+a.uid);return this.syncEngine.handleUserChange(a)};g.shutdown=function(){var a=this;return Bg(this.asyncQueue,function(){a.credentials.removeUserChangeListener();return a.remoteStore.shutdown()}).then(function(){return a.persistence.shutdown()})};
g.listen=function(a,b,c){var d=this,e=new uc(a,b,c);Bg(this.asyncQueue,function(){return d.eventMgr.listen(e)});return e};g.unlisten=function(a){var b=this;Bg(this.asyncQueue,function(){return b.eventMgr.unlisten(a)})};g.write=function(a){var b=this,c=new Fa;Bg(this.asyncQueue,function(){return b.syncEngine.write(a,c)});return c.promise};g.databaseId=function(){return this.databaseInfo.databaseId};g.transaction=function(a){var b=this;return Bg(this.asyncQueue,function(){return Promise.resolve()}).then(function(){return b.syncEngine.runTransaction(a)})};var fi=function(a){this.observer=a;this.muted=!1};fi.prototype.next=function(a){gi(this,this.observer.next,a)};fi.prototype.error=function(a){gi(this,this.observer.error,a)};var gi=function(a,b,c){a.muted||setTimeout(function(){a.muted||b(c)},0)};var hi=function(){this.tail=Promise.resolve();this.delayedOpCount=0;this.operationInProgress=!1},Bg=function(a,b){a.failure&&x("AsyncQueue is already failed: "+a.failure.message);return ii(a,b)},ii=function(a,b){a.tail=a.tail.then(function(){a.operationInProgress=!0;return b().catch(function(b){a.failure=b;a.operationInProgress=!1;Ia("INTERNAL UNHANDLED ERROR: ",b.stack||b.message);throw b;}).then(function(){a.operationInProgress=!1})});return a.tail};
hi.prototype.drain=function(){z(0===this.delayedOpCount,"draining doesn't handle delayed ops.");return Bg(this,function(){return Promise.resolve(void 0)})};function ji(a){if("object"!==typeof a||null===a)return!1;for(var b=m(["next","error","complete"]),c=b.next();!c.done;c=b.next())if(c=c.value,c in a&&"function"===typeof a[c])return!0;return!1};var ki=function(){},li=function(){};n(li,ki);var mi=new li,ni=function(){};n(ni,ki);var oi=new ni,pi=La(ki,"Use FieldValue.<field>() instead.");var qi=/^__.*__$/,ri=function(a,b){this.data=a;this.fieldTransforms=b};ri.prototype.toMutations=function(a,b){b=[new ah(a,this.data,b)];0<this.fieldTransforms.length&&b.push(new ch(a,this.fieldTransforms));return b};var si=function(a,b,c){this.data=a;this.fieldMask=b;this.fieldTransforms=c};si.prototype.toMutations=function(a,b){b=[new bh(a,this.data,this.fieldMask,b)];0<this.fieldTransforms.length&&b.push(new ch(a,this.fieldTransforms));return b};
var ui=function(a,b,c,d){this.dataSource=a;this.methodName=b;this.path=c;void 0===d&&ti(this);this.fieldTransforms=d||[]},wi=function(a,b){var c="number"===typeof b?null:null==a.path?null:a.path.child(b);a=new ui(a.dataSource,a.methodName,c,a.fieldTransforms);"string"===typeof b?vi(a,b):"object"===typeof b&&b instanceof Lb&&ti(a);return a},xi=function(a,b){var c=null===a.path||a.path.isEmpty()?"":" (found in field "+a.path.toString()+")";return new A("invalid-argument","Function "+a.methodName+"() called with invalid data. "+
b+c)},ti=function(a){if(null!==a.path)for(var b=0;b<a.path.length;b++)vi(a,a.path.get(b))},vi=function(a,b){if((0===a.dataSource||1===a.dataSource)&&qi.test(b))throw xi(a,"Document fields cannot begin and end with __");},yi=function(a,b){this.databaseId=a;this.key=b},zi=function(a){this.preConverter=a},Ci=function(a,b,c){b=new ui(0,b,Pb);Ai("Data must be an object, but it was:",b,c);a=Bi(a,c,b);return a instanceof M?new ri(a,b.fieldTransforms):x("Parse result should be an object.")},Ei=function(a,
b,c){var d=new ui(1,b,Pb);Ai("Data must be an object, but it was:",d,c);var e=[],f=Cd;Oa(c,function(c,l){try{var h=Ob(c)}catch(y){throw new A("invalid-argument","Function "+b+"() called with invalid data. "+(y instanceof Error?y.message:y.toString()));}c=h;h=wi(d,c);l=Di(a,l,h);l instanceof li?e.push(c):(l=Bi(a,l,h),null!=l&&(e.push(c),f=f.set(c,l)))});return new si(f,new Sg(e),d.fieldTransforms)},Fi=function(a,b,c){b=new ui(2,b,Pb);a=Bi(a,c,b);z(null!=a,"Parsed data should not be null.");z(0===b.fieldTransforms.length,
"Field transforms should have been disallowed.");return a},Di=function(a,b,c){try{return a.preConverter(b)}catch(d){throw xi(c,d instanceof Error?d.message:d.toString());}},Bi=function(a,b,c){b=Di(a,b,c);if(b instanceof Array){if(!c.path)throw xi(c,"Nested arrays are not supported");var d=[],e=0;b=m(b);for(var f=b.next();!f.done;f=b.next())f=Bi(a,f.value,wi(c,e)),null==f&&(f=ld),d.push(f),e++;return new Dd(d)}return Gi(b)?(Ai("Unsupported field value:",c,b),Hi(a,b,c)):Ii(b,c)},Hi=function(a,b,c){var d=
new Tb(E);Oa(b,function(b,f){f=Bi(a,f,wi(c,b));null!=f&&(d=d.insert(b,f))});return new M(d)},Ii=function(a,b){if(null===a)return ld;if("number"===typeof a)return gd(a)&&a<=fd&&a>=ed?new rd(a):new sd(a);if("boolean"===typeof a)return a?nd:od;if("string"===typeof a)return new wd(a);if(a instanceof Date)return new xd(Lc(a.getTime()));if(a instanceof Dh)return new Bd(a);if(a instanceof gb)return new zd(a);if(a instanceof yi)return new Ad(a.databaseId,a.key);if(a instanceof ki){if(a instanceof li){if(1!==
b.dataSource)throw xi(b,"FieldValue.delete() can only be used with update()");z(null==b.path||0<b.path.length,"FieldValue.delete() at the top level should have already been handled.");throw xi(b,"FieldValue.delete() can only appear at the top level of your update data");}if(a instanceof ni){if(0!==b.dataSource&&1!==b.dataSource)throw xi(b,"FieldValue.serverTimestamp() can only be used with set() and update()");if(null===b.path)throw xi(b,"FieldValue.serverTimestamp() is not currently supported inside arrays");
b.fieldTransforms.push(new Vg(b.path,Ug));return null}return x("Unknown FieldValue type: "+a)}throw xi(b,"Unsupported field value: "+Za(a));};function Gi(a){return"object"===typeof a&&null!==a&&!(a instanceof Array)&&!(a instanceof Date)&&!(a instanceof Dh)&&!(a instanceof gb)&&!(a instanceof yi)&&!(a instanceof ki)}function Ai(a,b,c){if(!Gi(c)||!Ya(c)){c=Za(c);if("an object"===c)throw xi(b,a+" a custom object");throw xi(b,a+" "+c);}};var Ji=function(a){if(void 0===a.host){if(void 0!==a.ssl)throw new A("invalid-argument","Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com";this.ssl=!0}else{Ua("settings","string","host option",a.host);this.host=a.host;Xa("settings","boolean","ssl",a.ssl);var b=a.ssl;this.ssl=void 0!==b?b:!0}ab("settings",a,["host","ssl","persistence","credentials"]);Xa("settings","boolean","persistence",a.persistence);b=a.persistence;this.persistence=void 0!==b?b:!1;Xa("settings",
"object","credentials",a.credentials);this.credentials=a.credentials};Ji.prototype.equals=function(a){return this.host===a.host&&this.ssl===a.ssl&&this.persistence===a.persistence&&this.credentials===a.credentials};
var Ki=function(){},Q=function(a){var b=this;this.INTERNAL={"delete":function(){return b._firestoreClient?b._firestoreClient.shutdown():Promise.resolve()}};if("undefined"===typeof Promise)throw Error("Promises are not available. Firestore will not work.");var c=new Ki;if("object"===typeof a.options)c.firebaseApp=a,c.databaseId=Li(a),c.persistenceKey=c.firebaseApp.name,c.credentials=new sb(a);else{if(!a.projectId)throw new A("invalid-argument","Must provide projectId");c.databaseId=new yb(a.projectId,
a.database);c.persistenceKey="[DEFAULT]";c.credentials=new rb}c.settings=new Ji({});this._config=c};
Q.prototype.settings=function(a){B("Firestore.settings",arguments,1);D("Firestore.settings","object",1,a);var b=new Ji(a);if(this._firestoreClient&&!this._config.settings.equals(b))throw new A("failed-precondition","Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");if(this._firestoreReady)return this._firestoreReady;this._config.settings=b;void 0!==b.credentials&&(this._config.credentials=
wb(b.credentials));return Mi(this)};
var Ni=function(a){a._firestoreClient||(a._firestoreReady=Mi(a));return a._firestoreClient},Mi=function(a){z(!!a._config.settings.host,"FirestoreSettings.host cannot be falsey");var b=new xb(a._config.databaseId,a._config.persistenceKey,a._config.settings.host,a._config.settings.ssl);a._dataConverter=new zi(function(b){if(b instanceof R){var c=a._config.databaseId,e=b.firestore._config.databaseId;if(!e.equals(c))throw new A("invalid-argument","Document reference is for database "+(e.projectId+"/"+
e.database+" but should be ")+("for database "+c.projectId+"/"+c.database));return new yi(a._config.databaseId,b._key)}return b});a._firestoreClient=new bi(Ka(),b,a._config.credentials,new hi);return a._firestoreClient.start(a._config.settings.persistence)},Li=function(a){a=a.options;if(!Ma(a,"projectId")){if(Ma(a,"firestoreId"))throw new A("invalid-argument",'"firestoreId" is now specified as "projectId" in firebase.initializeApp.');throw new A("invalid-argument",'"projectId" not provided in firebase.initializeApp.');
}if(Ma(a,"firestoreOptions"))throw new A("invalid-argument",'"firestoreOptions" values are now specified with Firestore.settings()');a=a.projectId;if(!a||"string"!==typeof a)throw new A("invalid-argument","projectId must be a string in firebase.app.App.options");return new yb(a)};
Q.prototype.collection=function(a){B("Firestore.collection",arguments,1);D("Firestore.collection","string",1,a);if(!a)throw new A("invalid-argument","Must provide a non-empty collection path to collection()");Ni(this);return new Oi(Ib(a),this)};Q.prototype.doc=function(a){B("Firestore.doc",arguments,1);D("Firestore.doc","string",1,a);if(!a)throw new A("invalid-argument","Must provide a non-empty document path to doc()");Ni(this);return Pi(Ib(a),this)};
Q.prototype.runTransaction=function(a){var b=this;B("Firestore.runTransaction",arguments,1);D("Firestore.runTransaction","function",1,a);return Ni(this).transaction(function(c){return a(new Qi(b,c))})};Q.prototype.batch=function(){Ni(this);return new Ri(this)};
k.Object.defineProperties(Q.prototype,{_databaseId:{configurable:!0,enumerable:!0,get:function(){return this._config.databaseId}},app:{configurable:!0,enumerable:!0,get:function(){if(!this._config.firebaseApp)throw new A("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp}}});var Qi=function(a,b){this._firestore=a;this._transaction=b;this._firestoreClient=Ni(this._firestore)};
Qi.prototype.get=function(a){var b=this;B("Transaction.get",arguments,1);var c=Si("Transaction.get",a,this._firestore);return this._transaction.lookup([c._key]).then(function(a){if(!a||1!==a.length)return x("Mismatch in docs returned from document lookup.");a=a[0];return a instanceof L?new Ti(b._firestore,c._key,null,!1):new Ti(b._firestore,c._key,a,!1)})};
Qi.prototype.set=function(a,b){B("Transaction.set",arguments,2);var c=Si("Transaction.set",a,this._firestore),d=Ci(this._firestore._dataConverter,"Transaction.set",b);this._transaction.set(c._key,d);return this};Qi.prototype.update=function(a,b,c){Sa("Transaction.update",arguments,2);Ui("Transaction.update",c);var d=Si("Transaction.update",a,this._firestore),e=Ei(this._firestore._dataConverter,"Transaction.update",b);this._transaction.update(d._key,e,c);return this};
Qi.prototype.delete=function(a){B("Transaction.delete",arguments,1);var b=Si("Transaction.delete",a,this._firestore);this._transaction.delete(b._key);return this};var Ri=function(a){this._firestore=a;this._mutations=[];this._committed=!1};Ri.prototype.set=function(a,b){B("WriteBatch.set",arguments,2);Vi(this);var c=Si("WriteBatch.set",a,this._firestore),d=Ci(this._firestore._dataConverter,"WriteBatch.set",b);this._mutations=this._mutations.concat(d.toMutations(c._key,$g));return this};
Ri.prototype.update=function(a,b,c){Sa("WriteBatch.update",arguments,2);Ui("WriteBatch.update",c);Vi(this);var d=Si("WriteBatch.update",a,this._firestore),e=Ei(this._firestore._dataConverter,"WriteBatch.update",b);this._mutations=this._mutations.concat(e.toMutations(d._key,c&&c.createIfMissing?$g:Yg(!0)));return this};
Ri.prototype.delete=function(a){B("WriteBatch.delete",arguments,1);Vi(this);var b=Si("WriteBatch.delete",a,this._firestore);this._mutations=this._mutations.concat(new dh(b._key,$g));return this};Ri.prototype.commit=function(){Vi(this);this._committed=!0;return 0<this._mutations.length?Ni(this._firestore).write(this._mutations):Promise.resolve()};
var Vi=function(a){if(a._committed)throw new A("failed-precondition","A write batch can no longer be used after commit() has been called.");},R=function(a,b){this._key=a;this.firestore=b;this._firestoreClient=Ni(this.firestore)},Pi=function(a,b){if(0!==a.length%2)throw new A("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+(a.canonicalString()+" has "+a.length));return new R(new F(a),b)};g=R.prototype;
g.collection=function(a){B("DocumentReference.collection",arguments,1);D("DocumentReference.collection","string",1,a);if(!a)throw new A("invalid-argument","Must provide a non-empty collection name to collection()");var b=Ib(a);return new Oi(this._key.path.child(b),this.firestore)};g.set=function(a){B("DocumentReference.set",arguments,1);var b=Ci(this.firestore._dataConverter,"DocumentReference.set",a);return this._firestoreClient.write(b.toMutations(this._key,$g))};
g.update=function(a,b){Sa("DocumentReference.update",arguments,1);Ui("DocumentReference.update",b);var c=Ei(this.firestore._dataConverter,"DocumentReference.update",a);return this._firestoreClient.write(c.toMutations(this._key,b&&b.createIfMissing?$g:Yg(!0)))};g.delete=function(){B("DocumentReference.delete",arguments,0);return this._firestoreClient.write([new dh(this._key,$g)])};
g.onSnapshot=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Ta("DocumentReference.onSnapshot",arguments,1,4);var d={includeMetadataChanges:!1};c=0;"object"!==typeof b[c]||ji(b[c])||(d=b[c],ab("DocumentReference.onSnapshot",d,["includeMetadataChanges"]),Xa("DocumentReference.onSnapshot","boolean","includeMetadataChanges",d.includeMetadataChanges),c++);d={includeDocumentMetadataChanges:d.includeMetadataChanges,includeQueryMetadataChanges:d.includeMetadataChanges};ji(b[c])?b=
b[c]:(D("DocumentReference.onSnapshot","function",c,b[c]),Wa("DocumentReference.onSnapshot","function",c+1,b[c+1]),Wa("DocumentReference.onSnapshot","function",c+2,b[c+2]),b={next:b[c],error:b[c+1],complete:b[c+2]});return this.onSnapshotInternal(d,b)};
g.onSnapshotInternal=function(a,b){var c=this,d=function(a){console.error("Uncaught Error in onSnapshot:",a)};b.error&&(d=b.error.bind(b));var e=new fi({next:function(a){if(b.next){z(1>=a.docs.size,"Too many documents returned on a document query");var d=a.docs.get(c._key);b.next(new Ti(c.firestore,c._key,d,a.fromCache))}},error:d}),f=this._firestoreClient.listen(new Fd(this._key.path),e,a);return function(){e.muted=!0;c._firestoreClient.unlisten(f)}};
g.get=function(){var a=this;B("DocumentReference.get",arguments,0);return new Promise(function(b,c){var d=a.onSnapshotInternal({includeQueryMetadataChanges:!0,includeDocumentMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(a){d();!a.exists&&a.metadata.fromCache?c(new A("aborted","Failed to get document because the client is offline.")):b(a)},error:c})})};
k.Object.defineProperties(R.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return Eb(this._key.path)}},parent:{configurable:!0,enumerable:!0,get:function(){return new Oi(Cb(this._key.path),this.firestore)}},path:{configurable:!0,enumerable:!0,get:function(){return this._key.path.canonicalString()}}});var Ti=function(a,b,c,d){this._firestore=a;this._key=b;this._document=c;this._fromCache=d};
Ti.prototype.data=function(){B("DocumentSnapshot.data",arguments,0);if(!this._document)throw new A("not-found","This document doesn't exist. Check doc.exists to make sure the document exists before calling doc.data().");return Wi(this,this._document.data)};
Ti.prototype.get=function(a){B("DocumentSnapshot.get",arguments,1);D("DocumentSnapshot.get","string",1,a);if(!this._document)throw new A("not-found","This document doesn't exist. Check doc.exists to make sure the document exists before calling doc.get().");var b=this._document.data.field(Ob(a));return void 0===b?void 0:Xi(this,b)};
var Wi=function(a,b){var c={};b.forEach(function(b,e){c[b]=Xi(a,e)});return c},Xi=function(a,b){if(b instanceof M)return Wi(a,b);if(b instanceof Dd)return Yi(a,b);if(b instanceof Ad){var c=b.value(),d=Ni(a._firestore).databaseId();b.databaseId.equals(d)&&Ia("Document "+a._key.path+" contains a document reference within a different database ("+(b.databaseId.projectId+"/"+b.databaseId.database+") which is not ")+"supported. It will be treated as a reference in the current "+("database ("+d.projectId+
"/"+d.database+") ")+"instead.");return new R(c,a._firestore)}return b.value()},Yi=function(a,b){return b.internalValue.map(function(b){return Xi(a,b)})};
k.Object.defineProperties(Ti.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return Eb(this._key.path)}},ref:{configurable:!0,enumerable:!0,get:function(){return new R(this._key,this._firestore)}},exists:{configurable:!0,enumerable:!0,get:function(){return null!==this._document}},metadata:{configurable:!0,enumerable:!0,get:function(){return{hasPendingWrites:null!==this._document&&this._document.hasLocalMutations,fromCache:this._fromCache}}}});
var S=function(a,b){this._query=a;this.firestore=b};g=S.prototype;
g.where=function(a,b,c){B("Query.where",arguments,3);D("Query.where","string",1,a);D("Query.where","string",2,b);$a("Query.where",3,c);var d=Fi(this.firestore._dataConverter,"Query.where",c);var e=Ob(a),f=Yd(b);if(d.equals(ld)){if(f!==Md)throw new A("invalid-argument","Invalid query. You can only perform equals comparisons on null.");d=new $d(e)}else if(d.equals(td)){if(f!==Md)throw new A("invalid-argument","Invalid query. You can only perform equals comparisons on NaN.");d=new ae(e)}else d=new Ld(e,
f,d);if(d instanceof Ld&&d.op!==Md){e=Nd(this._query);if(null!==e&&!e.equals(d.field))throw new A("invalid-argument","Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have"+(" inequality filters on '"+e.toString()+"'")+(" and '"+d.field.toString()+"'"));e=Kd(this._query);null!==e&&Zi(d.field,e)}e=this._query;z(null==Nd(e)||!(d instanceof Ld)||d.op===Md||d.field.equals(Nd(e)),"Query must only have one inequality field.");z(0!==e.path.length%2,
"No filtering allowed for document query");d=e.filters.concat([d]);d=new Fd(e.path,e.explicitOrderBy.slice(),d,e.limit,e.startAt,e.endAt);return new S(d,this.firestore)};
g.orderBy=function(a,b){Ta("Query.orderBy",arguments,1,2);D("Query.orderBy","string",1,a);Wa("Query.orderBy","string",2,b);if(void 0===b||"asc"===b)var c=Rd;else if("desc"===b)c=ce;else throw new A("invalid-argument","Function Query.orderBy() has unknown direction '"+b+"', expected 'asc' or 'desc'.");if(null!==this._query.startAt)throw new A("invalid-argument","Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new A("invalid-argument",
"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var d=Ob(a);c=new Pd(d,c);null===Kd(this._query)&&(d=Nd(this._query),null!==d&&Zi(d,c.field));d=this._query;z(0!==d.path.length%2,"No ordering allowed for document query");z(!d.startAt&&!d.endAt,"Bounds must be set after orderBy");c=new Fd(d.path,d.explicitOrderBy.concat([c]),d.filters.slice(),d.limit,d.startAt,d.endAt);return new S(c,this.firestore)};
g.limit=function(a){B("Query.limit",arguments,1);D("Query.limit","number",1,a);if(0>=a)throw new A("invalid-argument","Invalid Query. Query limit ("+a+") is invalid. Limit must be positive.");var b=this._query;var c=a;b=new Fd(b.path,b.explicitOrderBy.slice(),b.filters.slice(),c,b.startAt,b.endAt);return new S(b,this.firestore)};
g.startAt=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.startAt",arguments,1);c=$i(this,"Query.startAt",a,c,!0);return new S(Gd(this._query,c),this.firestore)};g.startAfter=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.startAfter",arguments,1);c=$i(this,"Query.startAfter",a,c,!1);return new S(Gd(this._query,c),this.firestore)};
g.endBefore=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.endBefore",arguments,1);c=$i(this,"Query.endBefore",a,c,!0);return new S(Hd(this._query,c),this.firestore)};g.endAt=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];Sa("Query.endAt",arguments,1);c=$i(this,"Query.endAt",a,c,!1);return new S(Hd(this._query,c),this.firestore)};
var $i=function(a,b,c,d,e){$a(b,1,c);if(c instanceof Ti){if(0<d.length)throw new A("invalid-argument","Too many arguments provided to "+b+"().");if(!c.exists)throw new A("not-found","Can't use a DocumentSnapshot that doesn't exist for "+(b+"()."));b=c._document;c=[];d=m(a._query.orderBy);for(var f=d.next();!f.done;f=d.next())if(f=f.value,Mb(f.field))c.push(new Ad(a.firestore._databaseId,b.key));else{var h=b.field(f.field);if(void 0!==h)c.push(h);else throw a=f.field.canonicalString(),new A("invalid-argument",
"Invalid query. You are trying to start or end a query using a "+("document for which the field '"+a+"' (used as the ")+"orderBy) does not exist.");}return new de(c,e)}c=[c].concat(d);d=a._query.explicitOrderBy;if(c.length>d.length)throw new A("invalid-argument","Too many arguments provided to "+b+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");f=[];for(h=0;h<c.length;h++){var l=c[h];if(Mb(d[h].field)){if("string"!==typeof l)throw new A("invalid-argument",
"Invalid query. Expected a string for document ID in "+(b+"(), but got a "+typeof l));if(-1!==l.indexOf("/"))throw new A("invalid-argument","Invalid query. Document ID '"+l+"' contains a slash in "+(b+"()"));l=new F(a._query.path.child(l));f.push(new Ad(a.firestore._databaseId,l))}else l=Fi(a.firestore._dataConverter,b,l),f.push(l)}return new de(f,e)};
S.prototype.onSnapshot=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];Ta("Query.onSnapshot",arguments,1,4);c={};var d=0;"object"!==typeof b[d]||ji(b[d])||(c=b[d],ab("Query.onSnapshot",c,["includeQueryMetadataChanges","includeDocumentMetadataChanges"]),Xa("Query.onSnapshot","boolean","includeDocumentMetadataChanges",c.includeDocumentMetadataChanges),Xa("Query.onSnapshot","boolean","includeQueryMetadataChanges",c.includeQueryMetadataChanges),d++);ji(b[d])?b=b[d]:(D("Query.onSnapshot",
"function",d,b[d]),Wa("Query.onSnapshot","function",d+1,b[d+1]),Wa("Query.onSnapshot","function",d+2,b[d+2]),b={next:b[d],error:b[d+1],complete:b[d+2]});return this.onSnapshotInternal(c,b)};
S.prototype.onSnapshotInternal=function(a,b){var c=this,d=function(a){console.error("Uncaught Error in onSnapshot:",a)};b.error&&(d=b.error.bind(b));var e=new fi({next:function(a){b.next&&b.next(new aj(c.firestore,c._query,a))},error:d}),f=Ni(this.firestore),h=f.listen(this._query,e,a);return function(){e.muted=!0;f.unlisten(h)}};
S.prototype.get=function(){var a=this;B("Query.get",arguments,0);return new Promise(function(b,c){var d=a.onSnapshotInternal({includeDocumentMetadataChanges:!1,includeQueryMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(a){d();b(a)},error:c})})};
var Zi=function(a,b){if(!b.equals(a))throw new A("invalid-argument","Invalid query. You have a where filter with an inequality "+("(<, <=, >, or >=) on field '"+a.toString()+"' ")+("and so you must also use '"+a.toString()+"' ")+"as your first Query.orderBy(), but your first Query.orderBy() "+("is on field '"+b.toString()+"' instead."));},aj=function(a,b,c){this._firestore=a;this._originalQuery=b;this._snapshot=c;this._cachedChanges=null;this.metadata={fromCache:c.fromCache,hasPendingWrites:c.hasPendingWrites}};
aj.prototype.forEach=function(a,b){var c=this;Ta("QuerySnapshot.forEach",arguments,1,2);D("QuerySnapshot.forEach","function",1,a);this._snapshot.docs.forEach(function(d){a.call(b,new Ti(c._firestore,d.key,d,c.metadata.fromCache))})};
k.Object.defineProperties(aj.prototype,{docs:{configurable:!0,enumerable:!0,get:function(){var a=[];this.forEach(function(b){return a.push(b)});return a}},empty:{configurable:!0,enumerable:!0,get:function(){return this._snapshot.docs.isEmpty()}},size:{configurable:!0,enumerable:!0,get:function(){return this._snapshot.docs.size}},query:{configurable:!0,enumerable:!0,get:function(){return new S(this._originalQuery,this._firestore)}},docChanges:{configurable:!0,enumerable:!0,get:function(){this._cachedChanges||
(this._cachedChanges=bj(this._firestore,this._snapshot));return this._cachedChanges}}});var Oi=function(a,b){S.call(this,new Fd(a),b);if(1!==a.length%2)throw new A("invalid-argument","Invalid collection reference. Collection references must have an odd number of segments, but "+(a.canonicalString()+" has "+a.length));};n(Oi,S);
Oi.prototype.doc=function(a){Ta("CollectionReference.doc",arguments,0,1);Wa("CollectionReference.doc","string",1,a);void 0===a&&(a=cb());if("string"!==typeof a||""===a)throw new A("invalid-argument","Document path must be a non-empty string");var b=Ib(a);return Pi(this._query.path.child(b),this.firestore)};Oi.prototype.add=function(a){B("CollectionReference.add",arguments,1);D("CollectionReference.add","object",1,a);var b=this.doc();return b.set(a).then(function(){return b})};
k.Object.defineProperties(Oi.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return Eb(this._query.path)}},parent:{configurable:!0,enumerable:!0,get:function(){var a=Cb(this._query.path);return a.isEmpty()?null:new R(new F(a),this.firestore)}},path:{configurable:!0,enumerable:!0,get:function(){return this._query.path.canonicalString()}}});function Ui(a,b){b&&(ab(a,b,["createIfMissing"]),Xa(a,"boolean","createIfMissing",b.createIfMissing))}
function Si(a,b,c){if(b instanceof R){if(b.firestore!==c)throw new A("invalid-argument","Provided document reference is from a different Firestore instance.");return b}throw bb(a,"DocumentReference",b);}
function bj(a,b){if(b.oldDocs.isEmpty()){var c,d=0;return b.docChanges.map(function(e){var f=new Ti(a,e.doc.key,e.doc,b.fromCache);z(0===e.type,"Invalid event type for first snapshot");z(!c||0>b.query.docComparator(c,e.doc),"Got added events in wrong order");c=e.doc;return{type:"added",doc:f,oldIndex:-1,newIndex:d++}})}var e=b.oldDocs;return b.docChanges.map(function(c){var d=new Ti(a,c.doc.key,c.doc,b.fromCache),f=-1,t=-1;0!==c.type&&(f=e.indexOf(c.doc.key),z(0<=f,"Index for document not found"),
e=e.delete(c.doc.key));1!==c.type&&(e=e.add(c.doc),t=e.indexOf(c.doc.key));return{type:cj(c.type),doc:d,oldIndex:f,newIndex:t}})}function cj(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x("Unknown change type: "+a)}}
var dj=La(Q,"Use firebase.firestore() instead."),ej=La(Qi,"Use firebase.firestore().runTransaction() instead."),fj=La(Ri,"Use firebase.firestore().batch() instead."),gj=La(R,"Use firebase.firestore().doc() instead."),hj=La(Ti),ij=La(S),jj=La(aj),kj=La(Oi,"Use firebase.firestore().collection() instead.");Q.prototype.settings=Q.prototype.settings;Q.prototype.collection=Q.prototype.collection;Q.prototype.doc=Q.prototype.doc;Q.prototype.runTransaction=Q.prototype.runTransaction;Q.prototype.batch=Q.prototype.batch;Q.prototype.INTERNAL=Q.prototype.INTERNAL;Qi.get=Qi.prototype.get;Qi.set=Qi.prototype.set;Qi.update=Qi.prototype.update;Qi["delete"]=Qi.prototype.delete;Ri.set=Ri.prototype.set;Ri.update=Ri.prototype.update;Ri["delete"]=Ri.prototype.delete;Ri.commit=Ri.prototype.commit;
R.prototype.collection=R.prototype.collection;R.prototype.set=R.prototype.set;R.prototype.update=R.prototype.update;R.prototype["delete"]=R.prototype.delete;R.prototype.onSnapshot=R.prototype.onSnapshot;R.prototype.get=R.prototype.get;Ti.prototype.data=Ti.prototype.data;Ti.prototype.get=Ti.prototype.get;S.prototype.where=S.prototype.where;S.prototype.orderBy=S.prototype.orderBy;S.prototype.limit=S.prototype.limit;S.prototype.startAt=S.prototype.startAt;S.prototype.startAfter=S.prototype.startAfter;
S.prototype.endBefore=S.prototype.endBefore;S.prototype.endAt=S.prototype.endAt;S.prototype.onSnapshot=S.prototype.onSnapshot;S.prototype.get=S.prototype.get;Oi.prototype.doc=Oi.prototype.doc;Oi.prototype.add=Oi.prototype.add;aj.prototype.forEach=aj.prototype.forEach;pi.serverTimestamp=function(){return oi};pi["delete"]=function(){return mi};jb.fromUint8Array=ib;jb.fromBase64String=hb;jb.prototype.toUint8Array=gb.prototype.toUint8Array;jb.prototype.toBase64=gb.prototype.toBase64;var lj={Firestore:dj,GeoPoint:Dh,Blob:jb,Transaction:ej,WriteBatch:fj,DocumentReference:gj,DocumentSnapshot:hj,Query:ij,QuerySnapshot:jj,CollectionReference:kj,FieldValue:pi,setLogLevel:function(a){B("Firestore.setLogLevel",arguments,1);D("Firestore.setLogLevel","string",1,a);switch(a){case "debug":Ga=0;break;case "error":Ga=1;break;case "silent":Ga=2;break;default:throw new A("invalid-argument","Invalid log level: "+a);}}};
function mj(){firebase.INTERNAL.registerService("firestore",function(a){return new Q(a)},Qa(lj))};var nj=function(a){this.wrappedOnMessage=this.wrappedOnClose=this.wrappedOnOpen=null;this.sendFn=a.sendFn;this.closeFn=a.closeFn};g=nj.prototype;g.onOpen=function(a){z(!this.wrappedOnOpen,"Called onOpen on stream twice!");this.wrappedOnOpen=a};g.onClose=function(a){z(!this.wrappedOnClose,"Called onClose on stream twice!");this.wrappedOnClose=a};g.onMessage=function(a){z(!this.wrappedOnMessage,"Called onMessage on stream twice!");this.wrappedOnMessage=a};g.close=function(){this.closeFn()};g.send=function(a){this.sendFn(a)};
var oj=function(a,b){z(null!==a.wrappedOnClose,"Cannot call onClose because no callback was set");a.wrappedOnClose(b)};var pj=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,pj);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))};u(pj,Error);pj.prototype.name="CustomError";var qj=function(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")},rj=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},sj=function(a,b){return a<b?-1:a>b?1:0};var tj=function(a,b){b.unshift(a);pj.call(this,qj.apply(null,b));b.shift()};u(tj,pj);tj.prototype.name="AssertionError";
var uj=function(a,b,c,d){var e="Assertion failed";if(c){e+=": "+c;var f=d}else a&&(e+=": "+a,f=b);throw new tj(""+e,f||[]);},T=function(a,b,c){a||uj("",null,b,Array.prototype.slice.call(arguments,2))},vj=function(a,b){throw new tj("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));},wj=function(a,b,c){sa(a)||uj("Expected number but got %s: %s.",[ua(a),a],b,Array.prototype.slice.call(arguments,2));return a},xj=function(a,b,c){ya(a)||uj("Expected object but got %s: %s.",[ua(a),a],b,Array.prototype.slice.call(arguments,
2))};var yj=Array.prototype.indexOf?function(a,b,c){T(null!=a.length);return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(q(a))return q(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},zj=Array.prototype.lastIndexOf?function(a,b,c){T(null!=a.length);return Array.prototype.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(q(a))return q(b)&&1==
b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1},Aj=Array.prototype.forEach?function(a,b,c){T(null!=a.length);Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=q(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Bj=Array.prototype.some?function(a,b,c){T(null!=a.length);return Array.prototype.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=q(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},Cj=Array.prototype.every?
function(a,b,c){T(null!=a.length);return Array.prototype.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=q(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},Ej=function(a){a:{var b=Dj;for(var c=a.length,d=q(a)?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:q(a)?a.charAt(b):a[b]},Fj=function(a){if(!va(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0},Hj=function(a,b){b=yj(a,b);var c;(c=0<=b)&&Gj(a,b);return c},
Gj=function(a,b){T(null!=a.length);Array.prototype.splice.call(a,b,1)},Ij=function(a){return Array.prototype.concat.apply([],arguments)},Jj=function(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};var Kj=function(){this.disposed_=this.disposed_;this.onDisposeCallbacks_=this.onDisposeCallbacks_};Kj.prototype.disposed_=!1;Kj.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())};Kj.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()};var Lj;a:{var Mj=p.navigator;if(Mj){var Nj=Mj.userAgent;if(Nj){Lj=Nj;break a}}Lj=""}var U=function(a){return-1!=Lj.indexOf(a)};var Oj=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)},Pj=function(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1},Qj=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b},Rj=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b},Sj=function(a){var b={},c;for(c in a)b[c]=a[c];return b},Tj="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Uj=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=
d[c];for(var f=0;f<Tj.length;f++)c=Tj[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var Vj=function(){return U("iPhone")&&!U("iPod")&&!U("iPad")};var Wj=function(a){Wj[" "](a);return a};Wj[" "]=ta;var Yj=function(a,b){var c=Xj;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)};var Zj=U("Opera"),ak=U("Trident")||U("MSIE"),bk=U("Edge"),ck=U("Gecko")&&!(-1!=Lj.toLowerCase().indexOf("webkit")&&!U("Edge"))&&!(U("Trident")||U("MSIE"))&&!U("Edge"),dk=-1!=Lj.toLowerCase().indexOf("webkit")&&!U("Edge");dk&&U("Mobile");U("Macintosh");U("Windows");U("Linux")||U("CrOS");var ek=p.navigator||null;ek&&(ek.appVersion||"").indexOf("X11");U("Android");Vj();U("iPad");U("iPod");Vj()||U("iPad")||U("iPod");var fk=function(){var a=p.document;return a?a.documentMode:void 0},gk;
a:{var hk="",ik=function(){var a=Lj;if(ck)return/rv\:([^\);]+)(\)|;)/.exec(a);if(bk)return/Edge\/([\d\.]+)/.exec(a);if(ak)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(dk)return/WebKit\/(\S+)/.exec(a);if(Zj)return/(?:Version)[ \/]?(\S+)/.exec(a)}();ik&&(hk=ik?ik[1]:"");if(ak){var jk=fk();if(null!=jk&&jk>parseFloat(hk)){gk=String(jk);break a}}gk=hk}
var kk=gk,Xj={},lk=function(a){return Yj(a,function(){for(var b=0,c=rj(String(kk)).split("."),d=rj(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var h=c[f]||"",l=d[f]||"";do{h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""];l=/(\d*)(\D*)(.*)/.exec(l)||["","","",""];if(0==h[0].length&&0==l[0].length)break;b=sj(0==h[1].length?0:parseInt(h[1],10),0==l[1].length?0:parseInt(l[1],10))||sj(0==h[2].length,0==l[2].length)||sj(h[2],l[2]);h=h[3];l=l[3]}while(0==b)}return 0<=b})},mk;var nk=p.document;
mk=nk&&ak?fk()||("CSS1Compat"==nk.compatMode?parseInt(kk,10):5):void 0;var ok=!ak||9<=Number(mk),pk=ak&&!lk("9");!dk||lk("528");ck&&lk("1.9b")||ak&&lk("8")||Zj&&lk("9.5")||dk&&lk("528");ck&&!lk("8")||ak&&lk("9");var qk=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});p.addEventListener("test",ta,b);p.removeEventListener("test",ta,b);return a}();var V=function(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.propagationStopped_=!1;this.returnValue_=!0};V.prototype.stopPropagation=function(){this.propagationStopped_=!0};V.prototype.preventDefault=function(){this.defaultPrevented=!0;this.returnValue_=!1};var rk=function(a,b){V.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key="";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.event_=this.state=null;a&&this.init(a,b)};u(rk,V);
rk.prototype.init=function(a,b){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(ck){a:{try{Wj(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.offsetX=dk||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=dk||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,
this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||"";this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.state=a.state;this.event_=a;
a.defaultPrevented&&this.preventDefault()};rk.prototype.stopPropagation=function(){rk.superClass_.stopPropagation.call(this);this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0};rk.prototype.preventDefault=function(){rk.superClass_.preventDefault.call(this);var a=this.event_;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,pk)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var sk="closure_listenable_"+(1E6*Math.random()|0),tk=function(a){return!(!a||!a[sk])},uk=0;var vk=function(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.handler=e;this.key=++uk;this.removed=this.callOnce=!1},wk=function(a){a.removed=!0;a.listener=null;a.proxy=null;a.src=null;a.handler=null};var xk=function(a){this.src=a;this.listeners={};this.typeCount_=0};xk.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.listeners[f];a||(a=this.listeners[f]=[],this.typeCount_++);var h=yk(a,b,d,e);-1<h?(b=a[h],c||(b.callOnce=!1)):(b=new vk(b,this.src,f,!!d,e),b.callOnce=c,a.push(b));return b};
xk.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.listeners))return!1;var e=this.listeners[a];b=yk(e,b,c,d);return-1<b?(wk(e[b]),Gj(e,b),0==e.length&&(delete this.listeners[a],this.typeCount_--),!0):!1};var zk=function(a,b){var c=b.type;c in a.listeners&&Hj(a.listeners[c],b)&&(wk(b),0==a.listeners[c].length&&(delete a.listeners[c],a.typeCount_--))};
xk.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.listeners)if(!a||c==a){for(var d=this.listeners[c],e=0;e<d.length;e++)++b,wk(d[e]);delete this.listeners[c];this.typeCount_--}return b};xk.prototype.getListener=function(a,b,c,d){a=this.listeners[a.toString()];var e=-1;a&&(e=yk(a,b,c,d));return-1<e?a[e]:null};
xk.prototype.hasListener=function(a,b){var c=ra(a),d=c?a.toString():"",e=ra(b);return Pj(this.listeners,function(a){for(var f=0;f<a.length;++f)if(!(c&&a[f].type!=d||e&&a[f].capture!=b))return!0;return!1})};var yk=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.listener==b&&f.capture==!!c&&f.handler==d)return e}return-1};var Ak="closure_lm_"+(1E6*Math.random()|0),Bk={},Ck=0,Ek=function(a,b,c,d,e){if(d&&d.once)return Dk(a,b,c,d,e);if(va(b)){for(var f=0;f<b.length;f++)Ek(a,b[f],c,d,e);return null}c=Fk(c);return tk(a)?a.listen(b,c,ya(d)?!!d.capture:!!d,e):Gk(a,b,c,!1,d,e)},Gk=function(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var h=ya(e)?!!e.capture:!!e,l=Hk(a);l||(a[Ak]=l=new xk(a));c=l.add(b,c,d,h,f);if(c.proxy)return c;d=Ik();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)qk||(e=h),void 0===e&&(e=
!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Jk(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");Ck++;return c},Ik=function(){var a=Kk,b=ok?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b},Dk=function(a,b,c,d,e){if(va(b)){for(var f=0;f<b.length;f++)Dk(a,b[f],c,d,e);return null}c=Fk(c);return tk(a)?a.listenOnce(b,c,ya(d)?!!d.capture:!!d,e):Gk(a,b,c,!0,d,e)},Lk=function(a,
b,c,d,e){if(va(b))for(var f=0;f<b.length;f++)Lk(a,b[f],c,d,e);else d=ya(d)?!!d.capture:!!d,c=Fk(c),tk(a)?a.unlisten(b,c,d,e):a&&(a=Hk(a))&&(b=a.getListener(b,c,d,e))&&Mk(b)},Mk=function(a){if(!sa(a)&&a&&!a.removed){var b=a.src;if(tk(b))zk(b.eventTargetListeners_,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(Jk(c),d);Ck--;(c=Hk(b))?(zk(c,a),0==c.typeCount_&&(c.src=null,b[Ak]=null)):wk(a)}}},Jk=function(a){return a in Bk?Bk[a]:
Bk[a]="on"+a},Ok=function(a,b,c,d){var e=!0;if(a=Hk(a))if(b=a.listeners[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.removed&&(f=Nk(f,d),e=e&&!1!==f)}return e},Nk=function(a,b){var c=a.listener,d=a.handler||a.src;a.callOnce&&Mk(a);return c.call(d,b)},Kk=function(a,b){if(a.removed)return!0;if(!ok){if(!b)a:{b=["window","event"];for(var c=p,d;d=b.shift();)if(null!=c[d])c=c[d];else{b=null;break a}b=c}d=b;b=new rk(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=
!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(h){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);e=a.type;for(var f=d.length-1;!b.propagationStopped_&&0<=f;f--)b.currentTarget=d[f],a=Ok(d[f],e,!0,b),c=c&&a;for(f=0;!b.propagationStopped_&&f<d.length;f++)b.currentTarget=d[f],a=Ok(d[f],e,!1,b),c=c&&a}return c}return Nk(a,new rk(b,this))},Hk=function(a){a=a[Ak];return a instanceof xk?a:null},Pk="__closure_events_fn_"+(1E9*Math.random()>>>0),
Fk=function(a){T(a,"Listener can not be null.");if(xa(a))return a;T(a.handleEvent,"An object listener must have handleEvent method.");a[Pk]||(a[Pk]=function(b){return a.handleEvent(b)});return a[Pk]};var Qk=function(){V.call(this,"d")};u(Qk,V);var Rk=function(){V.call(this,"c")};u(Rk,V);var Sk=function(a,b,c){this.limit_=c;this.create_=a;this.reset_=b;this.occupants_=0;this.head_=null};Sk.prototype.get=function(){if(0<this.occupants_){this.occupants_--;var a=this.head_;this.head_=a.next;a.next=null}else a=this.create_();return a};Sk.prototype.put=function(a){this.reset_(a);this.occupants_<this.limit_&&(this.occupants_++,a.next=this.head_,this.head_=a)};var Tk=function(a){p.setTimeout(function(){throw a;},0)},Uk,Vk=function(){var a=p.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!U("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow;a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host;
a=r(function(a){if(("*"==d||a.origin==d)&&a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!U("Trident")&&!U("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(ra(c.next)){c=c.next;var a=c.cb;c.cb=null;a()}};return function(a){d.next={cb:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?
function(a){var b=document.createElement("SCRIPT");b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){p.setTimeout(a,0)}};var Wk=function(){this.workTail_=this.workHead_=null},Yk=new Sk(function(){return new Xk},function(a){a.reset()},100);Wk.prototype.add=function(a,b){var c=Yk.get();c.set(a,b);this.workTail_?this.workTail_.next=c:(T(!this.workHead_),this.workHead_=c);this.workTail_=c};Wk.prototype.remove=function(){var a=null;this.workHead_&&(a=this.workHead_,this.workHead_=this.workHead_.next,this.workHead_||(this.workTail_=null),a.next=null);return a};var Xk=function(){this.next=this.scope=this.fn=null};
Xk.prototype.set=function(a,b){this.fn=a;this.scope=b;this.next=null};Xk.prototype.reset=function(){this.next=this.scope=this.fn=null};var Zk,al=function(){if(-1!=String(p.Promise).indexOf("[native code]")){var a=p.Promise.resolve(void 0);Zk=function(){a.then($k)}}else Zk=function(){var a=$k;!xa(p.setImmediate)||p.Window&&p.Window.prototype&&!U("Edge")&&p.Window.prototype.setImmediate==p.setImmediate?(Uk||(Uk=Vk()),Uk(a)):p.setImmediate(a)}},bl=!1,cl=new Wk,$k=function(){for(var a;a=cl.remove();){try{a.fn.call(a.scope)}catch(b){Tk(b)}Yk.put(a)}bl=!1};var dl=function(){Kj.call(this);this.eventTargetListeners_=new xk(this);this.actualEventTarget_=this;this.parentEventTarget_=null};u(dl,Kj);dl.prototype[sk]=!0;g=dl.prototype;g.addEventListener=function(a,b,c,d){Ek(this,a,b,c,d)};g.removeEventListener=function(a,b,c,d){Lk(this,a,b,c,d)};
g.dispatchEvent=function(a){el(this);var b=this.parentEventTarget_;if(b){var c=[];for(var d=1;b;b=b.parentEventTarget_)c.push(b),T(1E3>++d,"infinite loop")}b=this.actualEventTarget_;d=a.type||a;if(q(a))a=new V(a,b);else if(a instanceof V)a.target=a.target||b;else{var e=a;a=new V(d,b);Uj(a,e)}e=!0;if(c)for(var f=c.length-1;!a.propagationStopped_&&0<=f;f--){var h=a.currentTarget=c[f];e=fl(h,d,!0,a)&&e}a.propagationStopped_||(h=a.currentTarget=b,e=fl(h,d,!0,a)&&e,a.propagationStopped_||(e=fl(h,d,!1,
a)&&e));if(c)for(f=0;!a.propagationStopped_&&f<c.length;f++)h=a.currentTarget=c[f],e=fl(h,d,!1,a)&&e;return e};g.disposeInternal=function(){dl.superClass_.disposeInternal.call(this);this.removeAllListeners();this.parentEventTarget_=null};g.listen=function(a,b,c,d){el(this);return this.eventTargetListeners_.add(String(a),b,!1,c,d)};g.listenOnce=function(a,b,c,d){return this.eventTargetListeners_.add(String(a),b,!0,c,d)};
g.unlisten=function(a,b,c,d){return this.eventTargetListeners_.remove(String(a),b,c,d)};g.removeAllListeners=function(a){return this.eventTargetListeners_?this.eventTargetListeners_.removeAll(a):0};var fl=function(a,b,c,d){b=a.eventTargetListeners_.listeners[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var h=b[f];if(h&&!h.removed&&h.capture==c){var l=h.listener,t=h.handler||h.src;h.callOnce&&zk(a.eventTargetListeners_,h);e=!1!==l.call(t,d)&&e}}return e&&0!=d.returnValue_};
dl.prototype.getListener=function(a,b,c,d){return this.eventTargetListeners_.getListener(String(a),b,c,d)};dl.prototype.hasListener=function(a,b){return this.eventTargetListeners_.hasListener(ra(a)?String(a):void 0,b)};var el=function(a){T(a.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")};var gl=function(a,b){dl.call(this);this.interval_=a||1;this.timerObject_=b||p;this.boundTick_=r(this.tick_,this);this.last_=Ea()};u(gl,dl);g=gl.prototype;g.enabled=!1;g.timer_=null;g.setInterval=function(a){this.interval_=a;this.timer_&&this.enabled?(this.stop(),this.start()):this.timer_&&this.stop()};
g.tick_=function(){if(this.enabled){var a=Ea()-this.last_;0<a&&a<.8*this.interval_?this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_-a):(this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null),this.dispatchEvent("tick"),this.enabled&&(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=Ea()))}};
g.start=function(){this.enabled=!0;this.timer_||(this.timer_=this.timerObject_.setTimeout(this.boundTick_,this.interval_),this.last_=Ea())};g.stop=function(){this.enabled=!1;this.timer_&&(this.timerObject_.clearTimeout(this.timer_),this.timer_=null)};g.disposeInternal=function(){gl.superClass_.disposeInternal.call(this);this.stop();delete this.timerObject_};
var hl=function(a,b,c){if(xa(a))c&&(a=r(a,c));else if(a&&"function"==typeof a.handleEvent)a=r(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:p.setTimeout(a,b||0)};var il=function(a,b,c){Kj.call(this);this.listener_=null!=c?r(a,c):a;this.interval_=b;this.callback_=r(this.onTimer_,this);this.args_=[]};u(il,Kj);g=il.prototype;g.shouldFire_=!1;g.pauseCount_=0;g.timer_=null;g.fire=function(a){this.args_=arguments;this.timer_||this.pauseCount_?this.shouldFire_=!0:jl(this)};g.stop=function(){this.timer_&&(p.clearTimeout(this.timer_),this.timer_=null,this.shouldFire_=!1,this.args_=[])};g.pause=function(){this.pauseCount_++};
g.resume=function(){this.pauseCount_--;this.pauseCount_||!this.shouldFire_||this.timer_||(this.shouldFire_=!1,jl(this))};g.disposeInternal=function(){il.superClass_.disposeInternal.call(this);this.stop()};g.onTimer_=function(){this.timer_=null;this.shouldFire_&&!this.pauseCount_&&(this.shouldFire_=!1,jl(this))};var jl=function(a){a.timer_=hl(a.callback_,a.interval_);a.listener_.apply(null,a.args_)};var kl=function(a,b,c,d,e){this.reset(a,b,c,d,e)};kl.prototype.exception_=null;var ll=0;kl.prototype.reset=function(a,b,c,d,e){"number"==typeof e||ll++;d||Ea();this.level_=a;this.msg_=b;delete this.exception_};kl.prototype.setLevel=function(a){this.level_=a};var ml=function(a){this.name_=a;this.handlers_=this.children_=this.level_=this.parent_=null},nl=function(a,b){this.name=a;this.value=b};nl.prototype.toString=function(){return this.name};var ol=new nl("SEVERE",1E3),pl=new nl("WARNING",900),ql=new nl("INFO",800),rl=new nl("CONFIG",700),sl=new nl("FINE",500);ml.prototype.getName=function(){return this.name_};ml.prototype.getParent=function(){return this.parent_};ml.prototype.getChildren=function(){this.children_||(this.children_={});return this.children_};
ml.prototype.setLevel=function(a){this.level_=a};var tl=function(a){if(a.level_)return a.level_;if(a.parent_)return tl(a.parent_);vj("Root logger has no level set.");return null};g=ml.prototype;g.log=function(a,b,c){if(a.value>=tl(this).value)for(xa(b)&&(b=b()),a=new kl(a,String(b),this.name_),c&&(a.exception_=c),c="log:"+a.msg_,(b=p.console)&&b.timeStamp&&b.timeStamp(c),(b=p.msWriteProfilerMark)&&b(c),c=this;c;){var d=c,e=a;if(d.handlers_)for(var f=0;b=d.handlers_[f];f++)b(e);c=c.getParent()}};
g.severe=function(a,b){this.log(ol,a,b)};g.warning=function(a,b){this.log(pl,a,b)};g.info=function(a,b){this.log(ql,a,b)};g.config=function(a,b){this.log(rl,a,b)};var ul={},vl=null,wl=function(a){vl||(vl=new ml(""),ul[""]=vl,vl.setLevel(rl));var b;if(!(b=ul[a])){b=new ml(a);var c=a.lastIndexOf("."),d=a.substr(c+1);c=wl(a.substr(0,c));c.getChildren()[d]=b;b.parent_=c;ul[a]=b}return b};var xl=function(){this.relativeTimeStart_=Ea()},yl=null;xl.prototype.set=function(a){this.relativeTimeStart_=a};xl.prototype.reset=function(){this.set(Ea())};xl.prototype.get=function(){return this.relativeTimeStart_};var zl=function(){yl||(yl=new xl)},Al=function(){yl||(yl=new xl)};u(Al,zl);var Bl=function(a){Kj.call(this);this.handler_=a;this.keys_={}};u(Bl,Kj);var Cl=[];Bl.prototype.listen=function(a,b,c,d){va(b)||(b&&(Cl[0]=b.toString()),b=Cl);for(var e=0;e<b.length;e++){var f=Ek(a,b[e],c||this.handleEvent,d||!1,this.handler_||this);if(!f)break;this.keys_[f.key]=f}return this};Bl.prototype.listenOnce=function(a,b,c,d){return Dl(this,a,b,c,d)};
var Dl=function(a,b,c,d,e,f){if(va(c))for(var h=0;h<c.length;h++)Dl(a,b,c[h],d,e,f);else{b=Dk(b,c,d||a.handleEvent,e,f||a.handler_||a);if(!b)return a;a.keys_[b.key]=b}return a};Bl.prototype.unlisten=function(a,b,c,d,e){if(va(b))for(var f=0;f<b.length;f++)this.unlisten(a,b[f],c,d,e);else c=c||this.handleEvent,d=ya(d)?!!d.capture:!!d,e=e||this.handler_||this,c=Fk(c),d=!!d,b=tk(a)?a.getListener(b,c,d,e):a?(a=Hk(a))?a.getListener(b,c,d,e):null:null,b&&(Mk(b),delete this.keys_[b.key]);return this};
Bl.prototype.removeAll=function(){Oj(this.keys_,function(a,b){this.keys_.hasOwnProperty(b)&&Mk(a)},this);this.keys_={}};Bl.prototype.disposeInternal=function(){Bl.superClass_.disposeInternal.call(this);this.removeAll()};Bl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};var El="StopIteration"in p?p.StopIteration:{message:"StopIteration",stack:""},Fl=function(){};Fl.prototype.next=function(){throw El;};Fl.prototype.__iterator__=function(){return this};var Gl=function(a){return/^\s*$/.test(a)?!1:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/(?:"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)[\s\u2028\u2029]*(?=:|,|]|}|$)/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,""))},Hl=function(a){a=String(a);if(Gl(a))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a);},Kl=function(a){var b=[];Il(new Jl,a,b);return b.join("")},Jl=function(){this.replacer_=
void 0},Il=function(a,b,c){if(null==b)c.push("null");else{if("object"==typeof b){if(va(b)){var d=b;b=d.length;c.push("[");for(var e="",f=0;f<b;f++)c.push(e),e=d[f],Il(a,a.replacer_?a.replacer_.call(d,String(f),e):e,c),e=",";c.push("]");return}if(b instanceof String||b instanceof Number||b instanceof Boolean)b=b.valueOf();else{c.push("{");f="";for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(e=b[d],"function"!=typeof e&&(c.push(f),Ll(d,c),c.push(":"),Il(a,a.replacer_?a.replacer_.call(b,d,e):
e,c),f=","));c.push("}");return}}switch(typeof b){case "string":Ll(b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?String(b):"null");break;case "boolean":c.push(String(b));break;case "function":c.push("null");break;default:throw Error("Unknown type: "+typeof b);}}},Ml={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},Nl=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,Ll=function(a,b){b.push('"',a.replace(Nl,
function(a){var b=Ml[a];b||(b="\\u"+(a.charCodeAt(0)|65536).toString(16).substr(1),Ml[a]=b);return b}),'"')};var Ol=function(a,b){T(ra(p.JSON),"JSON not defined");this.replacer_=a;this.reviver_=b};Ol.prototype.stringify=function(a){return p.JSON.stringify(a,this.replacer_)};Ol.prototype.parse=function(a){return p.JSON.parse(a,this.reviver_)};var Pl=new dl,Ql=function(a){V.call(this,"serverreachability",a)};u(Ql,V);var Rl=function(){Pl.dispatchEvent(new Ql(Pl))},Sl=function(a,b){V.call(this,"statevent",a);this.stat=b};u(Sl,V);var W=function(a){Pl.dispatchEvent(new Sl(Pl,a))},Tl=function(a,b,c){V.call(this,"timingevent",a);this.size=b;this.rtt=c};u(Tl,V);var Ul=function(a,b){if(!xa(a))throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){a()},b)};var Vl=function(a,b){a&&a.info(b,void 0)},Wl=function(a,b){a&&a.log(sl,b,void 0)};var Xl=function(){this.logger_=wl("goog.labs.net.webChannel.WebChannelDebug")},Zl=function(a,b,c,d){a.info("XMLHTTP TEXT ("+b+"): "+Yl(a,c)+(d?" "+d:""))};Xl.prototype.debug=function(a){this.info(a)};var $l=function(a,b,c){a.severe((c||"Exception")+b)};Xl.prototype.info=function(a){Vl(this.logger_,a)};Xl.prototype.warning=function(a){var b=this.logger_;b&&b.warning(a,void 0)};Xl.prototype.severe=function(a){var b=this.logger_;b&&b.severe(a,void 0)};
var Yl=function(a,b){if(!b)return null;try{var c=JSON.parse(b);if(c)for(var d=0;d<c.length;d++)if(va(c[d])){var e=c[d];if(!(2>e.length)){var f=e[1];if(va(f)&&!(1>f.length)){var h=f[0];if("noop"!=h&&"stop"!=h&&"close"!=h)for(var l=1;l<f.length;l++)f[l]=""}}}return Kl(c)}catch(t){return a.debug("Exception parsing expected JS array - probably was not JS"),b}};var am=function(){};am.prototype.cachedOptions_=null;var cm=function(a){var b;(b=a.cachedOptions_)||(b={},bm(a)&&(b[0]=!0,b[1]=!0),b=a.cachedOptions_=b);return b};var dm,em=function(){};u(em,am);var fm=function(a){return(a=bm(a))?new ActiveXObject(a):new XMLHttpRequest},bm=function(a){if(!a.ieProgId_&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.ieProgId_=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return a.ieProgId_};
dm=new em;var gm=function(a,b,c,d,e){this.channel_=a;this.channelDebug_=b;this.sid_=c;this.rid_=d;this.retryId_=e||1;this.eventHandler_=new Bl(this);this.timeout_=45E3;this.pollingTimer_=new gl;this.pollingTimer_.setInterval(250);this.extraHeaders_=null;this.successful_=!1;this.xmlHttp_=this.postData_=this.requestUri_=this.baseUri_=this.type_=this.requestStartTime_=this.watchDogTimeoutTime_=this.watchDogTimerId_=null;this.xmlHttpChunkStart_=0;this.lastError_=this.verb_=null;this.lastStatusCode_=-1;this.cancelled_=
!1;this.readyStateChangeThrottleMs_=0;this.readyStateChangeThrottle_=null;this.decodeChunks_=!1},hm=function(a,b){switch(a){case 0:return"Non-200 return code ("+b+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}},im={},jm={};gm.prototype.setExtraHeaders=function(a){this.extraHeaders_=a};gm.prototype.setTimeout=function(a){this.timeout_=a};gm.prototype.setReadyStateChangeThrottle=function(a){this.readyStateChangeThrottleMs_=a};
var mm=function(a,b,c){a.type_=1;a.baseUri_=km(b.clone());a.postData_=c;a.decodeChunks_=!0;lm(a,null)},nm=function(a,b,c,d){a.type_=1;a.baseUri_=km(b.clone());a.postData_=null;a.decodeChunks_=c;lm(a,d)},lm=function(a,b){a.requestStartTime_=Ea();om(a);a.requestUri_=a.baseUri_.clone();pm(a.requestUri_,"t",a.retryId_);a.xmlHttpChunkStart_=0;a.xmlHttp_=a.channel_.createXhrIo(a.channel_.shouldUseSecondaryDomains()?b:null);0<a.readyStateChangeThrottleMs_&&(a.readyStateChangeThrottle_=new il(r(a.xmlHttpHandler_,
a,a.xmlHttp_),a.readyStateChangeThrottleMs_));a.eventHandler_.listen(a.xmlHttp_,"readystatechange",a.readyStateChangeHandler_);b=a.extraHeaders_?Sj(a.extraHeaders_):{};a.postData_?(a.verb_||(a.verb_="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.xmlHttp_.send(a.requestUri_,a.verb_,a.postData_,b)):(a.verb_="GET",a.xmlHttp_.send(a.requestUri_,a.verb_,null,b));Rl();var c=a.postData_;if(c){b="";c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("=");if(1<e.length){var f=e[0];
e=e[1];var h=f.split("_");b=2<=h.length&&"type"==h[1]?b+(f+"="+e+"&"):b+(f+"=redacted&")}}}else b=null;a.channelDebug_.info("XMLHTTP REQ ("+a.rid_+") [attempt "+a.retryId_+"]: "+a.verb_+"\n"+a.requestUri_+"\n"+b)};gm.prototype.readyStateChangeHandler_=function(a){a=a.target;var b=this.readyStateChangeThrottle_;b&&3==qm(a)?(this.channelDebug_.debug("Throttling readystatechange."),b.fire()):this.xmlHttpHandler_(a)};
gm.prototype.xmlHttpHandler_=function(a){try{if(a==this.xmlHttp_){var b=qm(this.xmlHttp_),c=this.xmlHttp_.lastErrorCode_;if(!(3>b||3==b&&!Zj&&!rm(this.xmlHttp_))){this.cancelled_||4!=b||7==c||Rl();sm(this);var d=tm(this.xmlHttp_);this.lastStatusCode_=d;var e=rm(this.xmlHttp_);e||this.channelDebug_.debug("No response text for uri "+this.requestUri_+" status "+d);this.successful_=200==d;this.channelDebug_.info("XMLHTTP RESP ("+this.rid_+") [ attempt "+this.retryId_+"]: "+this.verb_+"\n"+this.requestUri_+
"\n"+b+" "+d);if(this.successful_){if(this.decodeChunks_?(um(this,b,e),Zj&&this.successful_&&3==b&&(this.eventHandler_.listen(this.pollingTimer_,"tick",this.pollResponse_),this.pollingTimer_.start())):(Zl(this.channelDebug_,this.rid_,e,null),wm(this,e)),4==b&&xm(this),this.successful_&&!this.cancelled_)if(4==b)this.channel_.onRequestComplete(this);else this.successful_=!1,om(this)}else 400==d&&0<e.indexOf("Unknown SID")?(this.lastError_=3,W(12),this.channelDebug_.warning("XMLHTTP Unknown SID ("+this.rid_+
")")):(this.lastError_=0,W(13),this.channelDebug_.warning("XMLHTTP Bad status "+d+" ("+this.rid_+")")),xm(this),ym(this)}}else this.channelDebug_.warning("Called back with an unexpected xmlhttp")}catch(f){this.channelDebug_.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.xmlHttp_&&rm(this.xmlHttp_)?$l(this.channelDebug_,f,"ResponseText: "+rm(this.xmlHttp_)):$l(this.channelDebug_,f,"No response text")}finally{}};
var um=function(a,b,c){for(var d=!0;!a.cancelled_&&a.xmlHttpChunkStart_<c.length;){var e=zm(a,c);if(e==jm){4==b&&(a.lastError_=4,W(14),d=!1);Zl(a.channelDebug_,a.rid_,null,"[Incomplete Response]");break}else if(e==im){a.lastError_=4;W(15);Zl(a.channelDebug_,a.rid_,c,"[Invalid Chunk]");d=!1;break}else Zl(a.channelDebug_,a.rid_,e,null),wm(a,e)}4==b&&0==c.length&&(a.lastError_=1,W(16),d=!1);a.successful_=a.successful_&&d;d||(Zl(a.channelDebug_,a.rid_,c,"[Invalid Chunked Response]"),xm(a),ym(a))};
gm.prototype.pollResponse_=function(){var a=qm(this.xmlHttp_),b=rm(this.xmlHttp_);this.xmlHttpChunkStart_<b.length&&(sm(this),um(this,a,b),this.successful_&&4!=a&&om(this))};var zm=function(a,b){var c=a.xmlHttpChunkStart_,d=b.indexOf("\n",c);if(-1==d)return jm;c=Number(b.substring(c,d));if(isNaN(c))return im;d+=1;if(d+c>b.length)return jm;b=b.substr(d,c);a.xmlHttpChunkStart_=d+c;return b};gm.prototype.cancel=function(){this.cancelled_=!0;xm(this)};
var om=function(a){a.watchDogTimeoutTime_=Ea()+a.timeout_;Am(a,a.timeout_)},Am=function(a,b){if(null!=a.watchDogTimerId_)throw Error("WatchDog timer not null");a.watchDogTimerId_=Ul(r(a.onWatchDogTimeout_,a),b)},sm=function(a){a.watchDogTimerId_&&(p.clearTimeout(a.watchDogTimerId_),a.watchDogTimerId_=null)};
gm.prototype.onWatchDogTimeout_=function(){this.watchDogTimerId_=null;var a=Ea();0<=a-this.watchDogTimeoutTime_?(this.successful_&&this.channelDebug_.severe("Received watchdog timeout even though request loaded successfully"),this.channelDebug_.info("TIMEOUT: "+this.requestUri_),2!=this.type_&&(Rl(),W(17)),xm(this),this.lastError_=2,ym(this)):(this.channelDebug_.warning("WatchDog timer called too early"),Am(this,this.watchDogTimeoutTime_-a))};
var ym=function(a){if(!a.channel_.isClosed()&&!a.cancelled_)a.channel_.onRequestComplete(a)},xm=function(a){sm(a);var b=a.readyStateChangeThrottle_;b&&"function"==typeof b.dispose&&b.dispose();a.readyStateChangeThrottle_=null;a.pollingTimer_.stop();a.eventHandler_.removeAll();a.xmlHttp_&&(b=a.xmlHttp_,a.xmlHttp_=null,b.abort(),b.dispose())};gm.prototype.getLastError=function(){return this.lastError_};var wm=function(a,b){try{a.channel_.onRequestData(a,b),Rl()}catch(c){$l(a.channelDebug_,c,"Error in httprequest callback")}};var Bm=function(a,b){this.channel_=a;this.channelDebug_=b;this.request_=this.extraHeaders_=null;this.receivedIntermediateResult_=!1;this.path_=null;this.lastStatusCode_=-1;this.clientProtocol_=this.hostPrefix_=null};Bm.prototype.state_=null;Bm.prototype.setExtraHeaders=function(a){this.extraHeaders_=a};
Bm.prototype.connect=function(a){this.path_=a;a=Cm(this.channel_,this.path_);W(3);var b=this.channel_.connState_.handshakeResult;null!=b?(this.hostPrefix_=this.channel_.correctHostPrefix(b[0]),this.state_=1,Dm(this)):(pm(a,"MODE","init"),!this.channel_.backgroundChannelTest_&&this.channel_.httpSessionIdParam_&&pm(a,"X-HTTP-Session-Id",this.channel_.httpSessionIdParam_),this.request_=new gm(this,this.channelDebug_,void 0,void 0,void 0),this.request_.setExtraHeaders(this.extraHeaders_),nm(this.request_,
a,!1,null),this.state_=0)};
var Dm=function(a){a.channelDebug_.debug("TestConnection: starting stage 2");var b=a.channel_.connState_.bufferingProxyResult;if(null!=b)a.channelDebug_.debug("TestConnection: skipping stage 2, precomputed result is "+b?"Buffered":"Unbuffered"),W(4),b?(W(10),Em(a.channel_,a,!1)):(W(11),Em(a.channel_,a,!0));else{a.request_=new gm(a,a.channelDebug_,void 0,void 0,void 0);a.request_.setExtraHeaders(a.extraHeaders_);b=Fm(a.channel_,a.hostPrefix_,a.path_);W(4);pm(b,"TYPE","xmlhttp");var c=a.channel_.httpSessionIdParam_,
d=a.channel_.httpSessionId_;c&&d&&X(b,c,d);nm(a.request_,b,!1,a.hostPrefix_)}};g=Bm.prototype;g.createXhrIo=function(a){return this.channel_.createXhrIo(a)};g.abort=function(){this.request_&&(this.request_.cancel(),this.request_=null);this.lastStatusCode_=-1};g.isClosed=function(){return!1};
g.onRequestData=function(a,b){this.lastStatusCode_=a.lastStatusCode_;if(0==this.state_)if(this.channelDebug_.debug("TestConnection: Got data for stage 1"),this.applyControlHeaders_(a),b){try{var c=Gm(this.channel_.wireCodec_,b)}catch(d){$l(this.channelDebug_,d);Hm(this.channel_,this);return}this.hostPrefix_=this.channel_.correctHostPrefix(c[0])}else this.channelDebug_.debug("TestConnection: Null responseText"),Hm(this.channel_,this);else if(1==this.state_)if(this.receivedIntermediateResult_)W(6);
else if("11111"==b){if(W(5),this.receivedIntermediateResult_=!0,!ak||10<=Number(mk))this.lastStatusCode_=200,this.request_.cancel(),this.channelDebug_.debug("Test connection succeeded; using streaming connection"),W(11),Em(this.channel_,this,!0)}else W(7),this.receivedIntermediateResult_=!1};
g.onRequestComplete=function(){this.lastStatusCode_=this.request_.lastStatusCode_;this.request_.successful_?0==this.state_?(this.state_=1,this.channelDebug_.debug("TestConnection: request complete for initial check"),Dm(this)):1==this.state_&&(this.channelDebug_.debug("TestConnection: request complete for stage 2"),this.receivedIntermediateResult_?(this.channelDebug_.debug("Test connection succeeded; using streaming connection"),W(11),Em(this.channel_,this,!0)):(this.channelDebug_.debug("Test connection failed; not using streaming"),
W(10),Em(this.channel_,this,!1))):(this.channelDebug_.debug("TestConnection: request failed, in state "+this.state_),0==this.state_?W(8):1==this.state_&&W(9),Hm(this.channel_,this))};
g.applyControlHeaders_=function(a){if(!this.channel_.backgroundChannelTest_&&(a=a.xmlHttp_)){var b=a.xhr_?a.xhr_.getResponseHeader("X-Client-Wire-Protocol"):null;this.clientProtocol_=b?b:null;this.channel_.httpSessionIdParam_&&((a=a.xhr_?a.xhr_.getResponseHeader("X-HTTP-Session-Id"):null)?this.channel_.httpSessionId_=a:this.channelDebug_.warning("Missing X_HTTP_SESSION_ID in the handshake response"))}};g.shouldUseSecondaryDomains=function(){return this.channel_.shouldUseSecondaryDomains()};
g.isActive=function(){return this.channel_.isActive()};var Im=function(){this.bufferingProxyResult=this.handshakeResult=null};var Jm=function(a,b){this.map_={};this.keys_=[];this.version_=this.count_=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)};g=Jm.prototype;g.getCount=function(){return this.count_};g.getValues=function(){Km(this);for(var a=[],b=0;b<this.keys_.length;b++)a.push(this.map_[this.keys_[b]]);return a};g.getKeys=function(){Km(this);return this.keys_.concat()};
g.containsKey=function(a){return Lm(this.map_,a)};g.containsValue=function(a){for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b];if(Lm(this.map_,c)&&this.map_[c]==a)return!0}return!1};g.equals=function(a,b){if(this===a)return!0;if(this.count_!=a.getCount())return!1;b=b||Mm;Km(this);for(var c,d=0;c=this.keys_[d];d++)if(!b(this.get(c),a.get(c)))return!1;return!0};var Mm=function(a,b){return a===b};Jm.prototype.isEmpty=function(){return 0==this.count_};
Jm.prototype.clear=function(){this.map_={};this.version_=this.count_=this.keys_.length=0};Jm.prototype.remove=function(a){return Lm(this.map_,a)?(delete this.map_[a],this.count_--,this.version_++,this.keys_.length>2*this.count_&&Km(this),!0):!1};
var Km=function(a){var b,c;if(a.count_!=a.keys_.length){for(b=c=0;c<a.keys_.length;){var d=a.keys_[c];Lm(a.map_,d)&&(a.keys_[b++]=d);c++}a.keys_.length=b}if(a.count_!=a.keys_.length){var e={};for(b=c=0;c<a.keys_.length;)d=a.keys_[c],Lm(e,d)||(a.keys_[b++]=d,e[d]=1),c++;a.keys_.length=b}};g=Jm.prototype;g.get=function(a,b){return Lm(this.map_,a)?this.map_[a]:b};g.set=function(a,b){Lm(this.map_,a)||(this.count_++,this.keys_.push(a),this.version_++);this.map_[a]=b};
g.addAll=function(a){if(a instanceof Jm){var b=a.getKeys();a=a.getValues()}else b=Rj(a),a=Qj(a);for(var c=0;c<b.length;c++)this.set(b[c],a[c])};g.forEach=function(a,b){for(var c=this.getKeys(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};g.clone=function(){return new Jm(this)};
g.__iterator__=function(a){Km(this);var b=0,c=this.version_,d=this,e=new Fl;e.next=function(){if(c!=d.version_)throw Error("The map has changed since the iterator was created");if(b>=d.keys_.length)throw El;var e=d.keys_[b++];return a?e:d.map_[e]};return e};var Lm=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};var Nm=function(a){if(a.getCount&&"function"==typeof a.getCount)a=a.getCount();else if(wa(a)||q(a))a=a.length;else{var b=0,c;for(c in a)b++;a=b}return a},Om=function(a){if(a.getValues&&"function"==typeof a.getValues)return a.getValues();if(q(a))return a.split("");if(wa(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Qj(a)},Pm=function(a){if(a.getKeys&&"function"==typeof a.getKeys)return a.getKeys();if(!a.getValues||"function"!=typeof a.getValues){if(wa(a)||q(a)){var b=[];a=a.length;
for(var c=0;c<a;c++)b.push(c);return b}return Rj(a)}},Qm=function(a,b,c){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,c);else if(wa(a)||q(a))Aj(a,b,c);else for(var d=Pm(a),e=Om(a),f=e.length,h=0;h<f;h++)b.call(c,e[h],d&&d[h],a)},Rm=function(a,b){if("function"==typeof a.every)return a.every(b,void 0);if(wa(a)||q(a))return Cj(a,b,void 0);for(var c=Pm(a),d=Om(a),e=d.length,f=0;f<e;f++)if(!b.call(void 0,d[f],c&&c[f],a))return!1;return!0};var Sm=function(a){this.map_=new Jm;a&&this.addAll(a)},Tm=function(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+(a[za]||(a[za]=++Aa)):b.substr(0,1)+a};g=Sm.prototype;g.getCount=function(){return this.map_.getCount()};g.add=function(a){this.map_.set(Tm(a),a)};g.addAll=function(a){a=Om(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};g.removeAll=function(a){a=Om(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};g.remove=function(a){return this.map_.remove(Tm(a))};g.clear=function(){this.map_.clear()};
g.isEmpty=function(){return this.map_.isEmpty()};g.contains=function(a){return this.map_.containsKey(Tm(a))};g.getValues=function(){return this.map_.getValues()};g.clone=function(){return new Sm(this)};g.equals=function(a){return this.getCount()==Nm(a)&&Um(this,a)};
var Um=function(a,b){var c=Nm(b);if(a.getCount()>c)return!1;!(b instanceof Sm)&&5<c&&(b=new Sm(b));return Rm(a,function(a){var c=b;if(c.contains&&"function"==typeof c.contains)a=c.contains(a);else if(c.containsValue&&"function"==typeof c.containsValue)a=c.containsValue(a);else if(wa(c)||q(c))a=0<=yj(c,a);else a:{for(var d in c)if(c[d]==a){a=!0;break a}a=!1}return a})};Sm.prototype.__iterator__=function(){return this.map_.__iterator__(!1)};var Vm=function(a){this.maxPoolSizeConfigured_=a||10;this.maxSize_=p.chrome&&p.chrome.loadTimes&&p.chrome.loadTimes()&&p.chrome.loadTimes().wasFetchedViaSpdy?this.maxPoolSizeConfigured_:1;this.requestPool_=null;1<this.maxSize_&&(this.requestPool_=new Sm);this.request_=null},Xm=function(a,b){a.requestPool_||-1==b.indexOf("spdy")&&-1==b.indexOf("quic")&&-1==b.indexOf("h2")||(a.maxSize_=a.maxPoolSizeConfigured_,a.requestPool_=new Sm,a.request_&&(Wm(a,a.request_),a.request_=null))},Ym=function(a){return a.request_?
!0:a.requestPool_?a.requestPool_.getCount()>=a.maxSize_:!1},Zm=function(a,b){return a.request_?a.request_==b:a.requestPool_?a.requestPool_.contains(b):!1},Wm=function(a,b){a.requestPool_?a.requestPool_.add(b):a.request_=b};Vm.prototype.cancel=function(){this.request_?(this.request_.cancel(),this.request_=null):this.requestPool_&&!this.requestPool_.isEmpty()&&(Aj(this.requestPool_.getValues(),function(a){a.cancel()}),this.requestPool_.clear())};var $m=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/,an=function(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}};var bn=function(a,b){this.domain_=this.userInfo_=this.scheme_="";this.port_=null;this.fragment_=this.path_="";this.ignoreCase_=this.isReadOnly_=!1;if(a instanceof bn){this.ignoreCase_=ra(b)?b:a.ignoreCase_;cn(this,a.scheme_);var c=a.userInfo_;dn(this);this.userInfo_=c;en(this,a.domain_);fn(this,a.port_);gn(this,a.path_);hn(this,a.getQueryData().clone());a=a.fragment_;dn(this);this.fragment_=a}else a&&(c=String(a).match($m))?(this.ignoreCase_=!!b,cn(this,c[1]||"",!0),a=c[2]||"",dn(this),this.userInfo_=
jn(a),en(this,c[3]||"",!0),fn(this,c[4]),gn(this,c[5]||"",!0),hn(this,c[6]||"",!0),a=c[7]||"",dn(this),this.fragment_=jn(a)):(this.ignoreCase_=!!b,this.queryData_=new kn(null,0,this.ignoreCase_))};
bn.prototype.toString=function(){var a=[],b=this.scheme_;b&&a.push(ln(b,mn,!0),":");var c=this.domain_;if(c||"file"==b)a.push("//"),(b=this.userInfo_)&&a.push(ln(b,mn,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.port_,null!=c&&a.push(":",String(c));if(c=this.path_)this.domain_&&"/"!=c.charAt(0)&&a.push("/"),a.push(ln(c,"/"==c.charAt(0)?nn:on,!0));(c=this.queryData_.toString())&&a.push("?",c);(c=this.fragment_)&&a.push("#",ln(c,pn));return a.join("")};
bn.prototype.resolve=function(a){var b=this.clone(),c=!!a.scheme_;c?cn(b,a.scheme_):c=!!a.userInfo_;if(c){var d=a.userInfo_;dn(b);b.userInfo_=d}else c=!!a.domain_;c?en(b,a.domain_):c=null!=a.port_;d=a.path_;if(c)fn(b,a.port_);else if(c=!!a.path_){if("/"!=d.charAt(0))if(this.domain_&&!this.path_)d="/"+d;else{var e=b.path_.lastIndexOf("/");-1!=e&&(d=b.path_.substr(0,e+1)+d)}e=d;if(".."==e||"."==e)d="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){d=0==e.lastIndexOf("/",0);e=e.split("/");for(var f=
[],h=0;h<e.length;){var l=e[h++];"."==l?d&&h==e.length&&f.push(""):".."==l?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),d&&h==e.length&&f.push("")):(f.push(l),d=!0)}d=f.join("/")}else d=e}c?gn(b,d):c=""!==a.queryData_.toString();c?hn(b,a.getQueryData().clone()):c=!!a.fragment_;c&&(a=a.fragment_,dn(b),b.fragment_=a);return b};bn.prototype.clone=function(){return new bn(this)};
var cn=function(a,b,c){dn(a);a.scheme_=c?jn(b,!0):b;a.scheme_&&(a.scheme_=a.scheme_.replace(/:$/,""))},en=function(a,b,c){dn(a);a.domain_=c?jn(b,!0):b},fn=function(a,b){dn(a);if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.port_=b}else a.port_=null},gn=function(a,b,c){dn(a);a.path_=c?jn(b,!0):b},hn=function(a,b,c){dn(a);b instanceof kn?(a.queryData_=b,a.queryData_.setIgnoreCase(a.ignoreCase_)):(c||(b=ln(b,qn)),a.queryData_=new kn(b,0,a.ignoreCase_))};
bn.prototype.getQueryData=function(){return this.queryData_};var X=function(a,b,c){dn(a);a.queryData_.set(b,c)},pm=function(a,b,c){dn(a);va(c)||(c=[String(c)]);rn(a.queryData_,b,c)},km=function(a){dn(a);X(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Ea()).toString(36));return a};bn.prototype.removeParameter=function(a){dn(this);this.queryData_.remove(a);return this};
var dn=function(a){if(a.isReadOnly_)throw Error("Tried to modify a read-only Uri");};bn.prototype.setIgnoreCase=function(a){this.ignoreCase_=a;this.queryData_&&this.queryData_.setIgnoreCase(a);return this};
var sn=function(a){return a instanceof bn?a.clone():new bn(a,void 0)},tn=function(a,b,c,d){var e=new bn(null,void 0);a&&cn(e,a);b&&en(e,b);c&&fn(e,c);d&&gn(e,d);return e},jn=function(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""},ln=function(a,b,c){return q(a)?(a=encodeURI(a).replace(b,un),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null},un=function(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)},mn=/[#\/\?@]/g,on=/[\#\?:]/g,nn=/[\#\?]/g,
qn=/[\#\?@]/g,pn=/#/g,kn=function(a,b,c){this.count_=this.keyMap_=null;this.encodedQuery_=a||null;this.ignoreCase_=!!c},vn=function(a){a.keyMap_||(a.keyMap_=new Jm,a.count_=0,a.encodedQuery_&&an(a.encodedQuery_,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))};g=kn.prototype;g.getCount=function(){vn(this);return this.count_};
g.add=function(a,b){vn(this);this.encodedQuery_=null;a=wn(this,a);var c=this.keyMap_.get(a);c||this.keyMap_.set(a,c=[]);c.push(b);this.count_=wj(this.count_)+1;return this};g.remove=function(a){vn(this);a=wn(this,a);return this.keyMap_.containsKey(a)?(this.encodedQuery_=null,this.count_=wj(this.count_)-this.keyMap_.get(a).length,this.keyMap_.remove(a)):!1};g.clear=function(){this.keyMap_=this.encodedQuery_=null;this.count_=0};g.isEmpty=function(){vn(this);return 0==this.count_};
g.containsKey=function(a){vn(this);a=wn(this,a);return this.keyMap_.containsKey(a)};g.containsValue=function(a){var b=this.getValues();return 0<=yj(b,a)};g.forEach=function(a,b){vn(this);this.keyMap_.forEach(function(c,d){Aj(c,function(c){a.call(b,c,d,this)},this)},this)};g.getKeys=function(){vn(this);for(var a=this.keyMap_.getValues(),b=this.keyMap_.getKeys(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};
g.getValues=function(a){vn(this);var b=[];if(q(a))this.containsKey(a)&&(b=Ij(b,this.keyMap_.get(wn(this,a))));else{a=this.keyMap_.getValues();for(var c=0;c<a.length;c++)b=Ij(b,a[c])}return b};g.set=function(a,b){vn(this);this.encodedQuery_=null;a=wn(this,a);this.containsKey(a)&&(this.count_=wj(this.count_)-this.keyMap_.get(a).length);this.keyMap_.set(a,[b]);this.count_=wj(this.count_)+1;return this};g.get=function(a,b){a=a?this.getValues(a):[];return 0<a.length?String(a[0]):b};
var rn=function(a,b,c){a.remove(b);0<c.length&&(a.encodedQuery_=null,a.keyMap_.set(wn(a,b),Jj(c)),a.count_=wj(a.count_)+c.length)};kn.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var a=[],b=this.keyMap_.getKeys(),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.getValues(d);for(var f=0;f<d.length;f++){var h=e;""!==d[f]&&(h+="="+encodeURIComponent(String(d[f])));a.push(h)}}return this.encodedQuery_=a.join("&")};
kn.prototype.clone=function(){var a=new kn;a.encodedQuery_=this.encodedQuery_;this.keyMap_&&(a.keyMap_=this.keyMap_.clone(),a.count_=this.count_);return a};var wn=function(a,b){b=String(b);a.ignoreCase_&&(b=b.toLowerCase());return b};kn.prototype.setIgnoreCase=function(a){a&&!this.ignoreCase_&&(vn(this),this.encodedQuery_=null,this.keyMap_.forEach(function(a,c){var b=c.toLowerCase();c!=b&&(this.remove(c),rn(this,b,a))},this));this.ignoreCase_=a};
kn.prototype.extend=function(a){for(var b=0;b<arguments.length;b++)Qm(arguments[b],function(a,b){this.add(b,a)},this)};var yn=function(a,b){var c=new Xl;c.debug("TestLoadImage: loading "+a);var d=new Image;d.onload=Da(xn,c,d,"TestLoadImage: loaded",!0,b);d.onerror=Da(xn,c,d,"TestLoadImage: error",!1,b);d.onabort=Da(xn,c,d,"TestLoadImage: abort",!1,b);d.ontimeout=Da(xn,c,d,"TestLoadImage: timeout",!1,b);p.setTimeout(function(){if(d.ontimeout)d.ontimeout()},1E4);d.src=a},xn=function(a,b,c,d,e){try{a.debug(c),b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,e(d)}catch(f){$l(a,f)}};var zn=function(a,b){this.mapId=a;this.map=b;this.context=null};var An=function(){this.parser_=new Ol},Bn=function(a,b,c){var d=c||"";try{Qm(a,function(a,c){var e=a;ya(a)&&(e=Kl(a));b.push(d+c+"="+encodeURIComponent(e))})}catch(e){throw b.push(d+"type="+encodeURIComponent("_badmap")),e;}},Gm=function(a,b){a=a.parser_.parse(b);T(va(a));return a};var Cn=function(a){var b="";Oj(a,function(a,d){b+=d;b+=":";b+=a;b+="\r\n"});return b},Dn=function(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}if(d)return a;c=Cn(c);if(q(a)){b=encodeURIComponent(String(b));c=null!=c?"="+encodeURIComponent(String(c)):"";if(b+=c){c=a.indexOf("#");0>c&&(c=a.length);d=a.indexOf("?");if(0>d||d>c){d=c;var e=""}else e=a.substring(d+1,c);a=[a.substr(0,d),e,a.substr(c)];c=a[1];a[1]=b?c?c+"&"+b:b:c;a=a[0]+(a[1]?"?"+a[1]:"")+a[2]}return a}X(a,b,c);return a};var Y=function(a){dl.call(this);this.headers=new Jm;this.xmlHttpFactory_=a||null;this.active_=!1;this.xhrOptions_=this.xhr_=null;this.lastMethod_=this.lastUri_="";this.lastErrorCode_=0;this.lastError_="";this.inAbort_=this.inOpen_=this.inSend_=this.errorDispatched_=!1;this.timeoutInterval_=0;this.timeoutId_=null;this.responseType_="";this.useXhr2Timeout_=this.progressEventsEnabled_=this.withCredentials_=!1};u(Y,dl);Y.prototype.logger_=wl("goog.net.XhrIo");var En=/^https?$/i,Fn=["POST","PUT"];
Y.prototype.send=function(a,b,c,d){if(this.xhr_)throw Error("[goog.net.XhrIo] Object is active with another request="+this.lastUri_+"; newUri="+a);b=b?b.toUpperCase():"GET";this.lastUri_=a;this.lastError_="";this.lastErrorCode_=0;this.lastMethod_=b;this.errorDispatched_=!1;this.active_=!0;this.xhr_=this.xmlHttpFactory_?fm(this.xmlHttpFactory_):fm(dm);this.xhrOptions_=this.xmlHttpFactory_?cm(this.xmlHttpFactory_):cm(dm);this.xhr_.onreadystatechange=r(this.onReadyStateChange_,this);this.progressEventsEnabled_&&
"onprogress"in this.xhr_&&(this.xhr_.onprogress=r(function(a){this.onProgressHandler_(a,!0)},this),this.xhr_.upload&&(this.xhr_.upload.onprogress=r(this.onProgressHandler_,this)));try{Wl(this.logger_,Gn(this,"Opening Xhr")),this.inOpen_=!0,this.xhr_.open(b,String(a),!0),this.inOpen_=!1}catch(f){Wl(this.logger_,Gn(this,"Error opening Xhr: "+f.message));Hn(this,f);return}a=c||"";var e=this.headers.clone();d&&Qm(d,function(a,b){e.set(b,a)});d=Ej(e.getKeys());c=p.FormData&&a instanceof p.FormData;!(0<=
yj(Fn,b))||d||c||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");e.forEach(function(a,b){this.xhr_.setRequestHeader(b,a)},this);this.responseType_&&(this.xhr_.responseType=this.responseType_);"withCredentials"in this.xhr_&&this.xhr_.withCredentials!==this.withCredentials_&&(this.xhr_.withCredentials=this.withCredentials_);try{In(this),0<this.timeoutInterval_&&(this.useXhr2Timeout_=Jn(this.xhr_),Wl(this.logger_,Gn(this,"Will abort after "+this.timeoutInterval_+"ms if incomplete, xhr2 "+
this.useXhr2Timeout_)),this.useXhr2Timeout_?(this.xhr_.timeout=this.timeoutInterval_,this.xhr_.ontimeout=r(this.timeout_,this)):this.timeoutId_=hl(this.timeout_,this.timeoutInterval_,this)),Wl(this.logger_,Gn(this,"Sending request")),this.inSend_=!0,this.xhr_.send(a),this.inSend_=!1}catch(f){Wl(this.logger_,Gn(this,"Send error: "+f.message)),Hn(this,f)}};var Jn=function(a){return ak&&lk(9)&&sa(a.timeout)&&ra(a.ontimeout)},Dj=function(a){return"content-type"==a.toLowerCase()};
Y.prototype.timeout_=function(){"undefined"!=typeof qa&&this.xhr_&&(this.lastError_="Timed out after "+this.timeoutInterval_+"ms, aborting",this.lastErrorCode_=8,Wl(this.logger_,Gn(this,this.lastError_)),this.dispatchEvent("timeout"),this.abort(8))};var Hn=function(a,b){a.active_=!1;a.xhr_&&(a.inAbort_=!0,a.xhr_.abort(),a.inAbort_=!1);a.lastError_=b;a.lastErrorCode_=5;Kn(a);Ln(a)},Kn=function(a){a.errorDispatched_||(a.errorDispatched_=!0,a.dispatchEvent("complete"),a.dispatchEvent("error"))};
Y.prototype.abort=function(a){this.xhr_&&this.active_&&(Wl(this.logger_,Gn(this,"Aborting")),this.active_=!1,this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1,this.lastErrorCode_=a||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Ln(this))};Y.prototype.disposeInternal=function(){this.xhr_&&(this.active_&&(this.active_=!1,this.inAbort_=!0,this.xhr_.abort(),this.inAbort_=!1),Ln(this,!0));Y.superClass_.disposeInternal.call(this)};
Y.prototype.onReadyStateChange_=function(){if(!this.disposed_)if(this.inOpen_||this.inSend_||this.inAbort_)Mn(this);else this.onReadyStateChangeEntryPoint_()};Y.prototype.onReadyStateChangeEntryPoint_=function(){Mn(this)};
var Mn=function(a){if(a.active_&&"undefined"!=typeof qa)if(a.xhrOptions_[1]&&4==qm(a)&&2==tm(a))Wl(a.logger_,Gn(a,"Local request error detected and ignored"));else if(a.inSend_&&4==qm(a))hl(a.onReadyStateChange_,0,a);else if(a.dispatchEvent("readystatechange"),4==qm(a)){Wl(a.logger_,Gn(a,"Request complete"));a.active_=!1;try{var b=tm(a);a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break a;default:c=!1}var d;if(!(d=c)){var e;if(e=0===b){var f=String(a.lastUri_).match($m)[1]||
null;if(!f&&p.self&&p.self.location){var h=p.self.location.protocol;f=h.substr(0,h.length-1)}e=!En.test(f?f.toLowerCase():"")}d=e}d?(a.dispatchEvent("complete"),a.dispatchEvent("success")):(a.lastErrorCode_=6,a.lastError_=Nn(a)+" ["+tm(a)+"]",Kn(a))}finally{Ln(a)}}};Y.prototype.onProgressHandler_=function(a,b){T("progress"===a.type,"goog.net.EventType.PROGRESS is of the same type as raw XHR progress.");this.dispatchEvent(On(a,"progress"));this.dispatchEvent(On(a,b?"downloadprogress":"uploadprogress"))};
var On=function(a,b){return{type:b,lengthComputable:a.lengthComputable,loaded:a.loaded,total:a.total}},Ln=function(a,b){if(a.xhr_){In(a);var c=a.xhr_,d=a.xhrOptions_[0]?ta:null;a.xhr_=null;a.xhrOptions_=null;b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){(a=a.logger_)&&a.severe("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}},In=function(a){a.xhr_&&a.useXhr2Timeout_&&(a.xhr_.ontimeout=null);sa(a.timeoutId_)&&(p.clearTimeout(a.timeoutId_),a.timeoutId_=null)};
Y.prototype.isActive=function(){return!!this.xhr_};var qm=function(a){return a.xhr_?a.xhr_.readyState:0},tm=function(a){try{return 2<qm(a)?a.xhr_.status:-1}catch(b){return-1}},Nn=function(a){try{return 2<qm(a)?a.xhr_.statusText:""}catch(b){return Wl(a.logger_,"Can not get status: "+b.message),""}},rm=function(a){try{return a.xhr_?a.xhr_.responseText:""}catch(b){return Wl(a.logger_,"Can not get responseText: "+b.message),""}};
Y.prototype.getResponseHeader=function(a){if(this.xhr_&&4==qm(this))return a=this.xhr_.getResponseHeader(a),null===a?void 0:a};Y.prototype.getAllResponseHeaders=function(){return this.xhr_&&4==qm(this)?this.xhr_.getAllResponseHeaders():""};Y.prototype.getLastError=function(){return q(this.lastError_)?this.lastError_:String(this.lastError_)};var Gn=function(a,b){return b+" ["+a.lastMethod_+" "+a.lastUri_+" "+tm(a)+"]"};var Z=function(a,b,c){this.clientVersion_=b||0;this.serverVersion_=0;this.outgoingMaps_=[];this.pendingMaps_=[];this.channelDebug_=new Xl;this.connState_=c||new Im;this.hostPrefix_=this.backChannelUri_=this.forwardChannelUri_=this.path_=this.backChannelRequest_=this.httpSessionId_=this.httpSessionIdParam_=this.extraParams_=this.httpHeadersOverwriteParam_=this.initHeaders_=this.extraHeaders_=null;this.allowHostPrefix_=!0;this.nextMapId_=this.nextRid_=0;this.failFast_=!1;this.useChunked_=this.connectionTest_=
this.deadBackChannelTimerId_=this.backChannelTimerId_=this.forwardChannelTimerId_=this.handler_=null;this.allowChunkedMode_=!0;this.lastStatusCode_=this.lastPostResponseArrayId_=this.lastArrayId_=-1;this.backChannelAttemptId_=this.backChannelRetryCount_=this.forwardChannelRetryCount_=0;this.baseRetryDelayMs_=5E3;this.retryDelaySeedMs_=1E4;this.forwardChannelMaxRetries_=2;this.forwardChannelRequestTimeoutMs_=2E4;this.readyStateChangeThrottleMs_=0;this.supportsCrossDomainXhrs_=a&&a.supportsCrossDomainXhr||
!1;this.sid_="";this.forwardChannelRequestPool_=new Vm(a&&a.concurrentRequestLimit);this.wireCodec_=new An;this.backgroundChannelTest_=a&&ra(a.backgroundChannelTest)?a.backgroundChannelTest:!0;this.fastHandshake_=a&&a.fastHandshake||!1};Z.prototype.channelVersion_=8;Z.prototype.state_=1;
Z.prototype.connect=function(a,b,c,d,e){this.channelDebug_.debug("connect()");W(0);this.path_=b;this.extraParams_=c||{};d&&ra(e)&&(this.extraParams_.OSID=d,this.extraParams_.OAID=e);this.backgroundChannelTest_&&(this.channelDebug_.debug("connect() bypassed channel-test."),this.connState_.handshakeResult=[],this.connState_.bufferingProxyResult=!1);this.channelDebug_.debug("connectTest_()");this.connectionTest_=new Bm(this,this.channelDebug_);null===this.httpHeadersOverwriteParam_&&this.connectionTest_.setExtraHeaders(this.extraHeaders_);
b=a;this.httpHeadersOverwriteParam_&&this.extraHeaders_&&(b=Dn(a,this.httpHeadersOverwriteParam_,this.extraHeaders_));this.connectionTest_.connect(b)};
Z.prototype.disconnect=function(){this.channelDebug_.debug("disconnect()");Pn(this);if(3==this.state_){var a=this.nextRid_++,b=this.forwardChannelUri_.clone();X(b,"SID",this.sid_);X(b,"RID",a);X(b,"TYPE","terminate");Qn(this,b);a=new gm(this,this.channelDebug_,this.sid_,a,void 0);a.type_=2;a.baseUri_=km(b.clone());b=!1;p.navigator&&p.navigator.sendBeacon&&(b=p.navigator.sendBeacon(a.baseUri_.toString(),""));b||((new Image).src=a.baseUri_);a.requestStartTime_=Ea();om(a)}Rn(this)};
var Pn=function(a){a.connectionTest_&&(a.connectionTest_.abort(),a.connectionTest_=null);a.backChannelRequest_&&(a.backChannelRequest_.cancel(),a.backChannelRequest_=null);a.backChannelTimerId_&&(p.clearTimeout(a.backChannelTimerId_),a.backChannelTimerId_=null);Sn(a);a.forwardChannelRequestPool_.cancel();a.forwardChannelTimerId_&&(p.clearTimeout(a.forwardChannelTimerId_),a.forwardChannelTimerId_=null)};Z.prototype.setExtraHeaders=function(a){this.extraHeaders_=a};
Z.prototype.setReadyStateChangeThrottle=function(a){this.readyStateChangeThrottleMs_=a};var Un=function(a,b){T(0!=a.state_,"Invalid operation: sending map when state is closed");1E3==a.outgoingMaps_.length&&a.channelDebug_.severe("Already have 1000 queued maps upon queueing "+Kl(b));a.outgoingMaps_.push(new zn(a.nextMapId_++,b));2!=a.state_&&3!=a.state_||Tn(a)};Z.prototype.isClosed=function(){return 0==this.state_};Z.prototype.getState=function(){return this.state_};
var Tn=function(a){Ym(a.forwardChannelRequestPool_)||a.forwardChannelTimerId_||(a.forwardChannelTimerId_=Ul(r(a.onStartForwardChannelTimer_,a),0),a.forwardChannelRetryCount_=0)};
Z.prototype.onStartForwardChannelTimer_=function(a){this.forwardChannelTimerId_=null;this.channelDebug_.debug("startForwardChannel_");if(1==this.state_)if(a)this.channelDebug_.severe("Not supposed to retry the open");else{this.channelDebug_.debug("open_()");this.nextRid_=Math.floor(1E5*Math.random());a=this.nextRid_++;var b=new gm(this,this.channelDebug_,"",a,void 0),c=this.extraHeaders_;this.initHeaders_&&(c?(c=Sj(c),Uj(c,this.initHeaders_)):c=this.initHeaders_);null===this.httpHeadersOverwriteParam_&&
b.setExtraHeaders(c);var d=Vn(this),e=this.forwardChannelUri_.clone();X(e,"RID",a);0<this.clientVersion_&&X(e,"CVER",this.clientVersion_);this.backgroundChannelTest_&&this.httpSessionIdParam_&&X(e,"X-HTTP-Session-Id",this.httpSessionIdParam_);Qn(this,e);this.httpHeadersOverwriteParam_&&c&&Dn(e,this.httpHeadersOverwriteParam_,c);Wm(this.forwardChannelRequestPool_,b);this.fastHandshake_?(X(e,"$req",d),mm(b,e,null)):mm(b,e,d);this.state_=2}else 3==this.state_&&(a?Wn(this,a):0==this.outgoingMaps_.length?
this.channelDebug_.debug("startForwardChannel_ returned: nothing to send"):Ym(this.forwardChannelRequestPool_)?this.channelDebug_.severe("startForwardChannel_ returned: connection already in progress"):(Wn(this),this.channelDebug_.debug("startForwardChannel_ finished, sent request")))};
var Wn=function(a,b){if(b){a.outgoingMaps_=a.pendingMaps_.concat(a.outgoingMaps_);a.pendingMaps_.length=0;var c=a.nextRid_-1}else c=a.nextRid_++;b=Vn(a);var d=a.forwardChannelUri_.clone();X(d,"SID",a.sid_);X(d,"RID",c);X(d,"AID",a.lastArrayId_);Qn(a,d);a.httpHeadersOverwriteParam_&&a.extraHeaders_&&Dn(d,a.httpHeadersOverwriteParam_,a.extraHeaders_);c=new gm(a,a.channelDebug_,a.sid_,c,a.forwardChannelRetryCount_+1);null===a.httpHeadersOverwriteParam_&&c.setExtraHeaders(a.extraHeaders_);c.setTimeout(Math.round(.5*
a.forwardChannelRequestTimeoutMs_)+Math.round(.5*a.forwardChannelRequestTimeoutMs_*Math.random()));Wm(a.forwardChannelRequestPool_,c);mm(c,d,b)},Qn=function(a,b){a.handler_&&Qm({},function(a,d){X(b,d,a)})},Vn=function(a){var b=Math.min(a.outgoingMaps_.length,1E3),c=a.handler_?r(a.handler_.badMapError,a.handler_,a):null,d=a.outgoingMaps_,e=["count="+b];if(0<b){var f=d[0].mapId;e.push("ofs="+f)}else f=0;for(var h=0;h<b;h++){var l=d[h].mapId,t=d[h].map;l-=f;try{Bn(t,e,"req"+l+"_")}catch(y){c&&c(t)}}c=
e.join("&");a.pendingMaps_=a.pendingMaps_.concat(a.outgoingMaps_.splice(0,b));return c},Xn=function(a){if(!a.backChannelRequest_&&!a.backChannelTimerId_){a.backChannelAttemptId_=1;var b=a.onStartBackChannelTimer_;Zk||al();bl||(Zk(),bl=!0);cl.add(b,a);a.backChannelRetryCount_=0}},Zn=function(a){if(a.backChannelRequest_||a.backChannelTimerId_)return a.channelDebug_.severe("Request already in progress"),!1;if(3<=a.backChannelRetryCount_)return!1;a.channelDebug_.debug("Going to retry GET");a.backChannelAttemptId_++;
a.backChannelTimerId_=Ul(r(a.onStartBackChannelTimer_,a),Yn(a,a.backChannelRetryCount_));a.backChannelRetryCount_++;return!0};
Z.prototype.onStartBackChannelTimer_=function(){this.backChannelTimerId_=null;this.channelDebug_.debug("Creating new HttpRequest");this.backChannelRequest_=new gm(this,this.channelDebug_,this.sid_,"rpc",this.backChannelAttemptId_);null===this.httpHeadersOverwriteParam_&&this.backChannelRequest_.setExtraHeaders(this.extraHeaders_);this.backChannelRequest_.setReadyStateChangeThrottle(this.readyStateChangeThrottleMs_);var a=this.backChannelUri_.clone();X(a,"RID","rpc");X(a,"SID",this.sid_);X(a,"CI",
this.useChunked_?"0":"1");X(a,"AID",this.lastArrayId_);Qn(this,a);X(a,"TYPE","xmlhttp");this.httpHeadersOverwriteParam_&&this.extraHeaders_&&Dn(a,this.httpHeadersOverwriteParam_,this.extraHeaders_);nm(this.backChannelRequest_,a,!0,this.hostPrefix_);this.channelDebug_.debug("New Request created")};
var Em=function(a,b,c){a.channelDebug_.debug("Test Connection Finished");var d=b.clientProtocol_;d&&Xm(a.forwardChannelRequestPool_,d);a.useChunked_=a.allowChunkedMode_&&c;a.lastStatusCode_=b.lastStatusCode_;a.channelDebug_.debug("connectChannel_()");a.ensureInState_(1,0);a.forwardChannelUri_=Cm(a,a.path_);Tn(a)},Hm=function(a,b){a.channelDebug_.debug("Test Connection Failed");a.lastStatusCode_=b.lastStatusCode_;$n(a,2)};
Z.prototype.onRequestData=function(a,b){if(0!=this.state_&&(this.backChannelRequest_==a||Zm(this.forwardChannelRequestPool_,a)))if(this.lastStatusCode_=a.lastStatusCode_,Zm(this.forwardChannelRequestPool_,a)&&3==this.state_){try{var c=Gm(this.wireCodec_,b)}catch(h){c=null}if(va(c)&&3==c.length)if(b=c,0==b[0])a:if(this.channelDebug_.debug("Server claims our backchannel is missing."),this.backChannelTimerId_)this.channelDebug_.debug("But we are currently starting the request.");else{if(this.backChannelRequest_)if(this.backChannelRequest_.requestStartTime_+
3E3<a.requestStartTime_)Sn(this),this.backChannelRequest_.cancel(),this.backChannelRequest_=null;else break a;else this.channelDebug_.warning("We do not have a BackChannel established");Zn(this);W(18)}else this.lastPostResponseArrayId_=b[1],a=this.lastPostResponseArrayId_-this.lastArrayId_,0<a&&(b=b[2],this.channelDebug_.debug(b+" bytes (in "+a+" arrays) are outstanding on the BackChannel"),37500>b&&this.useChunked_&&0==this.backChannelRetryCount_&&!this.deadBackChannelTimerId_&&(this.deadBackChannelTimerId_=
Ul(r(this.onBackChannelDead_,this),6E3)));else this.channelDebug_.debug("Bad POST response data returned"),$n(this,11)}else if(this.backChannelRequest_==a&&Sn(this),!/^[\s\xa0]*$/.test(b)){b=c=Gm(this.wireCodec_,b);c=this.handler_&&this.handler_.channelHandleMultipleArrays?[]:null;for(var d=0;d<b.length;d++){var e=b[d];this.lastArrayId_=e[0];e=e[1];if(2==this.state_)if("c"==e[0]){this.sid_=e[1];this.hostPrefix_=this.correctHostPrefix(e[2]);var f=e[3];null!=f&&(this.channelVersion_=f,this.channelDebug_.info("VER="+
this.channelVersion_));e=e[4];null!=e&&(this.serverVersion_=e,this.channelDebug_.info("SVER="+this.serverVersion_));this.applyControlHeaders_(a);this.state_=3;this.handler_&&this.handler_.channelOpened(this);this.backChannelUri_=Fm(this,this.hostPrefix_,this.path_);Xn(this)}else"stop"!=e[0]&&"close"!=e[0]||$n(this,7);else 3==this.state_&&("stop"==e[0]||"close"==e[0]?(c&&0!=c.length&&(this.handler_.channelHandleMultipleArrays(this,c),c.length=0),"stop"==e[0]?$n(this,7):this.disconnect()):"noop"!=e[0]&&
(c?c.push(e):this.handler_&&this.handler_.channelHandleArray(this,e)),this.backChannelRetryCount_=0)}c&&0!=c.length&&this.handler_.channelHandleMultipleArrays(this,c)}};Z.prototype.correctHostPrefix=function(a){return this.allowHostPrefix_?this.handler_?this.handler_.correctHostPrefix(a):a:null};Z.prototype.onBackChannelDead_=function(){null!=this.deadBackChannelTimerId_&&(this.deadBackChannelTimerId_=null,this.backChannelRequest_.cancel(),this.backChannelRequest_=null,Zn(this),W(19))};
var Sn=function(a){null!=a.deadBackChannelTimerId_&&(p.clearTimeout(a.deadBackChannelTimerId_),a.deadBackChannelTimerId_=null)};
Z.prototype.onRequestComplete=function(a){this.channelDebug_.debug("Request complete");if(this.backChannelRequest_==a){Sn(this);this.backChannelRequest_=null;var b=2}else if(Zm(this.forwardChannelRequestPool_,a))b=this.forwardChannelRequestPool_,b.request_&&b.request_==a?b.request_=null:b.requestPool_&&b.requestPool_.contains(a)&&b.requestPool_.remove(a),b=1;else return;this.lastStatusCode_=a.lastStatusCode_;if(0!=this.state_)if(a.successful_)1==b?(b=Ea()-a.requestStartTime_,Pl.dispatchEvent(new Tl(Pl,
a.postData_?a.postData_.length:0,b)),Tn(this),this.pendingMaps_.length=0):Xn(this);else{var c=a.getLastError();if(3==c||0==c&&0<this.lastStatusCode_)this.channelDebug_.debug("Not retrying due to error type");else{this.channelDebug_.debug("Maybe retrying, last error: "+hm(c,this.lastStatusCode_));var d;if(d=1==b)Ym(this.forwardChannelRequestPool_)||this.forwardChannelTimerId_?(this.channelDebug_.severe("Request already in progress"),d=!1):1==this.state_||2==this.state_||this.forwardChannelRetryCount_>=
(this.failFast_?0:this.forwardChannelMaxRetries_)?d=!1:(this.channelDebug_.debug("Going to retry POST"),this.forwardChannelTimerId_=Ul(r(this.onStartForwardChannelTimer_,this,a),Yn(this,this.forwardChannelRetryCount_)),this.forwardChannelRetryCount_++,d=!0);if(d||2==b&&Zn(this))return;this.channelDebug_.debug("Exceeded max number of retries")}this.channelDebug_.debug("Error: HTTP request failed");switch(c){case 1:$n(this,5);break;case 4:$n(this,10);break;case 3:$n(this,6);break;default:$n(this,2)}}};
var Yn=function(a,b){var c=a.baseRetryDelayMs_+Math.floor(Math.random()*a.retryDelaySeedMs_);a.isActive()||(a.channelDebug_.debug("Inactive channel"),c*=2);return c*b};
Z.prototype.applyControlHeaders_=function(a){if(this.backgroundChannelTest_&&(a=a.xmlHttp_)){var b=a.xhr_?a.xhr_.getResponseHeader("X-Client-Wire-Protocol"):null;b&&Xm(this.forwardChannelRequestPool_,b);this.httpSessionIdParam_&&((a=a.xhr_?a.xhr_.getResponseHeader("X-HTTP-Session-Id"):null)?(this.httpSessionId_=a,X(this.forwardChannelUri_,this.httpSessionIdParam_,a)):this.channelDebug_.warning("Missing X_HTTP_SESSION_ID in the handshake response"))}};
Z.prototype.ensureInState_=function(a){T(0<=yj(arguments,this.state_),"Unexpected channel state: %s",this.state_)};var $n=function(a,b){a.channelDebug_.info("Error code "+b);if(2==b){var c=null;a.handler_&&(c=null);var d=r(a.testNetworkCallback_,a);c||(c=new bn("//www.google.com/images/cleardot.gif"),p.location&&"http"==p.location.protocol||cn(c,"https"),km(c));yn(c.toString(),d)}else W(2);a.channelDebug_.debug("HttpChannel: error - "+b);a.state_=0;a.handler_&&a.handler_.channelError(a,b);Rn(a);Pn(a)};
Z.prototype.testNetworkCallback_=function(a){a?(this.channelDebug_.info("Successfully pinged google.com"),W(2)):(this.channelDebug_.info("Failed to ping google.com"),W(1))};
var Rn=function(a){a.state_=0;a.lastStatusCode_=-1;if(a.handler_)if(0==a.pendingMaps_.length&&0==a.outgoingMaps_.length)a.handler_.channelClosed(a);else{a.channelDebug_.debug("Number of undelivered maps, pending: "+a.pendingMaps_.length+", outgoing: "+a.outgoingMaps_.length);var b=Jj(a.pendingMaps_),c=Jj(a.outgoingMaps_);a.pendingMaps_.length=0;a.outgoingMaps_.length=0;a.handler_.channelClosed(a,b,c)}},Cm=function(a,b){b=ao(a,null,b);a.channelDebug_.debug("GetForwardChannelUri: "+b);return b},Fm=
function(a,b,c){b=ao(a,a.shouldUseSecondaryDomains()?b:null,c);a.channelDebug_.debug("GetBackChannelUri: "+b);return b},ao=function(a,b,c){var d=sn(c);if(""!=d.domain_)b&&en(d,b+"."+d.domain_),fn(d,d.port_);else{var e=p.location;d=tn(e.protocol,b?b+"."+e.hostname:e.hostname,e.port,c)}a.extraParams_&&Oj(a.extraParams_,function(a,b){X(d,b,a)});b=a.httpSessionIdParam_;c=a.httpSessionId_;b&&c&&X(d,b,c);X(d,"VER",a.channelVersion_);Qn(a,d);return d};
Z.prototype.createXhrIo=function(a){if(a&&!this.supportsCrossDomainXhrs_)throw Error("Can't create secondary domain capable XhrIo object.");a=new Y;a.withCredentials_=this.supportsCrossDomainXhrs_;return a};Z.prototype.isActive=function(){return!!this.handler_&&this.handler_.isActive(this)};Z.prototype.shouldUseSecondaryDomains=function(){return this.supportsCrossDomainXhrs_};new Al;var bo=function(){};g=bo.prototype;g.channelHandleMultipleArrays=null;g.channelOpened=function(){};
g.channelHandleArray=function(){};g.channelError=function(){};g.channelClosed=function(){};g.isActive=function(){return!0};g.badMapError=function(){};g.correctHostPrefix=function(a){return a};var co=function(a){for(var b=arguments[0],c=1;c<arguments.length;c++){var d=arguments[c];if(0==d.lastIndexOf("/",0))b=d;else{var e;(e=""==b)||(e=b.length-1,e=0<=e&&b.indexOf("/",e)==e);b=e?b+d:b+("/"+d)}}return b};var fo=function(a,b){dl.call(this);this.channel_=new Z(b,20);this.url_=a;this.testUrl_=b&&b.testUrl?b.testUrl:co(this.url_,"test");this.logger_=wl("goog.labs.net.webChannel.WebChannelBaseTransport");this.messageUrlParams_=b&&b.messageUrlParams||null;a=b&&b.messageHeaders||null;b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"});this.channel_.setExtraHeaders(a);this.channel_.initHeaders_=b&&b.initMessageHeaders||null;(a=b&&b.httpHeadersOverwriteParam)&&
!/^[\s\xa0]*$/.test(a)&&(this.channel_.httpHeadersOverwriteParam_=a);this.supportsCrossDomainXhr_=b&&b.supportsCrossDomainXhr||!1;this.sendRawJson_=b&&b.sendRawJson||!1;(b=b&&b.httpSessionIdParam)&&!/^[\s\xa0]*$/.test(b)&&(this.channel_.httpSessionIdParam_=b,a=this.messageUrlParams_,null!==a&&b in a&&(a=this.messageUrlParams_,b in a&&delete a[b],(a=this.logger_)&&a.warning("Ignore httpSessionIdParam also specified with messageUrlParams: "+b,void 0)));this.channelHandler_=new eo(this)};u(fo,dl);
fo.prototype.open=function(){this.channel_.handler_=this.channelHandler_;this.supportsCrossDomainXhr_&&(this.channel_.supportsCrossDomainXhrs_=!0);this.channel_.connect(this.testUrl_,this.url_,this.messageUrlParams_||void 0)};fo.prototype.close=function(){this.channel_.disconnect()};fo.prototype.send=function(a){T(ya(a),"only object type expected");if(this.sendRawJson_){var b={};b.__data__=Kl(a);Un(this.channel_,b)}else Un(this.channel_,a)};
fo.prototype.disposeInternal=function(){this.channel_.handler_=null;delete this.channelHandler_;this.channel_.disconnect();delete this.channel_;fo.superClass_.disposeInternal.call(this)};var go=function(a){Qk.call(this);this.data=a};u(go,Qk);var ho=function(a){Rk.call(this);this.status=1;this.errorCode=a};u(ho,Rk);var eo=function(a){this.channel_=a};u(eo,bo);eo.prototype.channelOpened=function(){Vl(this.channel_.logger_,"WebChannel opened on "+this.channel_.url_);this.channel_.dispatchEvent("a")};
eo.prototype.channelHandleArray=function(a,b){T(b,"array expected to be defined");this.channel_.dispatchEvent(new go(b))};eo.prototype.channelError=function(a,b){Vl(this.channel_.logger_,"WebChannel aborted on "+this.channel_.url_+" due to channel error: "+b);this.channel_.dispatchEvent(new ho(b))};eo.prototype.channelClosed=function(){Vl(this.channel_.logger_,"WebChannel closed on "+this.channel_.url_);this.channel_.dispatchEvent("b")};var io=Da(function(a,b){var c=function(){};c.prototype=a.prototype;c=new c;a.apply(c,Array.prototype.slice.call(arguments,1));return c},function(){if(ak&&!(10<=Number(mk)))throw Error("Environmental error: no available transport.");});var jo=function(){this.front_=[];this.back_=[]};g=jo.prototype;g.enqueue=function(a){this.back_.push(a)};g.dequeue=function(){0==this.front_.length&&(this.front_=this.back_,this.front_.reverse(),this.back_=[]);return this.front_.pop()};g.getCount=function(){return this.front_.length+this.back_.length};g.isEmpty=function(){return 0==this.front_.length&&0==this.back_.length};g.clear=function(){this.front_=[];this.back_=[]};g.contains=function(a){return 0<=yj(this.front_,a)||0<=yj(this.back_,a)};
g.remove=function(a){var b=this.front_;var c=zj(b,a);0<=c?(Gj(b,c),b=!0):b=!1;return b||Hj(this.back_,a)};g.getValues=function(){for(var a=[],b=this.front_.length-1;0<=b;--b)a.push(this.front_[b]);var c=this.back_.length;for(b=0;b<c;++b)a.push(this.back_[b]);return a};var ko=function(a,b){Kj.call(this);this.minCount_=a||0;this.maxCount_=b||10;if(this.minCount_>this.maxCount_)throw Error("[goog.structs.Pool] Min can not be greater than max");this.freeQueue_=new jo;this.inUseSet_=new Sm;this.delay=0;this.lastAccess=null;this.adjustForMinMax()};u(ko,Kj);
ko.prototype.getObject=function(){var a=Ea();if(!(null!=this.lastAccess&&a-this.lastAccess<this.delay)){for(var b;0<this.freeQueue_.getCount()&&(b=this.freeQueue_.dequeue(),!this.objectCanBeReused(b));)this.adjustForMinMax();!b&&this.getCount()<this.maxCount_&&(b=this.createObject());b&&(this.lastAccess=a,this.inUseSet_.add(b));return b}};ko.prototype.addFreeObject=function(a){this.inUseSet_.remove(a);this.objectCanBeReused(a)&&this.getCount()<this.maxCount_?this.freeQueue_.enqueue(a):lo(a)};
ko.prototype.adjustForMinMax=function(){for(var a=this.freeQueue_;this.getCount()<this.minCount_;)a.enqueue(this.createObject());for(;this.getCount()>this.maxCount_&&0<this.freeQueue_.getCount();)lo(a.dequeue())};ko.prototype.createObject=function(){return{}};var lo=function(a){if("function"==typeof a.dispose)a.dispose();else for(var b in a)a[b]=null};g=ko.prototype;g.objectCanBeReused=function(a){return"function"==typeof a.canBeReused?a.canBeReused():!0};
g.contains=function(a){return this.freeQueue_.contains(a)||this.inUseSet_.contains(a)};g.getCount=function(){return this.freeQueue_.getCount()+this.inUseSet_.getCount()};g.isEmpty=function(){return this.freeQueue_.isEmpty()&&this.inUseSet_.isEmpty()};g.disposeInternal=function(){ko.superClass_.disposeInternal.call(this);if(0<this.inUseSet_.getCount())throw Error("[goog.structs.Pool] Objects not released");delete this.inUseSet_;for(var a=this.freeQueue_;!a.isEmpty();)lo(a.dequeue());delete this.freeQueue_};var mo=function(a,b){this.key_=a;this.value_=b};mo.prototype.getKey=function(){return this.key_};mo.prototype.clone=function(){return new mo(this.key_,this.value_)};var no=function(a){this.nodes_=[];if(a)a:{if(a instanceof no){var b=a.getKeys();a=a.getValues();if(0>=this.getCount()){for(var c=this.nodes_,d=0;d<b.length;d++)c.push(new mo(b[d],a[d]));break a}}else b=Rj(a),a=Qj(a);for(d=0;d<b.length;d++)this.insert(b[d],a[d])}};g=no.prototype;g.insert=function(a,b){var c=this.nodes_;c.push(new mo(a,b));a=c.length-1;b=this.nodes_;for(c=b[a];0<a;){var d=a-1>>1;if(b[d].getKey()>c.getKey())b[a]=b[d],a=d;else break}b[a]=c};
g.remove=function(){var a=this.nodes_,b=a.length,c=a[0];if(!(0>=b)){if(1==b)Fj(a);else{a[0]=a.pop();a=0;b=this.nodes_;for(var d=b.length,e=b[a];a<d>>1;){var f=2*a+1,h=2*a+2;f=h<d&&b[h].getKey()<b[f].getKey()?h:f;if(b[f].getKey()>e.getKey())break;b[a]=b[f];a=f}b[a]=e}return c.value_}};g.getValues=function(){for(var a=this.nodes_,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].value_);return b};g.getKeys=function(){for(var a=this.nodes_,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].getKey());return b};
g.containsValue=function(a){return Bj(this.nodes_,function(b){return b.value_==a})};g.containsKey=function(a){return Bj(this.nodes_,function(b){return b.getKey()==a})};g.clone=function(){return new no(this)};g.getCount=function(){return this.nodes_.length};g.isEmpty=function(){return 0==this.nodes_.length};g.clear=function(){Fj(this.nodes_)};var oo=function(){no.call(this)};u(oo,no);oo.prototype.enqueue=function(a,b){this.insert(a,b)};oo.prototype.dequeue=function(){return this.remove()};var po=function(a,b){this.delayTimeout_=void 0;this.requestQueue_=new oo;ko.call(this,a,b)};u(po,ko);g=po.prototype;g.getObject=function(a,b){if(!a)return(a=po.superClass_.getObject.call(this))&&this.delay&&(this.delayTimeout_=p.setTimeout(r(this.handleQueueRequests_,this),this.delay)),a;this.requestQueue_.enqueue(ra(b)?b:100,a);this.handleQueueRequests_()};g.handleQueueRequests_=function(){for(var a=this.requestQueue_;0<a.getCount();){var b=this.getObject();if(b)a.dequeue().apply(this,[b]);else break}};
g.addFreeObject=function(a){po.superClass_.addFreeObject.call(this,a);this.handleQueueRequests_()};g.adjustForMinMax=function(){po.superClass_.adjustForMinMax.call(this);this.handleQueueRequests_()};g.disposeInternal=function(){po.superClass_.disposeInternal.call(this);p.clearTimeout(this.delayTimeout_);this.requestQueue_.clear();this.requestQueue_=null};var qo=function(a,b,c,d){this.headers_=a;this.withCredentials_=!!d;po.call(this,b,c)};u(qo,po);qo.prototype.createObject=function(){var a=new Y,b=this.headers_;b&&b.forEach(function(b,d){a.headers.set(d,b)});this.withCredentials_&&(a.withCredentials_=!0);return a};qo.prototype.objectCanBeReused=function(a){return!a.disposed_&&!a.isActive()};var ei=function(a){this.databaseId=a.databaseId;this.pool=new qo;this.baseUrl=(a.ssl?"https":"http")+"://"+a.host},ro=function(a,b,c){if(c)for(var d in c.authHeaders)c.authHeaders.hasOwnProperty(d)&&(b[d]=c.authHeaders[d]);/(content-)?test-firestore/.test(a.baseUrl)&&(b["X-Goog-Api-Client"]="gl-js/ fire/0.4.8",b["google-cloud-resource-prefix"]="projects/"+a.databaseId.projectId+"/"+("databases/"+a.databaseId.database))},Rg=function(a,b,c,d){var e=so(a,b);return new Promise(function(f,h){a.pool.getObject(function(l){l.listenOnce("complete",
function(){try{switch(l.lastErrorCode_){case 0:if(l.xhr_)b:{var c=l.xhr_.responseText;if(p.JSON)try{var d=p.JSON.parse(c);xj(d);var e=d;break b}catch(Jc){}d=Hl(c);T(d);e=d}else e=void 0;var t=e;w("Connection","XHR received:",JSON.stringify(t));f(t);break;case 8:Ia('RPC "'+b+'" timed out, retrying.');h(new A("deadline-exceeded","Request time out"));break;case 6:var y=tm(l);Ia('RPC "'+b+'" failed with status:',y,"response text:",rm(l));0<y?h(new A(jh(y),"Server responded with status "+Nn(l))):(Ia("Connection",
'RPC "'+b+'" failed, retrying.'),h(new A("unavailable","Connection failed.")));break;default:x('RPC "'+b+'" failed with unanticipated webchannel error '+l.lastErrorCode_+": "+l.getLastError()+", giving up.")}}finally{w("Connection",'RPC "'+b+'" completed.'),t=a.pool,t.inUseSet_.remove(l)&&t.addFreeObject(l)}});var t=JSON.stringify(c);w("Connection","XHR sending: ",e+" "+t);var y={"Content-Type":"text/plain"};ro(a,y,d);l.send(e,"POST",t,y,15)})})},Eg=function(a,b,c){var d=to[b],e=uo[b];d&&e||x("Unknown RPC name: "+
b);d=[a.baseUrl,"/",d,"/",e,"/channel"];io();b={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},sendRawJson:!0,supportsCrossDomainXhr:!0};ro(a,b.initMessageHeaders,c);a=d.join("");w("Connection","Creating WebChannel: "+a+" "+b);var f=new fo(a,b),h=!1,l=!1,t=new nj({sendFn:function(a){l?w("Connection","Not sending because WebChannel is closed:",a):(h||(w("Connection","Opening WebChannel transport."),f.open(),h=!0),w("Connection","WebChannel sending:",a),f.send(a))},closeFn:function(){return f.close()}});
a=function(a,b){f.listen(a,function(a){try{b(a)}catch(Jd){setTimeout(function(){throw Jd;},0)}})};a("a",function(){l||w("Connection","WebChannel transport opened.")});a("b",function(){l||(l=!0,w("Connection","WebChannel transport closed"),oj(t))});a("c",function(a){l||(l=!0,w("Connection","WebChannel transport errored:",a),oj(t,new A("unavailable","The operation could not be completed")))});a("d",function(a){if(!l){var b=a.data[0];z(!!b,"Got a webchannel message without data.");if(a=b.error||b[0]&&
b[0].error){w("Connection","WebChannel received error:",a);b=a.status;var c=fh[b];c=void 0!==c?Fg(c):void 0;var d=a.message;void 0===c&&(c="internal",d="Unknown error status: "+b+" with message "+a.message);l=!0;oj(t,new A(c,d));f.close()}else w("Connection","WebChannel received:",b),z(null!==t.wrappedOnMessage,"Cannot call onMessage because no callback was set"),t.wrappedOnMessage(b)}});setTimeout(function(){z(null!==t.wrappedOnOpen,"Cannot call onOpen because no callback was set");t.wrappedOnOpen()},
0);return t},so=function(a,b){var c=[a.baseUrl,"/","v1beta1"];c.push("/projects/");c.push(a.databaseId.projectId);c.push("/databases/");c.push(a.databaseId.database);c.push("/documents");c.push(":");c.push(b);return c.join("")},to={Write:"google.firestore.v1beta1.Firestore",Listen:"google.firestore.v1beta1.Firestore"},uo={Write:"Write",Listen:"Listen"};var vo=function(){this.emptyByteString="";this.base64Available="undefined"!==typeof atob};vo.prototype.atob=function(a){return atob(a)};vo.prototype.btoa=function(a){return btoa(a)};var wo=new vo;Ja&&x("Platform already defined");Ja=wo;if("undefined"!==typeof firebase&&"undefined"!==typeof firebase.INTERNAL)mj();else throw Error("Firebase SDK not found.");; }).call(this);
